{"file_contents":{"apps/web/src/components/ui/Input.jsx":{"content":"import React from 'react';\nimport { cn } from '@/lib/utils';\n\nconst Input = React.forwardRef(({ className, type, ...props }, ref) => {\n  return (\n    <input\n      type={type}\n      className={cn(\n        'flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50',\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  );\n});\nInput.displayName = 'Input';\n\nexport default Input;\n","size_bytes":684},"tools/setup-pihole.sh":{"content":"#!/bin/bash\n# Setup script para configurar Pi-hole ap√≥s docker-compose up\n# Execute: bash tools/setup-pihole.sh\n\nset -e\n\necho \"üîß Configurando Pi-hole demo...\"\n\n# Esperar Pi-hole estar pronto\necho \"Aguardando Pi-hole iniciar...\"\nsleep 10\n\n# Configurar senha admin\necho \"‚úì Configurando senha admin...\"\ndocker exec pihole-demo pihole -a -p novaguardian123\n\n# Configurar upstream DNS\necho \"‚úì Configurando upstream DNS...\"\ndocker exec pihole-demo pihole -a setdns 1.1.1.1 8.8.8.8\n\n# Habilitar query logging\necho \"‚úì Habilitando query logging...\"\ndocker exec pihole-demo pihole logging on\n\n# Configurar blocking mode para NXDOMAIN\necho \"‚úì Configurando blocking mode...\"\ndocker exec pihole-demo pihole -a -b nxdomain\n\n# Testar configura√ß√£o\necho \"‚úì Testando configura√ß√£o...\"\ndocker exec pihole-demo pihole status\n\necho \"\"\necho \"‚úÖ Pi-hole configurado com sucesso!\"\necho \"\"\necho \"üìã Informa√ß√µes:\"\necho \"   Web UI:  http://localhost:8081/admin\"\necho \"   Senha:   novaguardian123\"\necho \"   DNS:     localhost:5353 (via dnsdist)\"\necho \"\"\necho \"üß™ Teste o bloqueio:\"\necho \"   dig @127.0.0.1 -p 5353 instagram.com\"\necho \"\"\n","size_bytes":1133},"tools/backup_database.sh":{"content":"#!/bin/bash\n# Database backup script for NovaGuardianTech\n# Usage: ./backup_database.sh [output_dir]\n\nset -e\n\nOUTPUT_DIR=\"${1:-.backups}\"\nTIMESTAMP=$(date +%Y%m%d_%H%M%S)\nBACKUP_FILE=\"${OUTPUT_DIR}/novaguardian_backup_${TIMESTAMP}.sql\"\n\nmkdir -p \"$OUTPUT_DIR\"\n\necho \"üîÑ Starting database backup...\"\necho \"üìÅ Output: $BACKUP_FILE\"\n\nif [ -z \"$DATABASE_URL\" ]; then\n    echo \"‚ùå ERROR: DATABASE_URL environment variable not set\"\n    exit 1\nfi\n\npg_dump \"$DATABASE_URL\" > \"$BACKUP_FILE\"\n\nif [ -f \"$BACKUP_FILE\" ]; then\n    SIZE=$(du -h \"$BACKUP_FILE\" | cut -f1)\n    echo \"‚úÖ Backup completed successfully!\"\n    echo \"üìä Size: $SIZE\"\n    echo \"üìÅ File: $BACKUP_FILE\"\n    \n    echo \"\"\n    echo \"üßπ Cleaning old backups (keeping last 7 days)...\"\n    find \"$OUTPUT_DIR\" -name \"novaguardian_backup_*.sql\" -type f -mtime +7 -delete\n    echo \"‚úÖ Cleanup complete\"\nelse\n    echo \"‚ùå Backup failed!\"\n    exit 1\nfi\n","size_bytes":914},"QUICKSTART.md":{"content":"# NovaGuardianTech - Guia R√°pido de In√≠cio\n\n## üöÄ In√≠cio R√°pido (5 minutos)\n\n### Pr√©-requisitos\n- Docker e Docker Compose instalados\n- Python 3.11+\n- Node.js 18+\n\n### 1. Iniciar Infraestrutura DNS\n\n```bash\n# Subir todos os containers\nmake dev\n\n# Aguardar 30 segundos para Pi-hole inicializar\nsleep 30\n\n# Configurar Pi-hole (executar UMA vez)\nbash tools/setup-pihole.sh\n```\n\n### 2. Iniciar Backend\n\n```bash\ncd apps/api\n\n# Instalar depend√™ncias\npip install -r requirements.txt\n\n# Popular banco de dados\ncd ../tools\npython seed.py\n\n# Iniciar API\ncd ../apps/api\npython main.py\n```\n\nA API estar√° em: http://localhost:8080\n\n### 3. Iniciar Frontend\n\n```bash\ncd apps/web\n\n# Instalar depend√™ncias\nnpm install\n\n# Iniciar dev server\nnpm run dev\n```\n\nO frontend estar√° em: http://localhost:5000\n\n## üîê Login\n\n**Credenciais Admin**:\n- Email: `admin@novaguardian.com`\n- Senha: `admin123`\n\n**Credenciais User**:\n- Email: `user@example.com`\n- Senha: `user123`\n\n## üß™ Testar Bloqueio DNS\n\n### Via API\n\n```bash\n# 1. Fazer login e obter token\ncurl -X POST http://localhost:8080/auth/login \\\n  -H \"Content-Type: application/x-www-form-urlencoded\" \\\n  -d \"username=admin@novaguardian.com&password=admin123\"\n\n# Copiar o \"access_token\" da resposta\n\n# 2. Adicionar dom√≠nio para bloquear\ncurl -X POST http://localhost:8080/domains \\\n  -H \"Authorization: Bearer SEU_TOKEN_AQUI\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"domain\": \"instagram.com\",\n    \"kind\": \"EXACT\",\n    \"description\": \"Bloqueio de rede social\"\n  }'\n\n# 3. Sincronizar com Pi-hole\ncurl -X POST http://localhost:8080/dns/sync \\\n  -H \"Authorization: Bearer SEU_TOKEN_AQUI\"\n\n# 4. Testar bloqueio\ndig @127.0.0.1 -p 5353 instagram.com\n# Deve retornar NXDOMAIN (bloqueado)\n\ndig @127.0.0.1 -p 5353 google.com\n# Deve retornar IP normal (permitido)\n```\n\n### Via Interface Web\n\n1. Acesse http://localhost:5000\n2. Fa√ßa login com admin@novaguardian.com / admin123\n3. V√° em \"Domains\" ‚Üí \"Add Domain\"\n4. Adicione: `facebook.com` (EXACT)\n5. Clique em \"Sync DNS\" (√≠cone de refresh)\n6. Teste: `dig @127.0.0.1 -p 5353 facebook.com`\n\n## üìä Interfaces Web\n\n| Servi√ßo | URL | Credenciais |\n|---------|-----|-------------|\n| Frontend | http://localhost:5000 | admin@novaguardian.com / admin123 |\n| API Docs | http://localhost:8080/docs | - |\n| Pi-hole | http://localhost:8081/admin | Password: novaguardian123 |\n| dnsdist | http://localhost:8053 | admin / novaguardian-dnsdist-2024 |\n\n## üîß Comandos √öteis\n\n```bash\n# Ver logs de todos os containers\nmake logs\n\n# Parar todos os servi√ßos\nmake stop\n\n# Limpar volumes e recome√ßar\nmake clean\nmake dev\n\n# Testar DNS automaticamente\nmake dns-test\n\n# Ver status do dnsdist\nmake dns-status\n```\n\n## üìÅ Estrutura R√°pida\n\n```\nNovaGuardianTech/\n‚îú‚îÄ‚îÄ apps/\n‚îÇ   ‚îú‚îÄ‚îÄ web/          # Frontend React (porta 5000)\n‚îÇ   ‚îî‚îÄ‚îÄ api/          # Backend FastAPI (porta 8080)\n‚îú‚îÄ‚îÄ infra/\n‚îÇ   ‚îú‚îÄ‚îÄ dnsdist/      # Config dnsdist\n‚îÇ   ‚îî‚îÄ‚îÄ pihole/       # Config Pi-hole\n‚îú‚îÄ‚îÄ tools/\n‚îÇ   ‚îú‚îÄ‚îÄ seed.py       # Popular BD\n‚îÇ   ‚îî‚îÄ‚îÄ setup-pihole.sh  # Configurar Pi-hole\n‚îú‚îÄ‚îÄ docker-compose.yml\n‚îî‚îÄ‚îÄ Makefile\n```\n\n## ‚ùì Troubleshooting\n\n### Pi-hole n√£o bloqueia\n\n```bash\n# 1. Verificar se container est√° rodando\ndocker ps | grep pihole-demo\n\n# 2. Reconfigurar Pi-hole\nbash tools/setup-pihole.sh\n\n# 3. Verificar gravity database\ndocker exec pihole-demo sqlite3 /etc/pihole/gravity.db \\\n  \"SELECT * FROM domainlist WHERE comment='NovaGuardian';\"\n```\n\n### API retorna 401 Unauthorized\n\n- Token JWT expirou (v√°lido por 24h)\n- Fa√ßa login novamente para obter novo token\n- Verifique se est√° enviando header: `Authorization: Bearer TOKEN`\n\n### Frontend n√£o conecta na API\n\n- Verifique se API est√° rodando: http://localhost:8080/docs\n- Verifique proxy Vite em `apps/web/vite.config.js`\n- Limpe cache do browser (Ctrl+Shift+R)\n\n### Docker n√£o sobe\n\n```bash\n# Verificar portas em uso\nsudo lsof -i :5353  # dnsdist\nsudo lsof -i :8081  # Pi-hole\nsudo lsof -i :5432  # PostgreSQL\n\n# Limpar tudo e recome√ßar\nmake clean\ndocker system prune -a\nmake dev\n```\n\n## üìö Pr√≥ximos Passos\n\n1. ‚úÖ Explorar interface web\n2. ‚úÖ Adicionar m√∫ltiplos dom√≠nios\n3. ‚úÖ Testar bloqueios DNS reais\n4. ‚úÖ Configurar regex patterns\n5. ‚úÖ Adicionar IPs na whitelist\n6. ‚úÖ Ver logs de auditoria (em desenvolvimento)\n7. üìã Deploy em produ√ß√£o (Fase D)\n\n## üÜò Suporte\n\n- Documenta√ß√£o completa: `replit.md`\n- Documenta√ß√£o da API: http://localhost:8080/docs\n- Documenta√ß√£o Pi-hole: `infra/pihole/README.md`\n","size_bytes":4540},"apps/api/models/client.py":{"content":"from sqlalchemy import Column, Integer, String, Boolean, DateTime\nfrom sqlalchemy.sql import func\nfrom sqlalchemy.orm import relationship\nfrom core.database import Base\n\n\nclass Client(Base):\n    __tablename__ = \"clients\"\n\n    id = Column(Integer, primary_key=True, index=True)\n    name = Column(String(255), nullable=False)\n    slug = Column(String(255), unique=True, index=True, nullable=False)\n    is_active = Column(Boolean, default=True, nullable=False)\n    created_at = Column(DateTime(timezone=True), server_default=func.now())\n    \n    # Relationships\n    locations = relationship(\"Location\", back_populates=\"client\", cascade=\"all, delete-orphan\")\n    pihole_instances = relationship(\"PiholeInstance\", back_populates=\"client\", cascade=\"all, delete-orphan\")\n    domain_rules = relationship(\"DomainRule\", back_populates=\"client\", cascade=\"all, delete-orphan\")\n    ip_whitelist = relationship(\"IpWhitelist\", back_populates=\"client\", cascade=\"all, delete-orphan\")\n","size_bytes":967},"apps/api/routers/dns.py":{"content":"from fastapi import APIRouter, Depends, Request, HTTPException\nfrom sqlalchemy.orm import Session\nfrom typing import List, Dict, Any\nfrom core.database import get_db\nfrom core.security import get_current_user\nfrom models.user import User, UserRole\nfrom models.domain_rule import DomainRule, DomainStatus\nfrom models.pihole_instance import PiholeInstance\nfrom services.pihole import PiholeService\nfrom pydantic import BaseModel\nimport time\n\nrouter = APIRouter(prefix=\"/dns\", tags=[\"DNS\"])\n\n\nclass DnsApplyResponse(BaseModel):\n    ok: bool\n    applied_count: int\n    took_ms: int\n    message: str\n\n\nclass DnsSyncResponse(BaseModel):\n    ok: bool\n    client_id: int\n    container_name: str\n    added: List[Dict[str, Any]]\n    failed: List[Dict[str, Any]]\n    total: int\n    took_ms: int\n    message: str\n\n\n@router.get(\"/my-ip\")\nasync def get_my_ip(request: Request):\n    client_host = request.client.host if request.client else \"unknown\"\n    forwarded_for = request.headers.get(\"X-Forwarded-For\")\n    real_ip = request.headers.get(\"X-Real-IP\")\n    \n    return {\n        \"ip\": forwarded_for or real_ip or client_host,\n        \"headers\": {\n            \"X-Forwarded-For\": forwarded_for,\n            \"X-Real-IP\": real_ip,\n            \"client_host\": client_host\n        }\n    }\n\n\n@router.post(\"/apply\", response_model=DnsApplyResponse)\nasync def apply_dns_rules(\n    client_id: int = None,\n    db: Session = Depends(get_db),\n    current_user: User = Depends(get_current_user)\n):\n    start_time = time.time()\n    \n    if current_user.role == UserRole.ADMIN:\n        if client_id is None:\n            if current_user.client_id is not None:\n                client_id = current_user.client_id\n            else:\n                raise HTTPException(status_code=400, detail=\"Admin must specify client_id or have a default client\")\n    else:\n        if current_user.client_id is None:\n            raise HTTPException(status_code=400, detail=\"User not assigned to any client\")\n        client_id = current_user.client_id\n    \n    active_domains = db.query(DomainRule).filter(\n        DomainRule.client_id == client_id,\n        DomainRule.status == DomainStatus.ACTIVE\n    ).all()\n    \n    took_ms = int((time.time() - start_time) * 1000)\n    \n    return DnsApplyResponse(\n        ok=True,\n        applied_count=len(active_domains),\n        took_ms=took_ms,\n        message=f\"Applied {len(active_domains)} domain rules for client {client_id}. Use /dns/sync to sync with Pi-hole.\"\n    )\n\n\n@router.post(\"/sync\", response_model=DnsSyncResponse)\nasync def sync_dns_rules_to_pihole(\n    client_id: int = None,\n    db: Session = Depends(get_db),\n    current_user: User = Depends(get_current_user)\n):\n    start_time = time.time()\n    \n    if current_user.role == UserRole.ADMIN:\n        if client_id is None:\n            if current_user.client_id is not None:\n                client_id = current_user.client_id\n            else:\n                raise HTTPException(status_code=400, detail=\"Admin must specify client_id or have a default client\")\n    else:\n        if current_user.client_id is None:\n            raise HTTPException(status_code=400, detail=\"User not assigned to any client\")\n        client_id = current_user.client_id\n    \n    pihole_instance = db.query(PiholeInstance).filter(\n        PiholeInstance.client_id == client_id\n    ).first()\n    \n    if not pihole_instance:\n        raise HTTPException(\n            status_code=404,\n            detail=f\"No Pi-hole instance found for client {client_id}\"\n        )\n    \n    active_domains = db.query(DomainRule).filter(\n        DomainRule.client_id == client_id,\n        DomainRule.status == DomainStatus.ACTIVE\n    ).all()\n    \n    pihole_service = PiholeService(pihole_instance.container_name)\n    \n    if not pihole_service.is_running():\n        raise HTTPException(\n            status_code=503,\n            detail=f\"Pi-hole container '{pihole_instance.container_name}' is not running\"\n        )\n    \n    sync_result = pihole_service.sync_domains(active_domains)\n    \n    took_ms = int((time.time() - start_time) * 1000)\n    \n    return DnsSyncResponse(\n        ok=len(sync_result[\"failed\"]) == 0,\n        client_id=client_id,\n        container_name=pihole_instance.container_name,\n        added=sync_result[\"added\"],\n        failed=sync_result[\"failed\"],\n        total=sync_result[\"total\"],\n        took_ms=took_ms,\n        message=f\"Synced {len(sync_result['added'])}/{sync_result['total']} domains to Pi-hole\"\n    )\n","size_bytes":4456},"apps/web/src/pages/Audit.jsx":{"content":"import { useState } from 'react';\nimport { Search, Filter, Loader2, FileText } from 'lucide-react';\nimport { Card, CardHeader, CardTitle, CardDescription, CardContent } from '@/components/ui/Card';\nimport Button from '@/components/ui/Button';\nimport Input from '@/components/ui/Input';\nimport Select from '@/components/ui/Select';\nimport Badge from '@/components/ui/Badge';\nimport Alert from '@/components/ui/Alert';\nimport { Table, TableHeader, TableBody, TableRow, TableHead, TableCell } from '@/components/ui/Table';\nimport { useAuditLogs } from '@/hooks/useAudit';\n\nexport default function Audit() {\n  const [filters, setFilters] = useState({\n    action: '',\n    limit: 50,\n    offset: 0,\n  });\n\n  const { data: logs = [], isLoading, error } = useAuditLogs(filters);\n\n  const formatDate = (dateString) => {\n    const date = new Date(dateString);\n    return new Intl.DateTimeFormat('pt-BR', {\n      day: '2-digit',\n      month: '2-digit',\n      year: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit',\n      second: '2-digit',\n    }).format(date);\n  };\n\n  const getActionBadge = (action) => {\n    const variants = {\n      create: 'success',\n      update: 'warning',\n      delete: 'danger',\n      sync: 'primary',\n      provision: 'purple',\n    };\n    \n    const actionLower = action.toLowerCase();\n    const variant = Object.keys(variants).find(key => actionLower.includes(key)) || 'default';\n    \n    return <Badge variant={variants[variant]}>{action}</Badge>;\n  };\n\n  const handleFilterChange = (key, value) => {\n    setFilters({ ...filters, [key]: value, offset: 0 });\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div>\n        <h1 className=\"text-3xl font-bold text-gray-900\">Logs de Auditoria</h1>\n        <p className=\"text-gray-600 mt-2\">Hist√≥rico completo de a√ß√µes realizadas no sistema</p>\n      </div>\n\n      {error && (\n        <Alert variant=\"danger\">\n          Erro ao carregar logs: {error.message}\n        </Alert>\n      )}\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Filtros</CardTitle>\n          <CardDescription>Refine a busca de logs</CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                Tipo de A√ß√£o\n              </label>\n              <Select\n                value={filters.action}\n                onChange={(e) => handleFilterChange('action', e.target.value)}\n              >\n                <option value=\"\">Todas as a√ß√µes</option>\n                <option value=\"create\">Cria√ß√£o</option>\n                <option value=\"update\">Atualiza√ß√£o</option>\n                <option value=\"delete\">Exclus√£o</option>\n                <option value=\"sync\">Sincroniza√ß√£o</option>\n                <option value=\"provision\">Provisionamento</option>\n              </Select>\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                Registros por P√°gina\n              </label>\n              <Select\n                value={filters.limit}\n                onChange={(e) => handleFilterChange('limit', parseInt(e.target.value))}\n              >\n                <option value=\"10\">10</option>\n                <option value=\"25\">25</option>\n                <option value=\"50\">50</option>\n                <option value=\"100\">100</option>\n              </Select>\n            </div>\n\n            <div className=\"flex items-end\">\n              <Button variant=\"outline\" className=\"w-full\">\n                <Filter className=\"h-4 w-4 mr-2\" />\n                Aplicar Filtros\n              </Button>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Registros de Auditoria</CardTitle>\n          <CardDescription>Total: {logs.length} registros</CardDescription>\n        </CardHeader>\n        <CardContent>\n          {logs.length === 0 ? (\n            <div className=\"text-center py-12\">\n              <FileText className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n              <p className=\"text-gray-500\">Nenhum log encontrado com os filtros aplicados.</p>\n            </div>\n          ) : (\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>ID</TableHead>\n                  <TableHead>Data/Hora</TableHead>\n                  <TableHead>Usu√°rio</TableHead>\n                  <TableHead>A√ß√£o</TableHead>\n                  <TableHead>Recurso</TableHead>\n                  <TableHead>Cliente</TableHead>\n                  <TableHead>Detalhes</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {logs.map((log) => (\n                  <TableRow key={log.id}>\n                    <TableCell className=\"font-mono text-xs\">#{log.id}</TableCell>\n                    <TableCell className=\"text-xs whitespace-nowrap\">\n                      {formatDate(log.timestamp)}\n                    </TableCell>\n                    <TableCell className=\"text-sm\">\n                      {log.user?.name || 'Sistema'}\n                    </TableCell>\n                    <TableCell>\n                      {getActionBadge(log.action)}\n                    </TableCell>\n                    <TableCell className=\"font-mono text-xs\">\n                      {log.resource_type}\n                      {log.resource_id && ` #${log.resource_id}`}\n                    </TableCell>\n                    <TableCell className=\"text-xs\">\n                      {log.client_id ? `Cliente #${log.client_id}` : '-'}\n                    </TableCell>\n                    <TableCell className=\"text-xs text-gray-600 max-w-xs truncate\">\n                      {log.details || '-'}\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          )}\n        </CardContent>\n      </Card>\n\n      <div className=\"flex items-center justify-between\">\n        <p className=\"text-sm text-gray-600\">\n          Exibindo {logs.length} de {logs.length} registros\n        </p>\n        <div className=\"flex gap-2\">\n          <Button\n            variant=\"outline\"\n            disabled={filters.offset === 0}\n            onClick={() => handleFilterChange('offset', Math.max(0, filters.offset - filters.limit))}\n          >\n            Anterior\n          </Button>\n          <Button\n            variant=\"outline\"\n            disabled={logs.length < filters.limit}\n            onClick={() => handleFilterChange('offset', filters.offset + filters.limit)}\n          >\n            Pr√≥xima\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":6945},"apps/api/core/config.py":{"content":"from pydantic_settings import BaseSettings\nfrom typing import List\nimport os\n\n\nclass Settings(BaseSettings):\n    PROJECT_NAME: str = \"NovaGuardianTech\"\n    VERSION: str = \"1.0.0\"\n    API_V1_STR: str = \"/api\"\n    \n    DATABASE_URL: str\n    \n    DATABASE_POOL_SIZE: int = 5\n    DATABASE_MAX_OVERFLOW: int = 10\n    DATABASE_POOL_TIMEOUT: int = 30\n    DATABASE_POOL_RECYCLE: int = 3600\n    \n    JWT_SECRET: str\n    JWT_ALGORITHM: str = \"HS256\"\n    JWT_EXPIRE_MINUTES: int = 1440\n    \n    API_HOST: str = \"0.0.0.0\"\n    API_PORT: int = 8080\n    API_RELOAD: bool = True\n    \n    CORS_ORIGINS: str = \"http://localhost:5000\"\n    \n    ENVIRONMENT: str = \"development\"\n    \n    DOCKER_NETWORK: str = \"novaguardian\"\n    PIHOLE_BASE_PORT: int = 8081\n    PIHOLE_IMAGE: str = \"pihole/pihole:latest\"\n    PIHOLE_SUBNET: str = \"172.20.0.0/16\"\n    PIHOLE_IP_START: int = 10\n    \n    DNSDIST_CONFIG_PATH: str = \"/etc/dnsdist/dnsdist.conf\"\n    DNSDIST_CONTAINER: str = \"novaguardian-dnsdist\"\n    \n    @property\n    def cors_origins_list(self) -> List[str]:\n        return [origin.strip() for origin in self.CORS_ORIGINS.split(\",\")]\n    \n    @property\n    def is_production(self) -> bool:\n        return self.ENVIRONMENT == \"production\"\n    \n    @property\n    def is_development(self) -> bool:\n        return self.ENVIRONMENT == \"development\"\n    \n    class Config:\n        env_file = \".env\"\n        case_sensitive = True\n\n\nsettings = Settings()\n","size_bytes":1424},"apps/web/src/lib/utils.js":{"content":"import { clsx } from \"clsx\";\nimport { twMerge } from \"tailwind-merge\";\n\nexport function cn(...inputs) {\n  return twMerge(clsx(inputs));\n}\n\nexport function formatDate(date) {\n  if (!date) return '';\n  return new Date(date).toLocaleDateString('pt-BR', {\n    day: '2-digit',\n    month: '2-digit',\n    year: 'numeric',\n    hour: '2-digit',\n    minute: '2-digit',\n  });\n}\n\nexport function formatIp(ip) {\n  if (!ip) return '-';\n  return ip;\n}\n","size_bytes":437},"apps/web/vite.config.js":{"content":"import { defineConfig } from 'vite'\nimport react from '@vitejs/plugin-react'\nimport path from 'path'\n\nexport default defineConfig({\n  plugins: [react()],\n  resolve: {\n    alias: {\n      '@': path.resolve(__dirname, './src'),\n    },\n  },\n  server: {\n    host: '0.0.0.0',\n    port: 5000,\n    strictPort: true,\n    allowedHosts: true,\n    hmr: {\n      protocol: 'wss',\n      host: undefined,\n      clientPort: 443,\n      timeout: 30000,\n    },\n    proxy: {\n      '/api': {\n        target: process.env.REPLIT_DOMAINS \n          ? `https://${process.env.REPLIT_DOMAINS}:8080`\n          : 'http://localhost:8080',\n        changeOrigin: true,\n        secure: false,\n        rewrite: (path) => path.replace(/^\\/api/, ''),\n      },\n    },\n  },\n  preview: {\n    host: '0.0.0.0',\n    port: 5000,\n  },\n})\n","size_bytes":793},"apps/web/src/pages/Whitelist.jsx":{"content":"import { useState } from 'react';\nimport { Plus, Trash2, ListFilter, Loader2 } from 'lucide-react';\nimport { Card, CardHeader, CardTitle, CardDescription, CardContent } from '@/components/ui/Card';\nimport Button from '@/components/ui/Button';\nimport Input from '@/components/ui/Input';\nimport Select from '@/components/ui/Select';\nimport Alert from '@/components/ui/Alert';\nimport { Table, TableHeader, TableBody, TableRow, TableHead, TableCell } from '@/components/ui/Table';\nimport { useWhitelist, useAddWhitelist, useDeleteWhitelist } from '@/hooks/useWhitelist';\nimport { useClients } from '@/hooks/useClients';\n\nexport default function Whitelist() {\n  const [selectedClientId, setSelectedClientId] = useState('');\n  const [newIp, setNewIp] = useState('');\n  const [newLabel, setNewLabel] = useState('');\n\n  const { data: clients = [] } = useClients();\n  const { data: whitelist = [], isLoading, error } = useWhitelist(selectedClientId);\n  const addMutation = useAddWhitelist();\n  const deleteMutation = useDeleteWhitelist();\n\n  const handleAddIp = async (e) => {\n    e.preventDefault();\n    if (!newIp.trim() || !selectedClientId) return;\n\n    try {\n      await addMutation.mutateAsync({\n        client_id: parseInt(selectedClientId),\n        ip_address: newIp.trim(),\n        label: newLabel.trim() || 'Sem descri√ß√£o',\n      });\n      setNewIp('');\n      setNewLabel('');\n    } catch (err) {\n      console.error('Erro ao adicionar IP:', err);\n    }\n  };\n\n  const handleDeleteIp = async (whitelistId) => {\n    if (window.confirm('Tem certeza que deseja remover este IP da whitelist?')) {\n      await deleteMutation.mutateAsync(whitelistId);\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div>\n        <h1 className=\"text-3xl font-bold text-gray-900\">Whitelist de IPs</h1>\n        <p className=\"text-gray-600 mt-2\">\n          Gerencie os endere√ßos IP autorizados por cliente\n        </p>\n      </div>\n\n      {error && (\n        <Alert variant=\"warning\">\n          Erro ao carregar whitelist. Verifique se a API est√° rodando.\n        </Alert>\n      )}\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Selecionar Cliente</CardTitle>\n          <CardDescription>Escolha o cliente para gerenciar IPs autorizados</CardDescription>\n        </CardHeader>\n        <CardContent>\n          <Select\n            value={selectedClientId}\n            onChange={(e) => setSelectedClientId(e.target.value)}\n          >\n            <option value=\"\">Selecione um cliente...</option>\n            {clients.map((client) => (\n              <option key={client.id} value={client.id}>\n                {client.name} ({client.public_ip})\n              </option>\n            ))}\n          </Select>\n        </CardContent>\n      </Card>\n\n      {selectedClientId && (\n        <>\n          <Card>\n            <CardHeader>\n              <CardTitle>Adicionar Novo IP</CardTitle>\n              <CardDescription>Autorize IPs espec√≠ficos para este cliente</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <form onSubmit={handleAddIp} className=\"space-y-4\">\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                      Endere√ßo IP\n                    </label>\n                    <Input\n                      type=\"text\"\n                      placeholder=\"192.168.1.100\"\n                      value={newIp}\n                      onChange={(e) => setNewIp(e.target.value)}\n                      disabled={addMutation.isLoading}\n                      required\n                    />\n                  </div>\n\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                      Descri√ß√£o (opcional)\n                    </label>\n                    <Input\n                      type=\"text\"\n                      placeholder=\"Escrit√≥rio Central, Filial SP, etc.\"\n                      value={newLabel}\n                      onChange={(e) => setNewLabel(e.target.value)}\n                      disabled={addMutation.isLoading}\n                    />\n                  </div>\n                </div>\n\n                <Button type=\"submit\" disabled={addMutation.isLoading}>\n                  {addMutation.isLoading ? (\n                    <>\n                      <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                      Adicionando...\n                    </>\n                  ) : (\n                    <>\n                      <Plus className=\"h-4 w-4 mr-2\" />\n                      Adicionar IP\n                    </>\n                  )}\n                </Button>\n              </form>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>IPs Autorizados</CardTitle>\n              <CardDescription>{whitelist.length} endere√ßo(s) na whitelist</CardDescription>\n            </CardHeader>\n            <CardContent>\n              {isLoading ? (\n                <div className=\"flex items-center justify-center h-32\">\n                  <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n                </div>\n              ) : whitelist.length === 0 ? (\n                <div className=\"text-center py-12\">\n                  <ListFilter className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n                  <p className=\"text-gray-500\">Nenhum IP autorizado para este cliente</p>\n                </div>\n              ) : (\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>ID</TableHead>\n                      <TableHead>Endere√ßo IP</TableHead>\n                      <TableHead>Descri√ß√£o</TableHead>\n                      <TableHead>A√ß√µes</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {whitelist.map((entry) => (\n                      <TableRow key={entry.id}>\n                        <TableCell className=\"font-mono text-xs\">#{entry.id}</TableCell>\n                        <TableCell>\n                          <code className=\"px-2 py-1 bg-gray-100 rounded text-sm font-mono\">\n                            {entry.ip_address}\n                          </code>\n                        </TableCell>\n                        <TableCell className=\"text-sm text-gray-600\">{entry.label}</TableCell>\n                        <TableCell>\n                          <Button\n                            size=\"sm\"\n                            variant=\"outline\"\n                            onClick={() => handleDeleteIp(entry.id)}\n                            disabled={deleteMutation.isLoading}\n                          >\n                            <Trash2 className=\"h-3 w-3\" />\n                          </Button>\n                        </TableCell>\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n              )}\n            </CardContent>\n          </Card>\n        </>\n      )}\n    </div>\n  );\n}\n","size_bytes":7120},"apps/api/routers/admin.py":{"content":"from fastapi import APIRouter, Depends, HTTPException, status, Query\nfrom sqlalchemy.orm import Session\nfrom typing import List, Optional\nfrom core.database import get_db\nfrom core.security import get_current_admin_user, get_password_hash\nfrom models.user import User\nfrom models.client import Client\nfrom models.location import Location\nfrom models.audit_log import AuditLog\nfrom schemas.user import UserCreate, UserUpdate, UserResponse\nfrom schemas.client import ClientCreate, ClientUpdate, ClientResponse\nfrom schemas.location import LocationCreate, LocationUpdate, LocationResponse\nfrom schemas.audit_log import AuditLogResponse\n\nrouter = APIRouter(prefix=\"/admin\", tags=[\"Admin\"])\n\n\n@router.get(\"/users\", response_model=List[UserResponse])\nasync def list_users(\n    db: Session = Depends(get_db),\n    current_user: User = Depends(get_current_admin_user)\n):\n    users = db.query(User).all()\n    return [UserResponse.from_orm(u) for u in users]\n\n\n@router.post(\"/users\", response_model=UserResponse, status_code=status.HTTP_201_CREATED)\nasync def create_user(\n    user_data: UserCreate,\n    db: Session = Depends(get_db),\n    current_user: User = Depends(get_current_admin_user)\n):\n    existing = db.query(User).filter(User.email == user_data.email).first()\n    if existing:\n        raise HTTPException(status_code=400, detail=\"Email already registered\")\n    \n    new_user = User(\n        name=user_data.name,\n        email=user_data.email,\n        password_hash=get_password_hash(user_data.password),\n        role=user_data.role\n    )\n    \n    db.add(new_user)\n    db.commit()\n    db.refresh(new_user)\n    \n    return UserResponse.from_orm(new_user)\n\n\n@router.put(\"/users/{user_id}\", response_model=UserResponse)\nasync def update_user(\n    user_id: int,\n    user_data: UserUpdate,\n    db: Session = Depends(get_db),\n    current_user: User = Depends(get_current_admin_user)\n):\n    user = db.query(User).filter(User.id == user_id).first()\n    \n    if not user:\n        raise HTTPException(status_code=404, detail=\"User not found\")\n    \n    if user_data.name is not None:\n        user.name = user_data.name\n    if user_data.email is not None:\n        existing = db.query(User).filter(User.email == user_data.email, User.id != user_id).first()\n        if existing:\n            raise HTTPException(status_code=400, detail=\"Email already in use\")\n        user.email = user_data.email\n    if user_data.password is not None:\n        user.password_hash = get_password_hash(user_data.password)\n    if user_data.role is not None:\n        user.role = user_data.role\n    \n    db.commit()\n    db.refresh(user)\n    \n    return UserResponse.from_orm(user)\n\n\n@router.delete(\"/users/{user_id}\", status_code=status.HTTP_204_NO_CONTENT)\nasync def delete_user(\n    user_id: int,\n    db: Session = Depends(get_db),\n    current_user: User = Depends(get_current_admin_user)\n):\n    if user_id == current_user.id:\n        raise HTTPException(status_code=400, detail=\"Cannot delete your own user account\")\n    \n    user = db.query(User).filter(User.id == user_id).first()\n    \n    if not user:\n        raise HTTPException(status_code=404, detail=\"User not found\")\n    \n    db.delete(user)\n    db.commit()\n    \n    return None\n\n\n@router.get(\"/clients\", response_model=List[ClientResponse])\nasync def list_clients(\n    db: Session = Depends(get_db),\n    current_user: User = Depends(get_current_admin_user)\n):\n    clients = db.query(Client).all()\n    return [ClientResponse.from_orm(c) for c in clients]\n\n\n@router.post(\"/clients\", response_model=ClientResponse, status_code=status.HTTP_201_CREATED)\nasync def create_client(\n    client_data: ClientCreate,\n    db: Session = Depends(get_db),\n    current_user: User = Depends(get_current_admin_user)\n):\n    from sqlalchemy.exc import IntegrityError\n    from sqlalchemy import func\n    \n    # Check for duplicate slug (case-insensitive)\n    slug_normalized = client_data.slug.lower().strip()\n    existing = db.query(Client).filter(func.lower(Client.slug) == slug_normalized).first()\n    if existing:\n        raise HTTPException(status_code=409, detail=f\"Client with slug '{client_data.slug}' already exists\")\n    \n    new_client = Client(\n        name=client_data.name,\n        slug=slug_normalized,\n        is_active=client_data.is_active\n    )\n    db.add(new_client)\n    \n    try:\n        db.commit()\n        db.refresh(new_client)\n    except IntegrityError:\n        db.rollback()\n        raise HTTPException(status_code=409, detail=\"Client with this slug already exists\")\n    except Exception:\n        db.rollback()\n        raise HTTPException(status_code=500, detail=\"Error creating client\")\n    \n    return ClientResponse.from_orm(new_client)\n\n\n@router.put(\"/clients/{client_id}\", response_model=ClientResponse)\nasync def update_client(\n    client_id: int,\n    client_data: ClientUpdate,\n    db: Session = Depends(get_db),\n    current_user: User = Depends(get_current_admin_user)\n):\n    from sqlalchemy.exc import IntegrityError\n    from sqlalchemy import func\n    \n    client = db.query(Client).filter(Client.id == client_id).first()\n    if not client:\n        raise HTTPException(status_code=404, detail=\"Client not found\")\n    \n    # Check for duplicate slug if being updated (case-insensitive)\n    if client_data.slug:\n        slug_normalized = client_data.slug.lower().strip()\n        if slug_normalized != client.slug.lower():\n            existing = db.query(Client).filter(\n                func.lower(Client.slug) == slug_normalized,\n                Client.id != client_id\n            ).first()\n            if existing:\n                raise HTTPException(status_code=409, detail=f\"Client with slug '{client_data.slug}' already exists\")\n            client.slug = slug_normalized\n    \n    if client_data.name is not None:\n        client.name = client_data.name\n    if client_data.is_active is not None:\n        client.is_active = client_data.is_active\n    \n    try:\n        db.commit()\n        db.refresh(client)\n    except IntegrityError:\n        db.rollback()\n        raise HTTPException(status_code=409, detail=\"Client with this slug already exists\")\n    except Exception:\n        db.rollback()\n        raise HTTPException(status_code=500, detail=\"Error updating client\")\n    \n    return ClientResponse.from_orm(client)\n\n\n@router.delete(\"/clients/{client_id}\", status_code=status.HTTP_204_NO_CONTENT)\nasync def delete_client(\n    client_id: int,\n    db: Session = Depends(get_db),\n    current_user: User = Depends(get_current_admin_user)\n):\n    from models.domain_rule import DomainRule\n    from models.ip_whitelist import IpWhitelist\n    from models.pihole_instance import PiholeInstance\n    from sqlalchemy.exc import IntegrityError\n    \n    client = db.query(Client).filter(Client.id == client_id).first()\n    if not client:\n        raise HTTPException(status_code=404, detail=\"Client not found\")\n    \n    # Check for dependencies\n    dependencies = []\n    \n    users_count = db.query(User).filter(User.client_id == client_id).count()\n    if users_count > 0:\n        dependencies.append(f\"{users_count} user(s)\")\n    \n    domains_count = db.query(DomainRule).filter(DomainRule.client_id == client_id).count()\n    if domains_count > 0:\n        dependencies.append(f\"{domains_count} domain rule(s)\")\n    \n    whitelist_count = db.query(IpWhitelist).filter(IpWhitelist.client_id == client_id).count()\n    if whitelist_count > 0:\n        dependencies.append(f\"{whitelist_count} whitelist entry/entries\")\n    \n    pihole_count = db.query(PiholeInstance).filter(PiholeInstance.client_id == client_id).count()\n    if pihole_count > 0:\n        dependencies.append(f\"{pihole_count} Pi-hole instance(s)\")\n    \n    audit_count = db.query(AuditLog).filter(AuditLog.client_id == client_id).count()\n    if audit_count > 0:\n        dependencies.append(f\"{audit_count} audit log(s)\")\n    \n    if dependencies:\n        raise HTTPException(\n            status_code=409, \n            detail=f\"Cannot delete client. It has: {', '.join(dependencies)}. Please remove these first.\"\n        )\n    \n    try:\n        db.delete(client)\n        db.commit()\n    except IntegrityError:\n        db.rollback()\n        raise HTTPException(status_code=409, detail=\"Cannot delete client due to existing references\")\n    except Exception:\n        db.rollback()\n        raise HTTPException(status_code=500, detail=\"Error deleting client\")\n    \n    return None\n\n\n@router.get(\"/locations\", response_model=List[LocationResponse])\nasync def list_locations(\n    db: Session = Depends(get_db),\n    current_user: User = Depends(get_current_admin_user)\n):\n    locations = db.query(Location).all()\n    return [LocationResponse.from_orm(l) for l in locations]\n\n\n@router.post(\"/locations\", response_model=LocationResponse, status_code=status.HTTP_201_CREATED)\nasync def create_location(\n    location_data: LocationCreate,\n    db: Session = Depends(get_db),\n    current_user: User = Depends(get_current_admin_user)\n):\n    new_location = Location(**location_data.dict())\n    \n    db.add(new_location)\n    db.commit()\n    db.refresh(new_location)\n    \n    return LocationResponse.from_orm(new_location)\n\n\n@router.delete(\"/locations/{location_id}\", status_code=status.HTTP_204_NO_CONTENT)\nasync def delete_location(\n    location_id: int,\n    db: Session = Depends(get_db),\n    current_user: User = Depends(get_current_admin_user)\n):\n    location = db.query(Location).filter(Location.id == location_id).first()\n    \n    if not location:\n        raise HTTPException(status_code=404, detail=\"Location not found\")\n    \n    db.delete(location)\n    db.commit()\n    \n    return None\n\n\n@router.get(\"/audit\", response_model=List[AuditLogResponse])\nasync def get_audit_logs(\n    user_id: Optional[int] = Query(None),\n    action: Optional[str] = Query(None),\n    client_id: Optional[int] = Query(None),\n    limit: int = Query(50, le=100),\n    offset: int = Query(0, ge=0),\n    db: Session = Depends(get_db),\n    current_user: User = Depends(get_current_admin_user)\n):\n    from sqlalchemy.orm import joinedload\n    \n    query = db.query(AuditLog).options(joinedload(AuditLog.user))\n    \n    if user_id:\n        query = query.filter(AuditLog.actor_user_id == user_id)\n    if action:\n        query = query.filter(AuditLog.action.ilike(f\"%{action}%\"))\n    if client_id:\n        query = query.filter(AuditLog.client_id == client_id)\n    \n    logs = query.order_by(AuditLog.created_at.desc()).offset(offset).limit(limit).all()\n    \n    return [AuditLogResponse.from_orm(log) for log in logs]\n","size_bytes":10460},"apps/web/README.md":{"content":"# NovaGuardianTech - Frontend\n\nFrontend React do sistema NovaGuardianTech - SaaS de bloqueio DNS multi-cliente.\n\n## Tecnologias\n\n- **React 18** - Biblioteca UI\n- **Vite 5** - Build tool e dev server\n- **TanStack Query v5** - State management e cache\n- **React Router DOM v6** - Roteamento\n- **Tailwind CSS 3** - Estiliza√ß√£o\n- **Axios** - HTTP client\n- **Lucide React** - √çcones\n\n## Pr√©-requisitos\n\n- Node.js 18+ \n- npm ou yarn\n\n## Instala√ß√£o\n\n```bash\n# Instalar depend√™ncias\nnpm install\n\n# Copiar arquivo de ambiente\ncp .env.example .env\n```\n\n## Vari√°veis de Ambiente\n\nCrie um arquivo `.env` na raiz do projeto com:\n\n```env\nVITE_API_URL=http://localhost:8080\nVITE_USE_MOCK=false\nVITE_BRAND_NAME=NovaGuardianTech\n```\n\n## Desenvolvimento\n\n```bash\n# Iniciar servidor de desenvolvimento\nnpm run dev\n```\n\nO frontend estar√° dispon√≠vel em `http://localhost:5000`\n\n## Build para Produ√ß√£o\n\n```bash\n# Gerar build otimizado\nnpm run build\n\n# Preview do build\nnpm run preview\n```\n\n## Estrutura de Pastas\n\n```\nsrc/\n‚îú‚îÄ‚îÄ components/       # Componentes reutiliz√°veis\n‚îÇ   ‚îú‚îÄ‚îÄ ui/          # Componentes de UI base\n‚îÇ   ‚îî‚îÄ‚îÄ Layout.jsx   # Layout principal\n‚îú‚îÄ‚îÄ pages/           # P√°ginas da aplica√ß√£o\n‚îÇ   ‚îú‚îÄ‚îÄ Login.jsx\n‚îÇ   ‚îú‚îÄ‚îÄ Dashboard.jsx\n‚îÇ   ‚îú‚îÄ‚îÄ Domains.jsx\n‚îÇ   ‚îú‚îÄ‚îÄ Whitelist.jsx\n‚îÇ   ‚îî‚îÄ‚îÄ Settings.jsx\n‚îú‚îÄ‚îÄ lib/             # Utilit√°rios e configura√ß√µes\n‚îÇ   ‚îú‚îÄ‚îÄ api.js       # Cliente Axios\n‚îÇ   ‚îú‚îÄ‚îÄ queryClient.js\n‚îÇ   ‚îî‚îÄ‚îÄ utils.js\n‚îú‚îÄ‚îÄ hooks/           # React hooks customizados\n‚îÇ   ‚îî‚îÄ‚îÄ useAuth.js   # Hook de autentica√ß√£o\n‚îú‚îÄ‚îÄ App.jsx          # Componente raiz\n‚îú‚îÄ‚îÄ main.jsx         # Entry point\n‚îî‚îÄ‚îÄ index.css        # Estilos globais\n```\n\n## Rotas\n\n- `/login` - P√°gina de login\n- `/` - Dashboard (protegida)\n- `/domains` - Gerenciamento de dom√≠nios bloqueados (protegida)\n- `/whitelist` - Gerenciamento de whitelist de IPs (protegida)\n- `/settings` - Configura√ß√µes do sistema (protegida)\n\n## Autentica√ß√£o\n\nO sistema usa JWT Bearer tokens armazenados no localStorage. O interceptor do Axios adiciona automaticamente o token em todas as requisi√ß√µes.\n\nSe uma requisi√ß√£o retornar 401 (Unauthorized), o usu√°rio √© redirecionado para `/login`.\n\n## Configura√ß√£o do Vite\n\nO alias `@` est√° configurado para apontar para `./src`:\n\n```javascript\nimport Button from '@/components/ui/Button';\nimport { api } from '@/lib/api';\n```\n\n## Servidor de Desenvolvimento\n\nO Vite est√° configurado para:\n- Escutar em `0.0.0.0:5000` (acess√≠vel externamente)\n- HMR (Hot Module Replacement) com WebSocket Secure (wss)\n- Porta fixa 5000\n- `allowedHosts: true` para funcionar com proxy do Replit\n\n**Configura√ß√£o HMR para Replit:**\n```javascript\nhmr: {\n  protocol: 'wss',        // WebSocket Secure\n  host: undefined,        // Usa host atual\n  clientPort: 443,        // Porta HTTPS do Replit\n  timeout: 30000,         // 30s timeout\n}\n```\n\n## Erros Comuns e Solu√ß√µes\n\n### \"No QueryClient set\"\n\n**Erro**: `No QueryClient set, use QueryClientProvider to set one`\n\n**Solu√ß√£o**: Verifique que o `App.jsx` est√° envolvendo a aplica√ß√£o com `<QueryClientProvider client={queryClient}>`.\n\n### Imports quebrados com \"@/\"\n\n**Erro**: `Cannot find module '@/components/...'`\n\n**Solu√ß√£o**: \n1. Verifique que `vite.config.js` tem o alias configurado\n2. Verifique que `jsconfig.json` existe e tem a configura√ß√£o de paths\n\n### Porta 5000 j√° em uso\n\n**Erro**: `Port 5000 is already in use`\n\n**Solu√ß√£o**: \n```bash\n# Encontrar processo usando a porta\nlsof -i :5000\n\n# Matar o processo\nkill -9 <PID>\n\n# Ou alterar a porta no vite.config.js\n```\n\n### P√°gina recarregando constantemente\n\n**Erro**: `[vite] server connection lost. Polling for restart...` em loop\n\n**Solu√ß√£o**: J√° corrigido! O `vite.config.js` est√° configurado com HMR WebSocket Secure (wss) para funcionar com o proxy do Replit. Se ainda ocorrer, force um hard refresh (Ctrl+Shift+R).\n\n### Erro de CORS\n\n**Erro**: `Access to XMLHttpRequest at 'http://localhost:8080/...' from origin 'http://localhost:5000' has been blocked by CORS`\n\n**Solu√ß√£o**: Configure o CORS no backend FastAPI para aceitar requisi√ß√µes de `http://localhost:5000`.\n\n## Credenciais de Demonstra√ß√£o\n\nAp√≥s a API estar configurada, use:\n\n- **Admin**: `admin@novaguardian.com` / `admin123`\n- **Usu√°rio**: `user@example.com` / `user123`\n\n## Pr√≥ximos Passos\n\n1. Configure a API FastAPI (pasta `apps/api/`)\n2. Inicie o Docker Compose com PostgreSQL\n3. Execute as migrations do banco\n4. Popule o banco com dados de seed\n5. Teste o login e funcionalidades\n","size_bytes":4611},"apps/web/src/components/Layout.jsx":{"content":"import { Outlet, Link, useNavigate, useLocation } from 'react-router-dom';\nimport { Shield, Home, Globe, ListFilter, Settings, LogOut, Menu, Users as UsersIcon, Server, FileText, Building2 } from 'lucide-react';\nimport { useState } from 'react';\nimport useAuthStore from '@/hooks/useAuth';\nimport Button from '@/components/ui/Button';\n\nexport default function Layout() {\n  const [sidebarOpen, setSidebarOpen] = useState(true);\n  const { user, logout } = useAuthStore();\n  const navigate = useNavigate();\n  const location = useLocation();\n\n  const handleLogout = () => {\n    logout();\n    navigate('/login');\n  };\n\n  const navigation = [\n    { name: 'Dashboard', href: '/', icon: Home },\n    { name: 'Clientes', href: '/clients', icon: Building2 },\n    { name: 'Dom√≠nios Bloqueados', href: '/domains', icon: Globe },\n    { name: 'Whitelist de IPs', href: '/whitelist', icon: ListFilter },\n    { name: 'Inst√¢ncias Pi-hole', href: '/pihole', icon: Server, adminOnly: true },\n    { name: 'Usu√°rios', href: '/users', icon: UsersIcon, adminOnly: true },\n    { name: 'Logs de Auditoria', href: '/audit', icon: FileText },\n    { name: 'Configura√ß√µes', href: '/settings', icon: Settings },\n  ];\n\n  const isActive = (path) => {\n    return location.pathname === path;\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <div className={`fixed inset-y-0 left-0 z-50 w-64 bg-white border-r border-gray-200 transform transition-transform duration-200 ease-in-out ${sidebarOpen ? 'translate-x-0' : '-translate-x-full'}`}>\n        <div className=\"flex flex-col h-full\">\n          <div className=\"flex items-center gap-2 p-6 border-b border-gray-200\">\n            <Shield className=\"h-8 w-8 text-primary\" />\n            <span className=\"text-xl font-bold text-gray-900\">NovaGuardianTech</span>\n          </div>\n\n          <nav className=\"flex-1 p-4 space-y-1 overflow-y-auto\">\n            {navigation.map((item) => {\n              if (item.adminOnly && user?.role !== 'ADMIN') {\n                return null;\n              }\n              \n              const Icon = item.icon;\n              return (\n                <Link\n                  key={item.name}\n                  to={item.href}\n                  className={`flex items-center gap-3 px-4 py-3 text-sm font-medium rounded-lg transition-colors ${\n                    isActive(item.href)\n                      ? 'bg-primary text-white'\n                      : 'text-gray-700 hover:bg-gray-100'\n                  }`}\n                >\n                  <Icon className=\"h-5 w-5\" />\n                  {item.name}\n                </Link>\n              );\n            })}\n          </nav>\n\n          <div className=\"p-4 border-t border-gray-200\">\n            <div className=\"flex items-center gap-3 px-4 py-3 mb-2\">\n              <div className=\"flex-shrink-0 w-10 h-10 bg-primary text-white rounded-full flex items-center justify-center font-semibold\">\n                {user?.name?.charAt(0).toUpperCase() || 'U'}\n              </div>\n              <div className=\"flex-1 min-w-0\">\n                <p className=\"text-sm font-medium text-gray-900 truncate\">{user?.name || 'Usu√°rio'}</p>\n                <p className=\"text-xs text-gray-500 truncate\">{user?.email || ''}</p>\n              </div>\n            </div>\n            <Button\n              variant=\"outline\"\n              className=\"w-full justify-start\"\n              onClick={handleLogout}\n            >\n              <LogOut className=\"h-4 w-4 mr-2\" />\n              Sair\n            </Button>\n          </div>\n        </div>\n      </div>\n\n      <div className={`transition-all duration-200 ${sidebarOpen ? 'pl-64' : 'pl-0'}`}>\n        <header className=\"bg-white border-b border-gray-200 sticky top-0 z-40\">\n          <div className=\"flex items-center justify-between px-6 py-4\">\n            <button\n              onClick={() => setSidebarOpen(!sidebarOpen)}\n              className=\"p-2 text-gray-500 hover:bg-gray-100 rounded-lg\"\n            >\n              <Menu className=\"h-6 w-6\" />\n            </button>\n            \n            <div className=\"flex items-center gap-4\">\n              <div className=\"text-sm text-gray-600\">\n                Conectado como: <span className=\"font-medium text-gray-900\">{user?.role || 'USER'}</span>\n              </div>\n            </div>\n          </div>\n        </header>\n\n        <main className=\"p-6\">\n          <Outlet />\n        </main>\n      </div>\n    </div>\n  );\n}\n","size_bytes":4433},"apps/api/core/__init__.py":{"content":"# Core module","size_bytes":13},"apps/web/src/hooks/useAuth.jsx":{"content":"import { useState, useEffect, createContext, useContext } from 'react';\n\nconst AuthContext = createContext(null);\n\nexport function AuthProvider({ children }) {\n  const [user, setUser] = useState(null);\n  const [token, setToken] = useState(null);\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\n\n  useEffect(() => {\n    const storedToken = localStorage.getItem('auth_token');\n    const storedUser = localStorage.getItem('user');\n    \n    if (storedToken && storedUser) {\n      setToken(storedToken);\n      setUser(JSON.parse(storedUser));\n      setIsAuthenticated(true);\n    }\n  }, []);\n\n  const setAuth = (userData, authToken) => {\n    setUser(userData);\n    setToken(authToken);\n    setIsAuthenticated(true);\n    localStorage.setItem('auth_token', authToken);\n    localStorage.setItem('user', JSON.stringify(userData));\n  };\n\n  const logout = () => {\n    setUser(null);\n    setToken(null);\n    setIsAuthenticated(false);\n    localStorage.removeItem('auth_token');\n    localStorage.removeItem('user');\n  };\n\n  return (\n    <AuthContext.Provider value={{ user, token, isAuthenticated, setAuth, logout }}>\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nexport default function useAuthStore() {\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error('useAuthStore must be used within AuthProvider');\n  }\n  return context;\n}\n\nexport function useAuth() {\n  return useAuthStore();\n}\n","size_bytes":1426},"apps/web/src/pages/Settings.jsx":{"content":"import { Card, CardHeader, CardTitle, CardDescription, CardContent } from '@/components/ui/Card';\nimport { Settings as SettingsIcon, Server, Database, Network } from 'lucide-react';\n\nexport default function Settings() {\n  const configItems = [\n    {\n      icon: Server,\n      title: 'Servidor API',\n      value: import.meta.env.VITE_API_URL || 'http://localhost:8080',\n      description: 'Endpoint da API FastAPI',\n    },\n    {\n      icon: Database,\n      title: 'Banco de Dados',\n      value: 'PostgreSQL 16',\n      description: 'Gerenciado pelo Replit',\n    },\n    {\n      icon: Network,\n      title: 'Porta dnsdist',\n      value: '5353',\n      description: 'Porta UDP/TCP para consultas DNS',\n    },\n    {\n      icon: SettingsIcon,\n      title: 'Modo de Bloqueio',\n      value: 'NXDOMAIN',\n      description: 'Padr√£o de resposta para dom√≠nios bloqueados',\n    },\n  ];\n\n  return (\n    <div className=\"space-y-6\">\n      <div>\n        <h1 className=\"text-3xl font-bold text-gray-900\">Configura√ß√µes</h1>\n        <p className=\"text-gray-600 mt-2\">\n          Informa√ß√µes sobre a configura√ß√£o do sistema\n        </p>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        {configItems.map((item) => {\n          const Icon = item.icon;\n          return (\n            <Card key={item.title}>\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-start gap-4\">\n                  <div className=\"p-3 bg-primary/10 rounded-lg\">\n                    <Icon className=\"h-6 w-6 text-primary\" />\n                  </div>\n                  <div className=\"flex-1\">\n                    <h3 className=\"font-medium text-gray-900\">{item.title}</h3>\n                    <p className=\"text-sm text-gray-500 mt-1\">{item.description}</p>\n                    <p className=\"text-sm font-mono bg-gray-100 px-2 py-1 rounded mt-2 inline-block\">\n                      {item.value}\n                    </p>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          );\n        })}\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Vari√°veis de Ambiente</CardTitle>\n          <CardDescription>Configura√ß√£o do frontend React</CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-3\">\n            <div>\n              <dt className=\"text-sm font-medium text-gray-700\">VITE_API_URL</dt>\n              <dd className=\"text-sm text-gray-600 mt-1 font-mono bg-gray-100 px-2 py-1 rounded inline-block\">\n                {import.meta.env.VITE_API_URL || 'http://localhost:8080'}\n              </dd>\n            </div>\n            <div>\n              <dt className=\"text-sm font-medium text-gray-700\">VITE_BRAND_NAME</dt>\n              <dd className=\"text-sm text-gray-600 mt-1 font-mono bg-gray-100 px-2 py-1 rounded inline-block\">\n                {import.meta.env.VITE_BRAND_NAME || 'NovaGuardianTech'}\n              </dd>\n            </div>\n            <div>\n              <dt className=\"text-sm font-medium text-gray-700\">VITE_USE_MOCK</dt>\n              <dd className=\"text-sm text-gray-600 mt-1 font-mono bg-gray-100 px-2 py-1 rounded inline-block\">\n                {import.meta.env.VITE_USE_MOCK || 'false'}\n              </dd>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Comandos √öteis</CardTitle>\n          <CardDescription>Comandos para testes e opera√ß√£o do sistema</CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-4\">\n            <div>\n              <p className=\"text-sm font-medium text-gray-700 mb-2\">Testar bloqueio DNS (Linux/macOS):</p>\n              <code className=\"block bg-gray-900 text-gray-100 p-3 rounded text-xs overflow-x-auto\">\n                dig @127.0.0.1 -p 5353 instagram.com\n              </code>\n              <p className=\"text-xs text-gray-500 mt-1\">Deve retornar NXDOMAIN para dom√≠nios bloqueados</p>\n            </div>\n\n            <div>\n              <p className=\"text-sm font-medium text-gray-700 mb-2\">Testar DNS permitido:</p>\n              <code className=\"block bg-gray-900 text-gray-100 p-3 rounded text-xs overflow-x-auto\">\n                dig @127.0.0.1 -p 5353 google.com\n              </code>\n              <p className=\"text-xs text-gray-500 mt-1\">Deve resolver normalmente</p>\n            </div>\n\n            <div>\n              <p className=\"text-sm font-medium text-gray-700 mb-2\">Verificar status do Docker Compose:</p>\n              <code className=\"block bg-gray-900 text-gray-100 p-3 rounded text-xs overflow-x-auto\">\n                docker compose ps\n              </code>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":4796},"apps/web/src/components/ui/Badge.jsx":{"content":"import { cn } from '@/lib/utils';\n\nexport default function Badge({ children, variant = 'default', className, ...props }) {\n  const variants = {\n    default: 'bg-gray-100 text-gray-800',\n    primary: 'bg-blue-100 text-blue-800',\n    success: 'bg-green-100 text-green-800',\n    warning: 'bg-yellow-100 text-yellow-800',\n    danger: 'bg-red-100 text-red-800',\n    purple: 'bg-purple-100 text-purple-800',\n  };\n\n  return (\n    <span\n      className={cn(\n        'inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium',\n        variants[variant],\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </span>\n  );\n}\n","size_bytes":646},"apps/api/routers/whitelist.py":{"content":"from fastapi import APIRouter, Depends, HTTPException, status\nfrom sqlalchemy.orm import Session\nfrom typing import List\nfrom core.database import get_db\nfrom core.security import get_current_user\nfrom models.user import User, UserRole\nfrom models.ip_whitelist import IpWhitelist\nfrom models.client import Client\nfrom schemas.ip_whitelist import IpWhitelistCreate, IpWhitelistResponse\n\nrouter = APIRouter(prefix=\"/whitelist\", tags=[\"IP Whitelist\"])\n\n\ndef get_user_client_id(user: User, client_id: int = None) -> int:\n    if user.role == UserRole.ADMIN:\n        if client_id is not None:\n            return client_id\n        if user.client_id is not None:\n            return user.client_id\n        raise HTTPException(status_code=400, detail=\"Admin must specify client_id or have a default client\")\n    else:\n        if user.client_id is None:\n            raise HTTPException(status_code=400, detail=\"User not assigned to any client\")\n        return user.client_id\n\n\n@router.get(\"\", response_model=List[IpWhitelistResponse])\nasync def list_whitelist(\n    client_id: int = None,\n    db: Session = Depends(get_db),\n    current_user: User = Depends(get_current_user)\n):\n    client_id = get_user_client_id(current_user, client_id)\n    whitelist = db.query(IpWhitelist).filter(IpWhitelist.client_id == client_id).all()\n    return [IpWhitelistResponse.from_orm(w) for w in whitelist]\n\n\n@router.post(\"\", response_model=IpWhitelistResponse, status_code=status.HTTP_201_CREATED)\nasync def create_whitelist_entry(\n    whitelist_data: IpWhitelistCreate,\n    db: Session = Depends(get_db),\n    current_user: User = Depends(get_current_user)\n):\n    client_id = get_user_client_id(current_user, whitelist_data.client_id)\n    \n    new_entry = IpWhitelist(\n        client_id=client_id,\n        ip_address=whitelist_data.ip_address,\n        label=whitelist_data.label,\n        created_by=current_user.id\n    )\n    \n    db.add(new_entry)\n    db.commit()\n    db.refresh(new_entry)\n    \n    return IpWhitelistResponse.from_orm(new_entry)\n\n\n@router.delete(\"/{whitelist_id}\", status_code=status.HTTP_204_NO_CONTENT)\nasync def delete_whitelist_entry(\n    whitelist_id: int,\n    db: Session = Depends(get_db),\n    current_user: User = Depends(get_current_user)\n):\n    entry = db.query(IpWhitelist).filter(IpWhitelist.id == whitelist_id).first()\n    \n    if not entry:\n        raise HTTPException(status_code=404, detail=\"Whitelist entry not found\")\n    \n    if current_user.role != UserRole.ADMIN:\n        if current_user.client_id != entry.client_id:\n            raise HTTPException(status_code=403, detail=\"Not authorized to delete this entry\")\n    \n    db.delete(entry)\n    db.commit()\n    \n    return None\n","size_bytes":2685},"apps/web/src/App.jsx":{"content":"import { BrowserRouter, Routes, Route, Navigate } from 'react-router-dom';\nimport { QueryClientProvider } from '@tanstack/react-query';\nimport { ReactQueryDevtools } from '@tanstack/react-query-devtools';\nimport { queryClient } from '@/lib/queryClient';\nimport { AuthProvider } from '@/hooks/useAuth';\nimport useAuthStore from '@/hooks/useAuth';\nimport Layout from '@/components/Layout';\nimport Login from '@/pages/Login';\nimport Dashboard from '@/pages/Dashboard';\nimport Clients from '@/pages/Clients';\nimport Domains from '@/pages/Domains';\nimport Whitelist from '@/pages/Whitelist';\nimport PiholeInstances from '@/pages/PiholeInstances';\nimport Users from '@/pages/Users';\nimport Audit from '@/pages/Audit';\nimport Settings from '@/pages/Settings';\n\nfunction ProtectedRoute({ children }) {\n  const { isAuthenticated } = useAuthStore();\n  const token = localStorage.getItem('auth_token');\n  \n  if (!isAuthenticated && !token) {\n    return <Navigate to=\"/login\" replace />;\n  }\n\n  return children;\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <AuthProvider>\n        <BrowserRouter>\n          <Routes>\n            <Route path=\"/login\" element={<Login />} />\n            \n            <Route\n              path=\"/\"\n              element={\n                <ProtectedRoute>\n                  <Layout />\n                </ProtectedRoute>\n              }\n            >\n              <Route index element={<Dashboard />} />\n              <Route path=\"clients\" element={<Clients />} />\n              <Route path=\"domains\" element={<Domains />} />\n              <Route path=\"whitelist\" element={<Whitelist />} />\n              <Route path=\"pihole\" element={<PiholeInstances />} />\n              <Route path=\"users\" element={<Users />} />\n              <Route path=\"audit\" element={<Audit />} />\n              <Route path=\"settings\" element={<Settings />} />\n            </Route>\n\n            <Route path=\"*\" element={<Navigate to=\"/\" replace />} />\n          </Routes>\n        </BrowserRouter>\n        <ReactQueryDevtools initialIsOpen={false} />\n      </AuthProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","size_bytes":2155},"apps/web/src/lib/api.js":{"content":"import axios from 'axios';\n\nconst API_URL = import.meta.env.VITE_API_URL || 'http://localhost:8080';\n\nexport const api = axios.create({\n  baseURL: API_URL,\n  headers: {\n    'Content-Type': 'application/json',\n  },\n});\n\napi.interceptors.request.use(\n  (config) => {\n    const token = localStorage.getItem('auth_token');\n    if (token) {\n      config.headers.Authorization = `Bearer ${token}`;\n    }\n    return config;\n  },\n  (error) => {\n    return Promise.reject(error);\n  }\n);\n\napi.interceptors.response.use(\n  (response) => response,\n  (error) => {\n    if (error.response?.status === 401) {\n      localStorage.removeItem('auth_token');\n      localStorage.removeItem('user');\n      window.location.href = '/login';\n    }\n    return Promise.reject(error);\n  }\n);\n\nexport default api;\n","size_bytes":784},"apps/api/services/pihole.py":{"content":"import subprocess\nfrom typing import List, Dict, Any\nfrom models.domain_rule import DomainRule, DomainKind\n\n\nclass PiholeService:\n    def __init__(self, container_name: str):\n        self.container_name = container_name\n    \n    def exec_command(self, command: List[str]) -> Dict[str, Any]:\n        try:\n            full_command = [\"docker\", \"exec\", self.container_name] + command\n            \n            result = subprocess.run(\n                full_command,\n                capture_output=True,\n                text=True,\n                timeout=30\n            )\n            \n            return {\n                \"success\": result.returncode == 0,\n                \"stdout\": result.stdout,\n                \"stderr\": result.stderr,\n                \"returncode\": result.returncode\n            }\n        except subprocess.TimeoutExpired:\n            return {\n                \"success\": False,\n                \"stdout\": \"\",\n                \"stderr\": \"Command timed out after 30 seconds\",\n                \"returncode\": -1\n            }\n        except Exception as e:\n            return {\n                \"success\": False,\n                \"stdout\": \"\",\n                \"stderr\": str(e),\n                \"returncode\": -1\n            }\n    \n    def add_domain_to_blocklist(self, domain: str, kind: DomainKind) -> Dict[str, Any]:\n        if kind == DomainKind.EXACT:\n            command = [\"pihole\", \"-b\", domain]\n        else:\n            command = [\"pihole\", \"-regex\", domain]\n        \n        result = self.exec_command(command)\n        return result\n    \n    def remove_domain_from_blocklist(self, domain: str, kind: DomainKind) -> Dict[str, Any]:\n        if kind == DomainKind.EXACT:\n            command = [\"pihole\", \"-b\", \"-d\", domain]\n        else:\n            command = [\"pihole\", \"-regex\", \"-d\", domain]\n        \n        result = self.exec_command(command)\n        return result\n    \n    def sync_domains(self, domains: List[DomainRule]) -> Dict[str, Any]:\n        results = {\n            \"added\": [],\n            \"failed\": [],\n            \"total\": len(domains)\n        }\n        \n        exact_domains = [d for d in domains if d.kind == DomainKind.EXACT]\n        regex_domains = [d for d in domains if d.kind == DomainKind.REGEX]\n        \n        current_exact = self._get_current_blocklist()\n        current_regex = self._get_current_regex()\n        \n        new_exact_set = {d.domain for d in exact_domains}\n        new_regex_set = {d.domain for d in regex_domains}\n        \n        to_remove_exact = current_exact - new_exact_set\n        to_add_exact = new_exact_set - current_exact\n        \n        to_remove_regex = current_regex - new_regex_set\n        to_add_regex = new_regex_set - current_regex\n        \n        for domain in to_remove_exact:\n            result = self.exec_command([\"pihole\", \"-b\", \"-d\", domain])\n            if not result[\"success\"]:\n                results[\"failed\"].append({\n                    \"domain\": domain,\n                    \"kind\": \"EXACT\",\n                    \"action\": \"remove\",\n                    \"error\": result[\"stderr\"]\n                })\n        \n        for domain in to_add_exact:\n            result = self.exec_command([\"pihole\", \"-b\", domain, \"--comment\", \"NovaGuardian\"])\n            if result[\"success\"]:\n                results[\"added\"].append({\"domain\": domain, \"kind\": \"EXACT\"})\n            else:\n                results[\"failed\"].append({\n                    \"domain\": domain,\n                    \"kind\": \"EXACT\",\n                    \"action\": \"add\",\n                    \"error\": result[\"stderr\"]\n                })\n        \n        for domain in to_remove_regex:\n            result = self.exec_command([\"pihole\", \"-regex\", \"-d\", domain])\n            if not result[\"success\"]:\n                results[\"failed\"].append({\n                    \"domain\": domain,\n                    \"kind\": \"REGEX\",\n                    \"action\": \"remove\",\n                    \"error\": result[\"stderr\"]\n                })\n        \n        for domain in to_add_regex:\n            result = self.exec_command([\"pihole\", \"-regex\", domain, \"--comment\", \"NovaGuardian\"])\n            if result[\"success\"]:\n                results[\"added\"].append({\"domain\": domain, \"kind\": \"REGEX\"})\n            else:\n                results[\"failed\"].append({\n                    \"domain\": domain,\n                    \"kind\": \"REGEX\",\n                    \"action\": \"add\",\n                    \"error\": result[\"stderr\"]\n                })\n        \n        reload_result = self.exec_command([\"pihole\", \"restartdns\", \"reload-lists\"])\n        \n        if not reload_result[\"success\"]:\n            results[\"warning\"] = \"Domains updated but DNS reload failed\"\n        \n        return results\n    \n    def _get_current_blocklist(self) -> set:\n        result = self.exec_command([\n            \"sqlite3\",\n            \"/etc/pihole/gravity.db\",\n            \"SELECT domain FROM domainlist WHERE type=1 AND comment='NovaGuardian';\"\n        ])\n        \n        if result[\"success\"] and result[\"stdout\"]:\n            return set(result[\"stdout\"].strip().split(\"\\n\"))\n        return set()\n    \n    def _get_current_regex(self) -> set:\n        result = self.exec_command([\n            \"sqlite3\",\n            \"/etc/pihole/gravity.db\",\n            \"SELECT domain FROM domainlist WHERE type=3 AND comment='NovaGuardian';\"\n        ])\n        \n        if result[\"success\"] and result[\"stdout\"]:\n            return set(result[\"stdout\"].strip().split(\"\\n\"))\n        return set()\n    \n    def clear_all_domains(self) -> Dict[str, Any]:\n        clear_exact = self.exec_command([\"pihole\", \"-b\", \"-l\"])\n        clear_regex = self.exec_command([\"pihole\", \"-regex\", \"-l\"])\n        \n        reload = self.exec_command([\"pihole\", \"restartdns\", \"reload\"])\n        \n        return {\n            \"success\": clear_exact[\"success\"] and clear_regex[\"success\"],\n            \"message\": \"All domains cleared and DNS restarted\"\n        }\n    \n    def get_stats(self) -> Dict[str, Any]:\n        result = self.exec_command([\"pihole\", \"-c\", \"-j\"])\n        \n        if result[\"success\"]:\n            import json\n            try:\n                stats = json.loads(result[\"stdout\"])\n                return {\n                    \"success\": True,\n                    \"stats\": stats\n                }\n            except json.JSONDecodeError:\n                return {\n                    \"success\": False,\n                    \"error\": \"Failed to parse Pi-hole stats\"\n                }\n        \n        return {\n            \"success\": False,\n            \"error\": result[\"stderr\"]\n        }\n    \n    def is_running(self) -> bool:\n        result = subprocess.run(\n            [\"docker\", \"ps\", \"--filter\", f\"name={self.container_name}\", \"--format\", \"{{.Names}}\"],\n            capture_output=True,\n            text=True\n        )\n        \n        return self.container_name in result.stdout\n","size_bytes":6847},"apps/web/src/main.jsx":{"content":"import React from 'react'\nimport ReactDOM from 'react-dom/client'\nimport App from './App.jsx'\nimport './index.css'\n\nReactDOM.createRoot(document.getElementById('root')).render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n)\n","size_bytes":235},"apps/api/schemas/user.py":{"content":"from pydantic import BaseModel, EmailStr\nfrom datetime import datetime\nfrom typing import Optional\nfrom models.user import UserRole\n\n\nclass UserBase(BaseModel):\n    email: EmailStr\n    name: str\n\n\nclass UserCreate(UserBase):\n    password: str\n    role: UserRole = UserRole.USER\n\n\nclass UserUpdate(BaseModel):\n    name: Optional[str] = None\n    email: Optional[EmailStr] = None\n    password: Optional[str] = None\n    role: Optional[UserRole] = None\n\n\nclass UserResponse(UserBase):\n    id: int\n    role: UserRole\n    created_at: datetime\n    updated_at: datetime\n\n    class Config:\n        from_attributes = True\n\n\nclass TokenResponse(BaseModel):\n    access_token: str\n    token_type: str = \"bearer\"\n    user: UserResponse\n","size_bytes":721},"apps/api/models/location.py":{"content":"from sqlalchemy import Column, Integer, String, Boolean, DateTime, ForeignKey\nfrom sqlalchemy.sql import func\nfrom sqlalchemy.orm import relationship\nfrom core.database import Base\n\n\nclass Location(Base):\n    __tablename__ = \"locations\"\n\n    id = Column(Integer, primary_key=True, index=True)\n    client_id = Column(Integer, ForeignKey(\"clients.id\", ondelete=\"CASCADE\"), nullable=False)\n    label = Column(String(255), nullable=False)\n    public_ip = Column(String(45), nullable=True)\n    is_active = Column(Boolean, default=True, nullable=False)\n    created_at = Column(DateTime(timezone=True), server_default=func.now())\n    \n    # Relationships\n    client = relationship(\"Client\", back_populates=\"locations\")\n","size_bytes":712},"apps/api/routers/admin_pihole.py":{"content":"from fastapi import APIRouter, Depends, HTTPException\nfrom sqlalchemy.orm import Session\nfrom typing import List, Dict, Any\nfrom core.database import get_db\nfrom core.security import get_current_user\nfrom models.user import User, UserRole\nfrom services.pihole_manager import PiholeManager\nfrom pydantic import BaseModel\n\nrouter = APIRouter(prefix=\"/admin/pihole\", tags=[\"Admin - Pi-hole\"])\n\n\nclass ProvisionRequest(BaseModel):\n    client_id: int\n    public_ip: str\n    password: str = \"novaguardian123\"\n\n\nclass ProvisionResponse(BaseModel):\n    id: int\n    client_id: int\n    client_name: str\n    container_name: str\n    internal_ip: str\n    public_ip: str\n    dns_port: int\n    web_port: int\n    web_url: str\n    status: str\n    container_id: str\n\n\nclass DeprovisionResponse(BaseModel):\n    success: bool\n    message: str\n    container_name: str\n\n\nclass InstanceStatusResponse(BaseModel):\n    status: str\n    running: bool\n    health: str | None = None\n    container_id: str | None = None\n\n\ndef require_admin(current_user: User = Depends(get_current_user)) -> User:\n    if current_user.role != UserRole.ADMIN:\n        raise HTTPException(status_code=403, detail=\"Admin access required\")\n    return current_user\n\n\n@router.post(\"/provision\", response_model=ProvisionResponse)\nasync def provision_pihole_instance(\n    request: ProvisionRequest,\n    db: Session = Depends(get_db),\n    current_user: User = Depends(require_admin)\n):\n    try:\n        manager = PiholeManager()\n        result = manager.provision_instance(\n            db=db,\n            client_id=request.client_id,\n            public_ip=request.public_ip,\n            password=request.password\n        )\n        return result\n    except ValueError as e:\n        raise HTTPException(status_code=400, detail=str(e))\n    except Exception as e:\n        raise HTTPException(status_code=500, detail=f\"Failed to provision instance: {str(e)}\")\n\n\n@router.delete(\"/{client_id}\", response_model=DeprovisionResponse)\nasync def deprovision_pihole_instance(\n    client_id: int,\n    db: Session = Depends(get_db),\n    current_user: User = Depends(require_admin)\n):\n    try:\n        manager = PiholeManager()\n        result = manager.deprovision_instance(db=db, client_id=client_id)\n        return result\n    except ValueError as e:\n        raise HTTPException(status_code=404, detail=str(e))\n    except Exception as e:\n        raise HTTPException(status_code=500, detail=f\"Failed to deprovision instance: {str(e)}\")\n\n\n@router.get(\"/list\")\nasync def list_pihole_instances(\n    db: Session = Depends(get_db),\n    current_user: User = Depends(require_admin)\n):\n    try:\n        manager = PiholeManager()\n        instances = manager.list_instances(db=db)\n        return {\n            \"total\": len(instances),\n            \"instances\": instances\n        }\n    except Exception as e:\n        raise HTTPException(status_code=500, detail=f\"Failed to list instances: {str(e)}\")\n\n\n@router.post(\"/{container_name}/restart\")\nasync def restart_pihole_instance(\n    container_name: str,\n    current_user: User = Depends(require_admin)\n):\n    try:\n        manager = PiholeManager()\n        result = manager.restart_instance(container_name=container_name)\n        return result\n    except ValueError as e:\n        raise HTTPException(status_code=404, detail=str(e))\n    except Exception as e:\n        raise HTTPException(status_code=500, detail=f\"Failed to restart instance: {str(e)}\")\n\n\n@router.get(\"/{container_name}/status\", response_model=InstanceStatusResponse)\nasync def get_instance_status(\n    container_name: str,\n    current_user: User = Depends(require_admin)\n):\n    try:\n        manager = PiholeManager()\n        status = manager.get_instance_status(container_name=container_name)\n        return status\n    except Exception as e:\n        raise HTTPException(status_code=500, detail=f\"Failed to get status: {str(e)}\")\n\n\n@router.post(\"/dnsdist/update-config\")\nasync def update_dnsdist_configuration(\n    db: Session = Depends(get_db),\n    current_user: User = Depends(require_admin)\n):\n    try:\n        manager = PiholeManager()\n        result = manager.update_dnsdist_config(db=db)\n        return {\n            \"success\": True,\n            \"instances_count\": result[\"instances_count\"],\n            \"pools\": result[\"pools\"],\n            \"message\": f\"dnsdist config generated for {result['instances_count']} instances\",\n            \"config_preview\": result[\"config\"][:500] + \"...\",\n        }\n    except Exception as e:\n        raise HTTPException(status_code=500, detail=f\"Failed to update config: {str(e)}\")\n","size_bytes":4548},"apps/api/routers/__init__.py":{"content":"# Routers module","size_bytes":16},"apps/web/src/components/ui/Dialog.jsx":{"content":"import { X } from 'lucide-react';\nimport { cn } from '@/lib/utils';\nimport Button from './Button';\n\nexport function Dialog({ open, onClose, children, className }) {\n  if (!open) return null;\n\n  return (\n    <div className=\"fixed inset-0 z-50 overflow-y-auto\">\n      <div className=\"flex min-h-screen items-center justify-center p-4\">\n        <div\n          className=\"fixed inset-0 bg-black bg-opacity-50 transition-opacity\"\n          onClick={onClose}\n        />\n        <div\n          className={cn(\n            'relative bg-white rounded-lg shadow-xl max-w-lg w-full',\n            className\n          )}\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport function DialogHeader({ children, className }) {\n  return (\n    <div className={cn('px-6 py-4 border-b border-gray-200', className)}>\n      {children}\n    </div>\n  );\n}\n\nexport function DialogTitle({ children, onClose, className }) {\n  return (\n    <div className=\"flex items-center justify-between\">\n      <h3 className={cn('text-lg font-semibold text-gray-900', className)}>\n        {children}\n      </h3>\n      {onClose && (\n        <button\n          onClick={onClose}\n          className=\"text-gray-400 hover:text-gray-500 transition-colors\"\n        >\n          <X className=\"h-5 w-5\" />\n        </button>\n      )}\n    </div>\n  );\n}\n\nexport function DialogContent({ children, className }) {\n  return (\n    <div className={cn('px-6 py-4', className)}>\n      {children}\n    </div>\n  );\n}\n\nexport function DialogFooter({ children, className }) {\n  return (\n    <div className={cn('px-6 py-4 bg-gray-50 flex items-center justify-end gap-3 rounded-b-lg', className)}>\n      {children}\n    </div>\n  );\n}\n","size_bytes":1694},"infra/pihole/README.md":{"content":"# Pi-hole Configuration\n\n## Configura√ß√£o Inicial Manual\n\nAp√≥s `docker-compose up`, execute uma vez:\n\n```bash\n# Configurar senha admin\ndocker exec pihole-demo pihole -a -p novaguardian123\n\n# Configurar modo de bloqueio NXDOMAIN\ndocker exec pihole-demo pihole -a setdns 1.1.1.1 8.8.8.8\n\n# Habilitar query logging\ndocker exec pihole-demo pihole logging on\n\n# Configurar blocking mode para NXDOMAIN\ndocker exec pihole-demo pihole -a -b nxdomain\n```\n\n## Sincroniza√ß√£o de Dom√≠nios\n\nA API sincroniza dom√≠nios via endpoint `/dns/sync`:\n\n1. Escreve dom√≠nios EXACT em `/etc/pihole/custom.list`\n2. Escreve dom√≠nios REGEX em `/etc/pihole/regex.list`\n3. Executa `pihole -g` para atualizar gravity database\n4. Dom√≠nios persistem entre restarts\n\n## Acesso Web\n\n- URL: http://localhost:8081/admin\n- Senha: `novaguardian123`\n\n## Testar Bloqueio\n\n```bash\n# Via API (ap√≥s adicionar dom√≠nio e sincronizar)\ncurl -X POST http://localhost:8080/dns/sync \\\n  -H \"Authorization: Bearer <token>\"\n\n# Via DNS direto\ndig @127.0.0.1 -p 5353 instagram.com  # Deve retornar NXDOMAIN se bloqueado\n```\n","size_bytes":1079},"apps/api/main.py":{"content":"from fastapi import FastAPI\nfrom fastapi.middleware.cors import CORSMiddleware\nfrom core.config import settings\nfrom routers import auth, domains, whitelist, dns, admin, admin_pihole, stats\n\napp = FastAPI(\n    title=\"NovaGuardianTech API\",\n    description=\"API for DNS blocking management with multi-client support\",\n    version=\"1.0.0\",\n    docs_url=\"/docs\",\n    redoc_url=\"/redoc\",\n)\n\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=settings.cors_origins_list,\n    allow_credentials=True,\n    allow_methods=[\"*\"],\n    allow_headers=[\"*\"],\n)\n\napp.include_router(auth.router)\napp.include_router(domains.router)\napp.include_router(whitelist.router)\napp.include_router(dns.router)\napp.include_router(admin.router)\napp.include_router(admin_pihole.router)\napp.include_router(stats.router)\n\n\n@app.get(\"/\")\nasync def root():\n    return {\n        \"message\": \"NovaGuardianTech API\",\n        \"version\": \"1.0.0\",\n        \"docs\": \"/docs\",\n        \"health\": \"ok\"\n    }\n\n\n@app.get(\"/health\")\nasync def health_check():\n    return {\"status\": \"healthy\"}\n\n\nif __name__ == \"__main__\":\n    import uvicorn\n    uvicorn.run(\n        \"main:app\",\n        host=settings.API_HOST,\n        port=settings.API_PORT,\n        reload=settings.API_RELOAD\n    )\n","size_bytes":1238},"main.py":{"content":"def main():\n    print(\"Hello from repl-nix-workspace!\")\n\n\nif __name__ == \"__main__\":\n    main()\n","size_bytes":96},"README.md":{"content":"# NovaGuardianTech - SaaS de Bloqueio DNS Multi-Cliente\n\nSistema completo de bloqueio DNS empresarial com suporte multi-cliente, roteamento inteligente por IP de origem, e gerenciamento centralizado via painel web.\n\n## üöÄ Status do Projeto\n\n**Vers√£o**: 1.0.0-alpha  \n**Status**: Fase A Conclu√≠da ‚úÖ | Fase B e C em Desenvolvimento\n\n### Fases Completadas\n\n- ‚úÖ **Fase A**: Frontend React funcional com autentica√ß√£o, CRUD de dom√≠nios/whitelist, TanStack Query\n- üîÑ **Fase B**: API FastAPI com PostgreSQL (em desenvolvimento)\n- üìã **Fase C**: Infraestrutura DNS (dnsdist + Pi-hole) (planejada)\n- üìã **Fase D**: Blueprint de produ√ß√£o (planejada)\n- üìã **Fase E**: Observabilidade & Seguran√ßa (planejada)\n\n## üìã Vis√£o Geral\n\nNovaGuardianTech permite que empresas gerenciem bloqueio DNS por cliente com:\n\n- **Painel Web Administrativo**: Interface React moderna para gerenciar regras\n- **API REST Robusta**: FastAPI com autentica√ß√£o JWT e RBAC\n- **Roteamento Inteligente**: dnsdist roteia por IP de origem para inst√¢ncias Pi-hole dedicadas\n- **Multi-Cliente**: Cada cliente tem sua pr√≥pria inst√¢ncia Pi-hole e regras\n- **Whitelist por Cliente**: Controle granular de quais IPs podem usar o DNS\n- **Auditoria Completa**: Log de todas as a√ß√µes administrativas\n\n## üèóÔ∏è Arquitetura\n\n```\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ  Frontend   ‚îÇ  React 18 + Vite + TanStack Query\n‚îÇ  (Port 5000)‚îÇ  Autentica√ß√£o JWT + Rotas Protegidas\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n       ‚îÇ\n       ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n       ‚îÇ                             ‚îÇ\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ  API FastAPI‚îÇ              ‚îÇ  PostgreSQL ‚îÇ\n‚îÇ  (Port 8080)‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ  (Port 5432)‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n       ‚îÇ\n       ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n       ‚îÇ                                    ‚îÇ\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ   dnsdist   ‚îÇ                    ‚îÇ  Pi-hole Demo  ‚îÇ\n‚îÇ  (Port 5353)‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ   Container    ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n  Roteamento por IP                  Bloqueio DNS\n```\n\n## üõ†Ô∏è Stack Tecnol√≥gico\n\n### Frontend\n- **React 18** - UI library\n- **Vite 5** - Build tool e dev server\n- **TanStack Query v5** - State management e cache\n- **React Router DOM v6** - Roteamento\n- **Tailwind CSS 3** - Estiliza√ß√£o\n- **Axios** - HTTP client\n- **Lucide React** - √çcones\n\n### Backend\n- **Python 3.11** - Linguagem\n- **FastAPI** - Framework web\n- **SQLAlchemy 2.0** - ORM\n- **Alembic** - Migrations\n- **PostgreSQL 16** - Banco de dados\n- **python-jose** - JWT tokens\n- **passlib + bcrypt** - Hash de senhas\n\n### Infraestrutura\n- **Docker Compose** - Orquestra√ß√£o\n- **dnsdist** - Roteamento DNS\n- **Pi-hole** - Bloqueio DNS\n- **Nginx** (produ√ß√£o) - Reverse proxy\n\n## üìÅ Estrutura do Projeto\n\n```\nNovaGuardianTech/\n‚îú‚îÄ‚îÄ apps/\n‚îÇ   ‚îú‚îÄ‚îÄ web/              # Frontend React\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ src/\n‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/  # Componentes reutiliz√°veis\n‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pages/       # P√°ginas (Login, Dashboard, etc)\n‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ lib/         # API client, utils\n‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hooks/       # React hooks customizados\n‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.css    # Estilos globais Tailwind\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ package.json\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ vite.config.js\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ README.md\n‚îÇ   ‚îÇ\n‚îÇ   ‚îî‚îÄ‚îÄ api/              # Backend FastAPI\n‚îÇ       ‚îú‚îÄ‚îÄ routers/      # Endpoints da API\n‚îÇ       ‚îú‚îÄ‚îÄ services/     # L√≥gica de neg√≥cio\n‚îÇ       ‚îú‚îÄ‚îÄ repositories/ # Acesso ao banco\n‚îÇ       ‚îú‚îÄ‚îÄ models/       # SQLAlchemy models\n‚îÇ       ‚îú‚îÄ‚îÄ schemas/      # Pydantic schemas\n‚îÇ       ‚îú‚îÄ‚îÄ core/         # Config, DB, Security\n‚îÇ       ‚îú‚îÄ‚îÄ migrations/   # Alembic migrations\n‚îÇ       ‚îú‚îÄ‚îÄ main.py\n‚îÇ       ‚îî‚îÄ‚îÄ requirements.txt\n‚îÇ\n‚îú‚îÄ‚îÄ infra/\n‚îÇ   ‚îú‚îÄ‚îÄ docker-compose.yml    # Orquestra√ß√£o completa\n‚îÇ   ‚îú‚îÄ‚îÄ dnsdist/\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ dnsdist.conf.dev  # Config roteamento\n‚îÇ   ‚îî‚îÄ‚îÄ pihole/\n‚îÇ       ‚îî‚îÄ‚îÄ demo/             # Container demo\n‚îÇ\n‚îú‚îÄ‚îÄ tools/\n‚îÇ   ‚îú‚îÄ‚îÄ seed.py              # Popular banco de dados\n‚îÇ   ‚îú‚îÄ‚îÄ backup_postgres.sh   # Backup PostgreSQL\n‚îÇ   ‚îî‚îÄ‚îÄ pihole_exec.py       # Helper para comandos Pi-hole\n‚îÇ\n‚îú‚îÄ‚îÄ .env.example             # Template de vari√°veis\n‚îú‚îÄ‚îÄ Makefile                 # Comandos √∫teis\n‚îú‚îÄ‚îÄ replit.md               # Documenta√ß√£o do projeto\n‚îî‚îÄ‚îÄ README.md               # Este arquivo\n```\n\n## üöÄ In√≠cio R√°pido\n\n### Pr√©-requisitos\n\n- **Node.js 18+** e npm\n- **Python 3.11+**\n- **Docker** e Docker Compose\n- **PostgreSQL 16** (ou usar container)\n\n### 1. Frontend (Desenvolvimento)\n\n```bash\n# Navegar para o frontend\ncd apps/web\n\n# Instalar depend√™ncias\nnpm install\n\n# Copiar arquivo de ambiente\ncp .env.example .env\n\n# Iniciar dev server\nnpm run dev\n```\n\nFrontend dispon√≠vel em: `http://localhost:5000`\n\n### 2. Backend (Desenvolvimento)\n\n```bash\n# Navegar para o backend\ncd apps/api\n\n# Criar ambiente virtual\npython -m venv venv\nsource venv/bin/activate  # Linux/Mac\n# ou\nvenv\\Scripts\\activate  # Windows\n\n# Instalar depend√™ncias\npip install -r requirements.txt\n\n# Copiar arquivo de ambiente\ncp .env.example .env\n\n# Rodar migrations\nalembic upgrade head\n\n# Popular banco com dados demo\npython -m tools.seed\n\n# Iniciar servidor\nuvicorn main:app --reload --port 8080\n```\n\nAPI dispon√≠vel em: `http://localhost:8080/docs` (OpenAPI)\n\n### 3. Stack Completa (Docker Compose)\n\n```bash\n# Copiar arquivo de ambiente\ncp .env.example .env\n\n# Subir todos os containers\nmake dev\n# ou\ndocker compose up -d --build\n\n# Popular banco de dados\nmake seed\n\n# Ver logs\ndocker compose logs -f\n\n# Parar containers\ndocker compose down\n```\n\n## üîë Vari√°veis de Ambiente\n\n### Frontend (apps/web/.env)\n\n```env\nVITE_API_URL=http://localhost:8080\nVITE_USE_MOCK=false\nVITE_BRAND_NAME=NovaGuardianTech\n```\n\n### Backend (apps/api/.env)\n\n```env\nDATABASE_URL=postgresql+psycopg://novaguard:novaguard@localhost:5432/novaguard\nJWT_SECRET=troque_este_segredo_em_producao\nJWT_ALGORITHM=HS256\nJWT_EXPIRE_MINUTES=1440\nAPI_PORT=8080\nCORS_ORIGINS=http://localhost:5000,http://localhost:3000\n```\n\n### Infraestrutura (.env raiz)\n\n```env\n# API\nAPI_PORT=8080\nJWT_SECRET=troque_este_segredo\n\n# PostgreSQL\nPOSTGRES_HOST=db\nPOSTGRES_PORT=5432\nPOSTGRES_DB=novaguard\nPOSTGRES_USER=novaguard\nPOSTGRES_PASSWORD=novaguard\nDATABASE_URL=postgresql+psycopg://novaguard:novaguard@db:5432/novaguard\n\n# DNS\nPUBLIC_IP_DEMO=203.0.113.10\nPIHOLE_DEMO_CONTAINER=pihole_cliente_demo\nDNSDIST_LISTEN_PORT_DEV=5353\n\n# Frontend\nVITE_API_URL=http://localhost:8080\nVITE_USE_MOCK=false\nVITE_BRAND_NAME=NovaGuardianTech\n```\n\n## üë§ Credenciais de Demonstra√ß√£o\n\nAp√≥s rodar o seed script:\n\n- **Admin**: `admin@novaguardian.com` / `admin123`\n- **Usu√°rio**: `user@example.com` / `user123`\n\n## üìä Modelo de Dados\n\n### Principais Entidades\n\n**users**: Usu√°rios do sistema  \n- Campos: id, name, email (unique), password_hash, role (ADMIN/USER), created_at, updated_at\n\n**clients**: Clientes/empresas  \n- Campos: id, name, slug, is_active, created_at\n\n**locations**: Localiza√ß√µes f√≠sicas dos clientes  \n- Campos: id, client_id, label, public_ip, is_active, created_at\n\n**pihole_instances**: Metadados das inst√¢ncias Pi-hole  \n- Campos: id, client_id, container_name, upstream_dns1, upstream_dns2, mode (NXDOMAIN/NULL), created_at\n\n**domain_rules**: Regras de bloqueio  \n- Campos: id, client_id, domain, kind (EXACT/REGEX), status (ACTIVE/INACTIVE), reason, created_by, created_at, updated_at\n\n**ip_whitelist**: IPs autorizados por cliente  \n- Campos: id, client_id, ip_address, label, created_by, created_at\n\n**audit_logs**: Logs de auditoria  \n- Campos: id, actor_user_id, client_id, action, payload_json, created_at\n\n## üîå API Endpoints\n\n### Autentica√ß√£o\n- `POST /auth/login` - Login (retorna JWT)\n- `POST /auth/logout` - Logout\n- `GET /auth/me` - Dados do usu√°rio autenticado\n\n### Dom√≠nios\n- `GET /domains` - Listar dom√≠nios bloqueados\n- `POST /domains` - Adicionar dom√≠nio\n- `PATCH /domains/{id}` - Atualizar dom√≠nio\n- `DELETE /domains/{id}` - Remover dom√≠nio\n\n### Whitelist\n- `GET /whitelist` - Listar IPs autorizados\n- `POST /whitelist` - Adicionar IP\n- `DELETE /whitelist/{id}` - Remover IP\n\n### DNS\n- `GET /dns/my-ip` - Obter IP p√∫blico do cliente\n- `POST /dns/apply` - Aplicar regras no Pi-hole\n\n### Admin (apenas ADMIN role)\n- `GET /users` - Listar usu√°rios\n- `POST /users` - Criar usu√°rio\n- `GET /clients` - Listar clientes\n- `GET /locations` - Listar localiza√ß√µes\n- `POST /locations` - Criar localiza√ß√£o\n- `DELETE /locations/{id}` - Remover localiza√ß√£o\n\n## üß™ Testes DNS\n\n### Testar Bloqueio (Linux/macOS)\n\n```bash\n# Bloquear um dom√≠nio via painel web primeiro\n# Depois testar:\n\n# Deve retornar NXDOMAIN (bloqueado)\ndig @127.0.0.1 -p 5353 instagram.com\n\n# Deve resolver normalmente (permitido)\ndig @127.0.0.1 -p 5353 google.com\n```\n\n### Testar Bloqueio (Windows PowerShell)\n\n```powershell\nnslookup instagram.com 127.0.0.1\nnslookup google.com 127.0.0.1\n```\n\n## üõ°Ô∏è Seguran√ßa\n\n- **Autentica√ß√£o JWT**: Tokens com expira√ß√£o configur√°vel\n- **RBAC**: Role-Based Access Control (ADMIN/USER)\n- **Hash de Senhas**: bcrypt com salt autom√°tico\n- **CORS Configur√°vel**: Whitelist de origens permitidas\n- **SQL Injection Protected**: Uso de ORM SQLAlchemy\n- **Valida√ß√£o de Dados**: Pydantic schemas\n\n## üìù Comandos Make\n\n```bash\nmake dev        # Subir stack completo (Docker Compose)\nmake seed       # Popular banco com dados demo\nmake backup     # Backup do PostgreSQL\nmake logs       # Ver logs de todos os containers\nmake clean      # Limpar containers e volumes\nmake test       # Rodar testes (quando implementados)\n```\n\n## üê≥ Docker Compose Services\n\n- **db**: PostgreSQL 16\n- **api**: Backend FastAPI\n- **web**: Frontend React (Vite)\n- **dnsdist**: Roteador DNS\n- **pihole_cliente_demo**: Pi-hole de demonstra√ß√£o\n\n## üîß Desenvolvimento\n\n### Adicionar Nova P√°gina\n\n1. Criar componente em `apps/web/src/pages/NovaPage.jsx`\n2. Adicionar rota em `apps/web/src/App.jsx`\n3. Adicionar link no `apps/web/src/components/Layout.jsx`\n\n### Adicionar Novo Endpoint\n\n1. Criar schema em `apps/api/schemas/`\n2. Criar fun√ß√£o em `apps/api/routers/`\n3. Adicionar ao router principal em `apps/api/main.py`\n\n### Criar Migration\n\n```bash\ncd apps/api\nalembic revision --autogenerate -m \"descri√ß√£o da mudan√ßa\"\nalembic upgrade head\n```\n\n## üêõ Troubleshooting\n\n### Frontend n√£o conecta na API\n\n**Problema**: CORS error  \n**Solu√ß√£o**: Verifique que `CORS_ORIGINS` no backend inclui `http://localhost:5000`\n\n### JWT Token inv√°lido\n\n**Problema**: 401 Unauthorized  \n**Solu√ß√£o**: \n1. Limpe localStorage\n2. Fa√ßa login novamente\n3. Verifique que `JWT_SECRET` √© o mesmo entre requisi√ß√µes\n\n### Pi-hole n√£o aplica regras\n\n**Problema**: Dom√≠nios n√£o bloqueiam  \n**Solu√ß√£o**:\n1. Verifique que container est√° rodando: `docker ps`\n2. Verifique logs: `docker logs pihole_cliente_demo`\n3. Execute manualmente: `docker exec pihole_cliente_demo pihole -b exemplo.com`\n\n## üìñ Documenta√ß√£o Adicional\n\n- [Frontend README](apps/web/README.md)\n- [API Documentation](http://localhost:8080/docs) (quando rodando)\n- [Documenta√ß√£o do Projeto](replit.md)\n\n## ü§ù Contribuindo\n\nEste projeto est√° em desenvolvimento ativo. Sugest√µes e melhorias s√£o bem-vindas!\n\n## üìÑ Licen√ßa\n\nProprietary - NovaGuardianTech\n\n## üë®‚Äçüíª Autor\n\nDesenvolvido por Replit Agent  \nData de In√≠cio: 12 de novembro de 2025\n\n---\n\n**Pr√≥ximos Passos**: Implementar Fase B (API FastAPI completa) e Fase C (Infraestrutura DNS)\n","size_bytes":12217},"tools/health_check.sh":{"content":"#!/bin/bash\n# Health check script for NovaGuardianTech\n# Returns 0 if all services are healthy, 1 otherwise\n\nset -e\n\nAPI_URL=\"${API_URL:-http://localhost:8080}\"\nFRONTEND_URL=\"${FRONTEND_URL:-http://localhost:5000}\"\nTIMEOUT=5\n\ncheck_service() {\n    local name=$1\n    local url=$2\n    \n    if curl -s -f -m $TIMEOUT \"$url\" > /dev/null 2>&1; then\n        echo \"‚úÖ $name is healthy\"\n        return 0\n    else\n        echo \"‚ùå $name is DOWN\"\n        return 1\n    fi\n}\n\ncheck_database() {\n    if [ -z \"$DATABASE_URL\" ]; then\n        echo \"‚ùå DATABASE_URL not set\"\n        return 1\n    fi\n    \n    if psql \"$DATABASE_URL\" -c \"SELECT 1\" > /dev/null 2>&1; then\n        echo \"‚úÖ Database is healthy\"\n        return 0\n    else\n        echo \"‚ùå Database is DOWN\"\n        return 1\n    fi\n}\n\ncheck_docker() {\n    if docker ps > /dev/null 2>&1; then\n        RUNNING=$(docker ps --format \"{{.Names}}\" | grep -c \"pihole\\|dnsdist\" || true)\n        echo \"‚úÖ Docker is healthy ($RUNNING containers running)\"\n        return 0\n    else\n        echo \"‚ùå Docker is DOWN\"\n        return 1\n    fi\n}\n\necho \"üîç NovaGuardianTech Health Check\"\necho \"================================\"\n\nFAILURES=0\n\ncheck_service \"API\" \"$API_URL/health\" || ((FAILURES++))\ncheck_service \"Frontend\" \"$FRONTEND_URL\" || ((FAILURES++))\ncheck_database || ((FAILURES++))\ncheck_docker || ((FAILURES++))\n\necho \"\"\nif [ $FAILURES -eq 0 ]; then\n    echo \"‚úÖ All services are healthy!\"\n    exit 0\nelse\n    echo \"‚ùå $FAILURES service(s) failed health check\"\n    exit 1\nfi\n","size_bytes":1520},"infra/pihole/setup.sh":{"content":"#!/bin/bash\n# Pi-hole setup script\n# Runs inside Pi-hole container on first boot\n\nset -e\n\necho \"üîß Setting up Pi-hole for NovaGuardianTech...\"\n\n# Wait for Pi-hole to be ready\nsleep 10\n\n# Set admin password\necho \"Setting admin password...\"\npihole -a -p novaguardian123\n\n# Configure upstream DNS\necho \"Configuring upstream DNS servers...\"\npihole -a setdns 1.1.1.1 8.8.8.8\n\n# Set query logging\necho \"Enabling query logging...\"\npihole logging on\n\n# Set privacy level to show everything\necho \"Setting privacy level...\"\npihole -a -l off\n\n# Configure blocking mode to NXDOMAIN\necho \"Setting blocking mode to NXDOMAIN...\"\npihole -a -b nxdomain\n\necho \"‚úÖ Pi-hole setup complete!\"\necho \"üìã Admin interface: http://pihole-demo/admin\"\necho \"üîê Password: novaguardian123\"\n","size_bytes":766},"apps/api/migrations/env.py":{"content":"from logging.config import fileConfig\nfrom sqlalchemy import engine_from_config\nfrom sqlalchemy import pool\nfrom alembic import context\nimport os\nimport sys\n\nsys.path.insert(0, os.path.dirname(os.path.dirname(__file__)))\n\nfrom core.database import Base\nfrom core.config import settings\n\nimport models\n\nconfig = context.config\n\nif config.config_file_name is not None:\n    fileConfig(config.config_file_name)\n\ntarget_metadata = Base.metadata\n\nconfig.set_main_option(\"sqlalchemy.url\", settings.DATABASE_URL)\n\n\ndef run_migrations_offline() -> None:\n    url = config.get_main_option(\"sqlalchemy.url\")\n    context.configure(\n        url=url,\n        target_metadata=target_metadata,\n        literal_binds=True,\n        dialect_opts={\"paramstyle\": \"named\"},\n    )\n\n    with context.begin_transaction():\n        context.run_migrations()\n\n\ndef run_migrations_online() -> None:\n    connectable = engine_from_config(\n        config.get_section(config.config_ini_section, {}),\n        prefix=\"sqlalchemy.\",\n        poolclass=pool.NullPool,\n    )\n\n    with connectable.connect() as connection:\n        context.configure(\n            connection=connection, target_metadata=target_metadata\n        )\n\n        with context.begin_transaction():\n            context.run_migrations()\n\n\nif context.is_offline_mode():\n    run_migrations_offline()\nelse:\n    run_migrations_online()\n","size_bytes":1360},"apps/web/src/hooks/useStats.js":{"content":"import { useQuery } from '@tanstack/react-query';\nimport api from '@/lib/api';\n\nexport function useStats() {\n  return useQuery({\n    queryKey: ['stats'],\n    queryFn: async () => {\n      const response = await api.get('/stats');\n      return response.data;\n    },\n    refetchInterval: 30000,\n  });\n}\n","size_bytes":300},"apps/web/src/components/ui/Card.jsx":{"content":"import React from 'react';\nimport { cn } from '@/lib/utils';\n\nconst Card = React.forwardRef(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn('rounded-lg border bg-card text-card-foreground shadow-sm', className)}\n    {...props}\n  />\n));\nCard.displayName = 'Card';\n\nconst CardHeader = React.forwardRef(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn('flex flex-col space-y-1.5 p-6', className)} {...props} />\n));\nCardHeader.displayName = 'CardHeader';\n\nconst CardTitle = React.forwardRef(({ className, ...props }, ref) => (\n  <h3 ref={ref} className={cn('text-2xl font-semibold leading-none tracking-tight', className)} {...props} />\n));\nCardTitle.displayName = 'CardTitle';\n\nconst CardDescription = React.forwardRef(({ className, ...props }, ref) => (\n  <p ref={ref} className={cn('text-sm text-muted-foreground', className)} {...props} />\n));\nCardDescription.displayName = 'CardDescription';\n\nconst CardContent = React.forwardRef(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn('p-6 pt-0', className)} {...props} />\n));\nCardContent.displayName = 'CardContent';\n\nconst CardFooter = React.forwardRef(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn('flex items-center p-6 pt-0', className)} {...props} />\n));\nCardFooter.displayName = 'CardFooter';\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent };\n","size_bytes":1412},"apps/web/postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"apps/web/src/pages/Domains.jsx":{"content":"import { useState } from 'react';\nimport { Plus, Trash2, Globe, RefreshCw, Loader2 } from 'lucide-react';\nimport { Card, CardHeader, CardTitle, CardDescription, CardContent } from '@/components/ui/Card';\nimport Button from '@/components/ui/Button';\nimport Input from '@/components/ui/Input';\nimport Select from '@/components/ui/Select';\nimport Badge from '@/components/ui/Badge';\nimport Alert from '@/components/ui/Alert';\nimport { Table, TableHeader, TableBody, TableRow, TableHead, TableCell } from '@/components/ui/Table';\nimport { useDomains, useAddDomain, useDeleteDomain, useSyncDomains } from '@/hooks/useDomains';\nimport { useClients } from '@/hooks/useClients';\n\nexport default function Domains() {\n  const [selectedClientId, setSelectedClientId] = useState('');\n  const [newDomain, setNewDomain] = useState('');\n  const [domainKind, setDomainKind] = useState('EXACT');\n\n  const { data: clients = [] } = useClients();\n  const { data: domains = [], isLoading, error } = useDomains(selectedClientId);\n  const addMutation = useAddDomain();\n  const deleteMutation = useDeleteDomain();\n  const syncMutation = useSyncDomains();\n\n  const handleAddDomain = async (e) => {\n    e.preventDefault();\n    if (!newDomain.trim() || !selectedClientId) return;\n\n    try {\n      await addMutation.mutateAsync({\n        client_id: parseInt(selectedClientId),\n        domain: newDomain.trim(),\n        kind: domainKind,\n      });\n      setNewDomain('');\n    } catch (err) {\n      console.error('Erro ao adicionar dom√≠nio:', err);\n    }\n  };\n\n  const handleDeleteDomain = async (domainId) => {\n    if (window.confirm('Tem certeza que deseja remover este dom√≠nio?')) {\n      await deleteMutation.mutateAsync(domainId);\n    }\n  };\n\n  const handleSync = async () => {\n    if (!selectedClientId) return;\n    await syncMutation.mutateAsync(parseInt(selectedClientId));\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div>\n        <h1 className=\"text-3xl font-bold text-gray-900\">Dom√≠nios Bloqueados</h1>\n        <p className=\"text-gray-600 mt-2\">\n          Gerencie as regras de bloqueio de dom√≠nios por cliente\n        </p>\n      </div>\n\n      {error && (\n        <Alert variant=\"warning\">\n          Erro ao carregar dom√≠nios. Verifique se a API est√° rodando.\n        </Alert>\n      )}\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Selecionar Cliente</CardTitle>\n          <CardDescription>Escolha o cliente para gerenciar dom√≠nios bloqueados</CardDescription>\n        </CardHeader>\n        <CardContent>\n          <Select\n            value={selectedClientId}\n            onChange={(e) => setSelectedClientId(e.target.value)}\n          >\n            <option value=\"\">Selecione um cliente...</option>\n            {clients.map((client) => (\n              <option key={client.id} value={client.id}>\n                {client.name} ({client.public_ip})\n              </option>\n            ))}\n          </Select>\n        </CardContent>\n      </Card>\n\n      {selectedClientId && (\n        <>\n          <Card>\n            <CardHeader>\n              <CardTitle>Adicionar Novo Dom√≠nio</CardTitle>\n              <CardDescription>Configure dom√≠nios para bloqueio (EXACT ou REGEX)</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <form onSubmit={handleAddDomain} className=\"space-y-4\">\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                  <div className=\"md:col-span-2\">\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                      Dom√≠nio\n                    </label>\n                    <Input\n                      type=\"text\"\n                      placeholder=\"exemplo.com ou *.ads.com\"\n                      value={newDomain}\n                      onChange={(e) => setNewDomain(e.target.value)}\n                      disabled={addMutation.isLoading}\n                      required\n                    />\n                  </div>\n\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                      Tipo de Regra\n                    </label>\n                    <Select\n                      value={domainKind}\n                      onChange={(e) => setDomainKind(e.target.value)}\n                      disabled={addMutation.isLoading}\n                    >\n                      <option value=\"EXACT\">Exato</option>\n                      <option value=\"REGEX\">Regex</option>\n                    </Select>\n                  </div>\n                </div>\n\n                <Button type=\"submit\" disabled={addMutation.isLoading}>\n                  {addMutation.isLoading ? (\n                    <>\n                      <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                      Adicionando...\n                    </>\n                  ) : (\n                    <>\n                      <Plus className=\"h-4 w-4 mr-2\" />\n                      Adicionar Dom√≠nio\n                    </>\n                  )}\n                </Button>\n              </form>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <CardTitle>Dom√≠nios Cadastrados</CardTitle>\n                  <CardDescription>{domains.length} dom√≠nio(s) bloqueado(s)</CardDescription>\n                </div>\n                <Button\n                  onClick={handleSync}\n                  disabled={domains.length === 0 || syncMutation.isLoading}\n                >\n                  {syncMutation.isLoading ? (\n                    <>\n                      <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                      Sincronizando...\n                    </>\n                  ) : (\n                    <>\n                      <RefreshCw className=\"h-4 w-4 mr-2\" />\n                      Sincronizar com Pi-hole\n                    </>\n                  )}\n                </Button>\n              </div>\n\n              {syncMutation.isSuccess && (\n                <Alert variant=\"success\" className=\"mt-4\">\n                  ‚úì Sincroniza√ß√£o com Pi-hole conclu√≠da!\n                </Alert>\n              )}\n            </CardHeader>\n            <CardContent>\n              {isLoading ? (\n                <div className=\"flex items-center justify-center h-32\">\n                  <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n                </div>\n              ) : domains.length === 0 ? (\n                <div className=\"text-center py-12\">\n                  <Globe className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n                  <p className=\"text-gray-500\">Nenhum dom√≠nio bloqueado para este cliente</p>\n                </div>\n              ) : (\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>ID</TableHead>\n                      <TableHead>Dom√≠nio</TableHead>\n                      <TableHead>Tipo</TableHead>\n                      <TableHead>Status</TableHead>\n                      <TableHead>A√ß√µes</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {domains.map((domain) => (\n                      <TableRow key={domain.id}>\n                        <TableCell className=\"font-mono text-xs\">#{domain.id}</TableCell>\n                        <TableCell className=\"font-medium\">{domain.domain}</TableCell>\n                        <TableCell>\n                          <Badge variant={domain.kind === 'EXACT' ? 'primary' : 'warning'}>\n                            {domain.kind}\n                          </Badge>\n                        </TableCell>\n                        <TableCell>\n                          <Badge variant=\"success\">Ativo</Badge>\n                        </TableCell>\n                        <TableCell>\n                          <Button\n                            size=\"sm\"\n                            variant=\"outline\"\n                            onClick={() => handleDeleteDomain(domain.id)}\n                            disabled={deleteMutation.isLoading}\n                          >\n                            <Trash2 className=\"h-3 w-3\" />\n                          </Button>\n                        </TableCell>\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n              )}\n            </CardContent>\n          </Card>\n        </>\n      )}\n    </div>\n  );\n}\n","size_bytes":8541},"apps/api/core/database.py":{"content":"from sqlalchemy import create_engine\nfrom sqlalchemy.ext.declarative import declarative_base\nfrom sqlalchemy.orm import sessionmaker, Session\nfrom typing import Generator\nfrom .config import settings\n\nengine = create_engine(\n    settings.DATABASE_URL,\n    pool_pre_ping=True,\n    pool_size=settings.DATABASE_POOL_SIZE,\n    max_overflow=settings.DATABASE_MAX_OVERFLOW,\n    pool_timeout=settings.DATABASE_POOL_TIMEOUT,\n    pool_recycle=settings.DATABASE_POOL_RECYCLE,\n    echo=settings.is_development,\n)\n\nSessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)\n\nBase = declarative_base()\n\n\ndef get_db() -> Generator[Session, None, None]:\n    db = SessionLocal()\n    try:\n        yield db\n    finally:\n        db.close()\n","size_bytes":738},"apps/api/routers/domains.py":{"content":"from fastapi import APIRouter, Depends, HTTPException, status\nfrom sqlalchemy.orm import Session\nfrom typing import List\nfrom core.database import get_db\nfrom core.security import get_current_user\nfrom models.user import User, UserRole\nfrom models.domain_rule import DomainRule\nfrom models.client import Client\nfrom schemas.domain_rule import DomainRuleCreate, DomainRuleUpdate, DomainRuleResponse\n\nrouter = APIRouter(prefix=\"/domains\", tags=[\"Domain Rules\"])\n\n\ndef get_user_client_id(user: User, client_id: int = None) -> int:\n    if user.role == UserRole.ADMIN:\n        if client_id is not None:\n            return client_id\n        if user.client_id is not None:\n            return user.client_id\n        raise HTTPException(status_code=400, detail=\"Admin must specify client_id or have a default client\")\n    else:\n        if user.client_id is None:\n            raise HTTPException(status_code=400, detail=\"User not assigned to any client\")\n        return user.client_id\n\n\n@router.get(\"\", response_model=List[DomainRuleResponse])\nasync def list_domains(\n    client_id: int = None,\n    db: Session = Depends(get_db),\n    current_user: User = Depends(get_current_user)\n):\n    client_id = get_user_client_id(current_user, client_id)\n    domains = db.query(DomainRule).filter(DomainRule.client_id == client_id).all()\n    return [DomainRuleResponse.from_orm(d) for d in domains]\n\n\n@router.post(\"\", response_model=DomainRuleResponse, status_code=status.HTTP_201_CREATED)\nasync def create_domain(\n    domain_data: DomainRuleCreate,\n    db: Session = Depends(get_db),\n    current_user: User = Depends(get_current_user)\n):\n    client_id = get_user_client_id(current_user, domain_data.client_id)\n    \n    new_domain = DomainRule(\n        client_id=client_id,\n        domain=domain_data.domain,\n        kind=domain_data.kind,\n        status=domain_data.status,\n        reason=domain_data.reason,\n        created_by=current_user.id\n    )\n    \n    db.add(new_domain)\n    db.commit()\n    db.refresh(new_domain)\n    \n    return DomainRuleResponse.from_orm(new_domain)\n\n\n@router.patch(\"/{domain_id}\", response_model=DomainRuleResponse)\nasync def update_domain(\n    domain_id: int,\n    domain_data: DomainRuleUpdate,\n    db: Session = Depends(get_db),\n    current_user: User = Depends(get_current_user)\n):\n    domain = db.query(DomainRule).filter(DomainRule.id == domain_id).first()\n    \n    if not domain:\n        raise HTTPException(status_code=404, detail=\"Domain rule not found\")\n    \n    if current_user.role != UserRole.ADMIN:\n        if current_user.client_id != domain.client_id:\n            raise HTTPException(status_code=403, detail=\"Not authorized to modify this domain\")\n    \n    if domain_data.domain is not None:\n        domain.domain = domain_data.domain\n    if domain_data.kind is not None:\n        domain.kind = domain_data.kind\n    if domain_data.status is not None:\n        domain.status = domain_data.status\n    if domain_data.reason is not None:\n        domain.reason = domain_data.reason\n    \n    db.commit()\n    db.refresh(domain)\n    \n    return DomainRuleResponse.from_orm(domain)\n\n\n@router.delete(\"/{domain_id}\", status_code=status.HTTP_204_NO_CONTENT)\nasync def delete_domain(\n    domain_id: int,\n    db: Session = Depends(get_db),\n    current_user: User = Depends(get_current_user)\n):\n    domain = db.query(DomainRule).filter(DomainRule.id == domain_id).first()\n    \n    if not domain:\n        raise HTTPException(status_code=404, detail=\"Domain rule not found\")\n    \n    if current_user.role != UserRole.ADMIN:\n        if current_user.client_id != domain.client_id:\n            raise HTTPException(status_code=403, detail=\"Not authorized to delete this domain\")\n    \n    db.delete(domain)\n    db.commit()\n    \n    return None\n","size_bytes":3743},"apps/api/models/pihole_instance.py":{"content":"from sqlalchemy import Column, Integer, String, DateTime, ForeignKey, Enum\nfrom sqlalchemy.sql import func\nfrom sqlalchemy.orm import relationship\nfrom core.database import Base\nimport enum\n\n\nclass PiholeMode(str, enum.Enum):\n    NXDOMAIN = \"NXDOMAIN\"\n    NULL = \"NULL\"\n\n\nclass PiholeInstance(Base):\n    __tablename__ = \"pihole_instances\"\n\n    id = Column(Integer, primary_key=True, index=True)\n    client_id = Column(Integer, ForeignKey(\"clients.id\", ondelete=\"CASCADE\"), nullable=False)\n    container_name = Column(String(255), nullable=False)\n    upstream_dns1 = Column(String(45), default=\"1.1.1.1\")\n    upstream_dns2 = Column(String(45), default=\"8.8.8.8\")\n    mode = Column(Enum(PiholeMode), default=PiholeMode.NXDOMAIN, nullable=False)\n    created_at = Column(DateTime(timezone=True), server_default=func.now())\n    \n    # Relationships\n    client = relationship(\"Client\", back_populates=\"pihole_instances\")\n","size_bytes":915},"replit.md":{"content":"# NovaGuardianTech - SaaS de Bloqueio DNS Multi-Cliente\n\n## Overview\n\nNovaGuardianTech is a comprehensive SaaS platform for enterprise DNS blocking with multi-client support. The system allows administrators to manage domain blocking rules per client, with intelligent routing based on source IP. The project aims to deliver a complete DNS blocking system, including a modern React frontend with an administrative panel, a robust FastAPI API with JWT authentication and RBAC, and a DNS infrastructure utilizing `dnsdist` and individual Pi-hole instances per client. This platform offers multi-client management, IP whitelisting, and comprehensive action auditing. The business vision is to provide a scalable and efficient solution for granular network control, targeting businesses that require advanced domain filtering capabilities.\n\n## User Preferences\n\n- Idioma: Portugu√™s do Brasil\n- P√∫blico-alvo: Dev j√∫nior (explica√ß√µes detalhadas)\n- Formato: Arquivos completos, nunca diffs\n- Testes: Sempre com crit√©rios de aceite documentados\n- Documenta√ß√£o: Ultra-detalhada com exemplos pr√°ticos\n\n## System Architecture\n\n### Core Stack\n\n**Frontend** (`apps/web/`):\n- React 18 with Vite 5\n- TanStack Query v5 for state management\n- Tailwind CSS 3 + shadcn/ui for components\n- React Router DOM v6\n- Axios for HTTP communication\n\n**Backend** (`apps/api/`):\n- Python 3.11+ with FastAPI\n- SQLAlchemy 2.0 + Alembic for ORM and migrations\n- PostgreSQL 16\n- python-jose for JWT, passlib + bcrypt 4.0.1 for password hashing\n- Pydantic 2.6 for data validation\n- Uvicorn as ASGI server\n\n**Infrastructure** (`infra/`):\n- dnsdist 1.8 (DNS routing by source IP)\n- Pi-hole latest (1 container per client)\n- Docker Compose 3.8 for orchestration\n\n### UI/UX Decisions\n\n- Modern, responsive layout with a sidebar.\n- Tailwind CSS and shadcn/ui for a consistent and modular design system.\n- Protected routes for authentication management.\n\n### Technical Implementations and Features\n\n- **Authentication**: JWT with Bearer tokens for API, with eventual transition to HttpOnly cookies for production.\n- **Authorization**: Role-Based Access Control (RBAC) with ADMIN and USER roles.\n- **DNS Blocking**: NXDOMAIN standard for blocked domains for expected client behavior.\n- **Multi-client Management**: Separate Pi-hole instances and granular domain/IP rule management per client.\n- **Database**: PostgreSQL with SQLAlchemy for robust data management and Alembic for migrations.\n- **API Endpoints**: Structured into modules for authentication, domain management, IP whitelisting, DNS operations (sync, IP lookup), and administrative tasks.\n- **Pi-hole Synchronization**: Incremental and idempotent synchronization of domain rules to Pi-hole's `gravity.db` via CLI commands, with comment tracking for NovaGuardian entries.\n- **Project Structure**: Monorepo approach (`apps/web`, `apps/api`) to facilitate local development and independent deployment.\n- **HMR in Replit**: Configured with WebSocket Secure (wss) and clientPort 443 for correct HMR functionality.\n- **Vite Proxy**: Uses `/api` with Vite proxy for API communication to avoid CORS issues in Replit.\n\n### System Design Choices\n\n- **Monorepo**: Chosen for streamlined development and deployment.\n- **Microservices-adjacent**: Frontend and Backend as distinct applications, with a shared DNS infrastructure pattern.\n- **Scalability**: Designed to provision individual Pi-hole instances per client, allowing for client-specific configurations and isolation.\n- **Observability (Planned)**: Future integration with Prometheus and Grafana for monitoring.\n\n## External Dependencies\n\n- **PostgreSQL 16**: Primary database, utilizing Neon for managed instances and local PostgreSQL for development.\n- **dnsdist**: Used for intelligent DNS traffic routing based on source IP.\n- **Pi-hole**: Utilized for DNS-level ad blocking and domain filtering, with each client having a dedicated instance.\n- **Docker Compose**: For orchestrating the `dnsdist`, Pi-hole, and local PostgreSQL containers.\n- **Docker SDK for Python**: For managing Pi-hole container lifecycle (provision, deprovision, restart, status).\n- **TanStack Query**: For data fetching, caching, and state management in the frontend.\n- **Tailwind CSS**: Utility-first CSS framework for styling.\n- **shadcn/ui**: Component library built on Tailwind CSS for UI elements.\n- **Axios**: HTTP client for frontend API communication.\n- **python-jose**: For handling JSON Web Tokens (JWT) in the backend.\n- **passlib + bcrypt**: For secure password hashing.\n- **Pydantic**: For data validation and serialization in the backend.\n- **Uvicorn**: ASGI server for FastAPI.\n\n## Recent Changes\n\n### Phase D: Production Blueprint (2025-11-13) ‚úÖ\n\n**Deployment Configuration**:\n- Configured production deployment settings with VM target\n- Environment-aware Settings class (is_production, is_development)\n- Database connection pooling (pool_size=5, max_overflow=10, recycle=3600s)\n- Health checks via pool_pre_ping\n- Echo disabled in production for performance\n\n**Multi-Instance Pi-hole Management**:\n- **PiholeManager service** for complete Docker lifecycle management:\n  - Auto IP allocation (172.20.0.10+) and port mapping (8081+)\n  - Container provisioning without network pre-attach (prevents double-attach error)\n  - Dynamic dnsdist config generation with correct IP interpolation\n  - Volume management for persistence\n- **Admin endpoints** (`/admin/pihole/*`):\n  - POST `/provision` - Create new Pi-hole instance for client\n  - DELETE `/{client_id}` - Remove instance\n  - GET `/list` - List all instances with status\n  - POST `/{container_name}/restart` - Restart instance\n  - GET `/{container_name}/status` - Get health status\n  - POST `/dnsdist/update-config` - Generate and update dnsdist config\n\n**Production Infrastructure**:\n- Production Dockerfiles for API (multi-stage) and Web (nginx)\n- docker-compose.prod.yml with health checks and restart policies\n- Migration automation (tools/migrate.py) runs on deployment\n- Backup/restore scripts with 7-day retention (tools/backup_database.sh, restore_database.sh)\n- Health monitoring script (tools/health_check.sh) for all services\n- .dockerignore for optimized build contexts\n\n**Security & Documentation**:\n- SECURITY.md documenting Docker socket exposure risks and mitigations\n- DEPLOYMENT.md with complete production deployment guide\n- Risk assessment for Docker API access with mitigation strategies\n- Recommended production hardening steps\n\n**Critical Fixes Applied**:\n- Fixed Docker network double-attach by removing network parameter from containers.run()\n- Corrected f-string interpolation in dnsdist routing rules: `{{\"{instance.public_ip}/32\"}}` ‚Üí generates `{\"203.0.113.10/32\"}`\n- Validated dnsdist config generation produces syntactically correct Lua code\n\n**Production-Ready Status**: ‚úÖ Approved by architect after 4 iterations fixing network conflicts, IP interpolation, and Lua template syntax.\n\n### Phase E: Complete React Admin Panel (2025-11-13) ‚úÖ\n\n**Frontend Implementation**:\n- ‚úÖ Full admin panel with 8 functional pages\n- ‚úÖ TanStack Query v5 integration for all API calls\n- ‚úÖ Role-based navigation and access control\n- ‚úÖ Responsive design with Tailwind CSS + shadcn/ui components\n\n**Pages Implemented**:\n1. **Dashboard**: Real-time statistics (clients, domains, whitelist, Pi-hole instances) with auto-refresh every 30s\n2. **Clients**: Full CRUD operations with dialog forms and table display\n3. **Domains**: Multi-tenant domain blocking management with client selection, EXACT/REGEX types, and Pi-hole sync\n4. **Whitelist**: Multi-tenant IP whitelist management with client selection\n5. **Pi-hole Instances**: Provision/deprovision containers, restart instances, update dnsdist config\n6. **Users** (Admin only): User management with role assignment (ADMIN/USER), password handling\n7. **Audit Logs**: Filterable audit trail with action types, pagination, formatted timestamps, actor names via joined relationship\n8. **Settings**: User profile and preferences (placeholder)\n\n**TanStack Query Hooks** (22 total in 7 families):\n- `useClients` + useCreateClient, useUpdateClient, useDeleteClient\n- `useDomains` + useAddDomain, useDeleteDomain, useSyncDomains\n- `useWhitelist` + useAddWhitelist, useDeleteWhitelist\n- `usePihole` + useProvisionPihole, useDeprovisionPihole, useRestartPihole, useUpdateDnsdist\n- `useAuditLogs` (filterable with user_id, action, client_id)\n- `useUsers` + useCreateUser, useUpdateUser, useDeleteUser\n- `useStats` (dashboard statistics)\n- All with proper cache invalidation on mutations\n- Standardized loading/error states\n- Query keys structured for multi-tenant operations\n\n**UI Components** (6 custom):\n- `Badge.jsx` - Status badges with 6 color variants (primary, success, danger, warning, purple, default)\n- `Table.jsx` - Complete table system (Header, Body, Row, Head, Cell)\n- `Dialog.jsx` - Modal dialogs with header/content/footer sections\n- `Select.jsx` - Styled dropdown select matching design system\n- `Textarea.jsx` - Multi-line text input\n- `Alert.jsx` - Alert messages with variant support\n\n**Backend API Enhancements**:\n- Created `/stats` endpoint for dashboard statistics (returns clients_count, domains_count, whitelist_count, pihole_instances_count)\n- Added `/admin/audit` endpoint with:\n  - Filters: user_id, action (ILIKE search), client_id\n  - Pagination: limit (default 50, max 100), offset\n  - Eager loading: joinedload(AuditLog.user) for N+1 prevention\n  - Response model: AuditLogResponse with nested UserBasic (id, name, email)\n- Added `/admin/users/{id}` PUT and DELETE endpoints with self-delete protection\n- All endpoints properly secured with RBAC (Admin middleware)\n\n**Database Schema Alignment**:\n- AuditLog model updated with SQLAlchemy relationship:\n  - `user = relationship(\"User\", foreign_keys=[actor_user_id])`\n  - Fields aligned: actor_user_id, created_at, payload_json (actual DB schema)\n- AuditLogResponse schema aligned with model:\n  - Uses correct field names from database\n  - Includes nested UserBasic for actor name display\n  - Pydantic serialization working correctly\n\n**Features**:\n- Multi-tenant client selection on Domains/Whitelist pages\n- Confirmation dialogs for destructive actions\n- Success/error feedback on all mutations\n- Loading states with spinners on all async operations\n- Admin-only routes hidden from non-admin users\n- Responsive sidebar navigation with role-based visibility\n- Audit logs display actor names from joined user relationship\n\n**Architecture Decisions**:\n- Frontend-backend contract aligned for all CRUD operations\n- API calls use Vite proxy (`/api`) to avoid CORS in Replit\n- TanStack Query cache keys parameterized by client_id for proper invalidation\n- Forms use controlled components with React hooks\n- Error handling with graceful fallbacks (e.g., demo mode for stats)\n- SQLAlchemy eager loading for optimal query performance\n\n**Testing Status**:\n- ‚ö†Ô∏è End-to-end testing required by user to verify all pages work with real data\n- All code structure is complete and contracts are aligned\n- Frontend and backend workflows running successfully","size_bytes":11110},"apps/web/src/hooks/useClients.js":{"content":"import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport api from '@/lib/api';\n\nexport function useClients() {\n  return useQuery({\n    queryKey: ['clients'],\n    queryFn: async () => {\n      const response = await api.get('/admin/clients');\n      return response.data;\n    },\n  });\n}\n\nexport function useCreateClient() {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: async (clientData) => {\n      const response = await api.post('/admin/clients', clientData);\n      return response.data;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries(['clients']);\n    },\n  });\n}\n\nexport function useUpdateClient() {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: async ({ id, data }) => {\n      const response = await api.put(`/admin/clients/${id}`, data);\n      return response.data;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries(['clients']);\n    },\n  });\n}\n\nexport function useDeleteClient() {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: async (clientId) => {\n      await api.delete(`/admin/clients/${clientId}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries(['clients']);\n    },\n  });\n}\n","size_bytes":1274},"apps/web/src/hooks/useWhitelist.js":{"content":"import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport api from '@/lib/api';\n\nexport function useWhitelist(clientId) {\n  return useQuery({\n    queryKey: ['whitelist', clientId],\n    queryFn: async () => {\n      const url = clientId ? `/whitelist?client_id=${clientId}` : '/whitelist';\n      const response = await api.get(url);\n      return response.data;\n    },\n    enabled: !!clientId,\n  });\n}\n\nexport function useAddWhitelist() {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: async (data) => {\n      const response = await api.post('/whitelist', data);\n      return response.data;\n    },\n    onSuccess: (_, variables) => {\n      queryClient.invalidateQueries(['whitelist', variables.client_id]);\n      queryClient.invalidateQueries(['whitelist']);\n    },\n  });\n}\n\nexport function useDeleteWhitelist() {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: async (whitelistId) => {\n      await api.delete(`/whitelist/${whitelistId}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries(['whitelist']);\n    },\n  });\n}\n","size_bytes":1130},"apps/web/src/hooks/usePihole.js":{"content":"import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport api from '@/lib/api';\n\nexport function usePiholeInstances() {\n  return useQuery({\n    queryKey: ['pihole-instances'],\n    queryFn: async () => {\n      const response = await api.get('/admin/pihole/list');\n      return response.data;\n    },\n  });\n}\n\nexport function useProvisionPihole() {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: async (data) => {\n      const response = await api.post('/admin/pihole/provision', data);\n      return response.data;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries(['pihole-instances']);\n    },\n  });\n}\n\nexport function useDeprovisionPihole() {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: async (clientId) => {\n      await api.delete(`/admin/pihole/${clientId}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries(['pihole-instances']);\n    },\n  });\n}\n\nexport function useRestartPihole() {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: async (containerName) => {\n      const response = await api.post(`/admin/pihole/${containerName}/restart`);\n      return response.data;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries(['pihole-instances']);\n    },\n  });\n}\n\nexport function useUpdateDnsdist() {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: async () => {\n      const response = await api.post('/admin/pihole/dnsdist/update-config');\n      return response.data;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries(['pihole-instances']);\n    },\n  });\n}\n","size_bytes":1685},"apps/web/src/pages/PiholeInstances.jsx":{"content":"import { useState } from 'react';\nimport { Server, Plus, RefreshCw, Trash2, Loader2, PlayCircle, Settings } from 'lucide-react';\nimport { Card, CardHeader, CardTitle, CardDescription, CardContent } from '@/components/ui/Card';\nimport Button from '@/components/ui/Button';\nimport Badge from '@/components/ui/Badge';\nimport Alert from '@/components/ui/Alert';\nimport { Table, TableHeader, TableBody, TableRow, TableHead, TableCell } from '@/components/ui/Table';\nimport { Dialog, DialogHeader, DialogTitle, DialogContent, DialogFooter } from '@/components/ui/Dialog';\nimport Select from '@/components/ui/Select';\nimport Input from '@/components/ui/Input';\nimport { \n  usePiholeInstances, \n  useProvisionPihole, \n  useDeprovisionPihole, \n  useRestartPihole,\n  useUpdateDnsdist \n} from '@/hooks/usePihole';\nimport { useClients } from '@/hooks/useClients';\n\nexport default function PiholeInstances() {\n  const [isProvisionDialogOpen, setIsProvisionDialogOpen] = useState(false);\n  const [formData, setFormData] = useState({ client_id: '', password: '' });\n  \n  const { data: instances = [], isLoading, error } = usePiholeInstances();\n  const { data: clients = [] } = useClients();\n  const provisionMutation = useProvisionPihole();\n  const deprovisionMutation = useDeprovisionPihole();\n  const restartMutation = useRestartPihole();\n  const updateDnsdistMutation = useUpdateDnsdist();\n\n  const handleProvision = async (e) => {\n    e.preventDefault();\n    \n    try {\n      await provisionMutation.mutateAsync(formData);\n      setIsProvisionDialogOpen(false);\n      setFormData({ client_id: '', password: '' });\n    } catch (err) {\n      console.error('Erro ao provisionar Pi-hole:', err);\n    }\n  };\n\n  const handleDeprovision = async (clientId) => {\n    if (window.confirm('Tem certeza que deseja remover esta inst√¢ncia Pi-hole? Esta a√ß√£o n√£o pode ser desfeita.')) {\n      await deprovisionMutation.mutateAsync(clientId);\n    }\n  };\n\n  const handleRestart = async (containerName) => {\n    await restartMutation.mutateAsync(containerName);\n  };\n\n  const handleUpdateDnsdist = async () => {\n    await updateDnsdistMutation.mutateAsync();\n  };\n\n  const getStatusBadge = (status) => {\n    const variants = {\n      running: 'success',\n      stopped: 'danger',\n      restarting: 'warning',\n    };\n    return <Badge variant={variants[status] || 'default'}>{status}</Badge>;\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-gray-900\">Inst√¢ncias Pi-hole</h1>\n          <p className=\"text-gray-600 mt-2\">Gerencie containers Pi-hole por cliente</p>\n        </div>\n        <div className=\"flex gap-2\">\n          <Button\n            variant=\"outline\"\n            onClick={handleUpdateDnsdist}\n            disabled={updateDnsdistMutation.isLoading}\n          >\n            {updateDnsdistMutation.isLoading ? (\n              <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n            ) : (\n              <Settings className=\"h-4 w-4 mr-2\" />\n            )}\n            Atualizar dnsdist\n          </Button>\n          <Button onClick={() => setIsProvisionDialogOpen(true)}>\n            <Plus className=\"h-4 w-4 mr-2\" />\n            Provisionar Inst√¢ncia\n          </Button>\n        </div>\n      </div>\n\n      {error && (\n        <Alert variant=\"danger\">\n          Erro ao carregar inst√¢ncias: {error.message}\n        </Alert>\n      )}\n\n      {updateDnsdistMutation.isSuccess && (\n        <Alert variant=\"success\">\n          Configura√ß√£o dnsdist atualizada com sucesso!\n        </Alert>\n      )}\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Inst√¢ncias Ativas</CardTitle>\n          <CardDescription>Total: {instances.length} inst√¢ncias provisionadas</CardDescription>\n        </CardHeader>\n        <CardContent>\n          {instances.length === 0 ? (\n            <div className=\"text-center py-12\">\n              <Server className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n              <p className=\"text-gray-500\">Nenhuma inst√¢ncia provisionada ainda.</p>\n              <Button\n                onClick={() => setIsProvisionDialogOpen(true)}\n                variant=\"outline\"\n                className=\"mt-4\"\n              >\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Provisionar Primeira Inst√¢ncia\n              </Button>\n            </div>\n          ) : (\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Container</TableHead>\n                  <TableHead>Cliente</TableHead>\n                  <TableHead>IP Interno</TableHead>\n                  <TableHead>IP P√∫blico</TableHead>\n                  <TableHead>Porta Web</TableHead>\n                  <TableHead>Status</TableHead>\n                  <TableHead>A√ß√µes</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {instances.map((instance) => (\n                  <TableRow key={instance.container_name}>\n                    <TableCell className=\"font-mono text-xs\">\n                      {instance.container_name}\n                    </TableCell>\n                    <TableCell className=\"font-medium\">\n                      Cliente #{instance.client_id}\n                    </TableCell>\n                    <TableCell className=\"font-mono text-xs\">\n                      {instance.internal_ip}\n                    </TableCell>\n                    <TableCell className=\"font-mono text-xs\">\n                      {instance.public_ip}\n                    </TableCell>\n                    <TableCell className=\"font-mono text-xs\">\n                      {instance.web_port}\n                    </TableCell>\n                    <TableCell>\n                      {getStatusBadge(instance.status)}\n                    </TableCell>\n                    <TableCell>\n                      <div className=\"flex items-center gap-2\">\n                        <Button\n                          size=\"sm\"\n                          variant=\"outline\"\n                          onClick={() => handleRestart(instance.container_name)}\n                          disabled={restartMutation.isLoading}\n                          title=\"Reiniciar\"\n                        >\n                          <RefreshCw className=\"h-3 w-3\" />\n                        </Button>\n                        <Button\n                          size=\"sm\"\n                          variant=\"outline\"\n                          onClick={() => handleDeprovision(instance.client_id)}\n                          disabled={deprovisionMutation.isLoading}\n                          title=\"Remover\"\n                        >\n                          <Trash2 className=\"h-3 w-3\" />\n                        </Button>\n                      </div>\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          )}\n        </CardContent>\n      </Card>\n\n      <Dialog open={isProvisionDialogOpen} onClose={() => setIsProvisionDialogOpen(false)}>\n        <form onSubmit={handleProvision}>\n          <DialogHeader>\n            <DialogTitle onClose={() => setIsProvisionDialogOpen(false)}>\n              Provisionar Nova Inst√¢ncia Pi-hole\n            </DialogTitle>\n          </DialogHeader>\n\n          <DialogContent>\n            <div className=\"space-y-4\">\n              <Alert variant=\"info\">\n                Ser√° criado um container Docker Pi-hole dedicado para o cliente selecionado.\n              </Alert>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Cliente\n                </label>\n                <Select\n                  value={formData.client_id}\n                  onChange={(e) => setFormData({ ...formData, client_id: e.target.value })}\n                  required\n                >\n                  <option value=\"\">Selecione um cliente</option>\n                  {clients.map((client) => (\n                    <option key={client.id} value={client.id}>\n                      {client.name} ({client.public_ip})\n                    </option>\n                  ))}\n                </Select>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Senha Admin Pi-hole\n                </label>\n                <Input\n                  type=\"password\"\n                  value={formData.password}\n                  onChange={(e) => setFormData({ ...formData, password: e.target.value })}\n                  placeholder=\"Senha para interface web\"\n                  required\n                />\n                <p className=\"text-xs text-gray-500 mt-1\">\n                  Use uma senha forte para acesso √† interface web do Pi-hole\n                </p>\n              </div>\n            </div>\n          </DialogContent>\n\n          <DialogFooter>\n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              onClick={() => setIsProvisionDialogOpen(false)}\n            >\n              Cancelar\n            </Button>\n            <Button\n              type=\"submit\"\n              disabled={provisionMutation.isLoading}\n            >\n              {provisionMutation.isLoading ? (\n                <>\n                  <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                  Provisionando...\n                </>\n              ) : (\n                <>\n                  <PlayCircle className=\"h-4 w-4 mr-2\" />\n                  Provisionar\n                </>\n              )}\n            </Button>\n          </DialogFooter>\n        </form>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":9894},"apps/web/src/pages/Dashboard.jsx":{"content":"import { Card, CardHeader, CardTitle, CardDescription, CardContent } from '@/components/ui/Card';\nimport { Shield, Globe, ListFilter, Activity, Building2, Loader2 } from 'lucide-react';\nimport Badge from '@/components/ui/Badge';\nimport Alert from '@/components/ui/Alert';\nimport useAuthStore from '@/hooks/useAuth';\nimport { useStats } from '@/hooks/useStats';\n\nexport default function Dashboard() {\n  const { user } = useAuthStore();\n  const { data: stats, isLoading, error } = useStats();\n\n  const statsCards = [\n    {\n      name: 'Clientes',\n      value: stats?.clients_count || 0,\n      description: 'Cadastrados',\n      icon: Building2,\n      color: 'text-indigo-600',\n      bgColor: 'bg-indigo-100',\n    },\n    {\n      name: 'Dom√≠nios Bloqueados',\n      value: stats?.domains_count || 0,\n      description: 'Regras ativas',\n      icon: Globe,\n      color: 'text-blue-600',\n      bgColor: 'bg-blue-100',\n    },\n    {\n      name: 'IPs na Whitelist',\n      value: stats?.whitelist_count || 0,\n      description: 'IPs autorizados',\n      icon: ListFilter,\n      color: 'text-green-600',\n      bgColor: 'bg-green-100',\n    },\n    {\n      name: 'Inst√¢ncias Pi-hole',\n      value: stats?.pihole_instances_count || 0,\n      description: 'Containers ativos',\n      icon: Shield,\n      color: 'text-purple-600',\n      bgColor: 'bg-purple-100',\n    },\n  ];\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div>\n        <h1 className=\"text-3xl font-bold text-gray-900\">Dashboard</h1>\n        <p className=\"text-gray-600 mt-2\">\n          Bem-vindo, {user?.name || 'Usu√°rio'}! Vis√£o geral do sistema de bloqueio DNS.\n        </p>\n      </div>\n\n      {error && (\n        <Alert variant=\"warning\">\n          Modo demonstra√ß√£o ativo. Conecte a API para ver dados reais.\n        </Alert>\n      )}\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n        {statsCards.map((stat) => {\n          const Icon = stat.icon;\n          return (\n            <Card key={stat.name}>\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"text-sm font-medium text-gray-600\">{stat.name}</p>\n                    <p className=\"text-2xl font-bold text-gray-900 mt-2\">{stat.value}</p>\n                    <p className=\"text-xs text-gray-500 mt-1\">{stat.description}</p>\n                  </div>\n                  <div className={`p-3 rounded-full ${stat.bgColor}`}>\n                    <Icon className={`h-6 w-6 ${stat.color}`} />\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          );\n        })}\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <Card>\n          <CardHeader>\n            <CardTitle>In√≠cio R√°pido</CardTitle>\n            <CardDescription>Primeiros passos para configurar o sistema</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <ol className=\"space-y-3 text-sm\">\n              <li className=\"flex items-start gap-3\">\n                <span className=\"flex-shrink-0 w-6 h-6 bg-primary text-white rounded-full flex items-center justify-center text-xs font-bold\">1</span>\n                <div>\n                  <p className=\"font-medium text-gray-900\">Configure a API FastAPI</p>\n                  <p className=\"text-gray-600\">Inicie a API backend para gerenciar as regras DNS</p>\n                </div>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"flex-shrink-0 w-6 h-6 bg-primary text-white rounded-full flex items-center justify-center text-xs font-bold\">2</span>\n                <div>\n                  <p className=\"font-medium text-gray-900\">Adicione dom√≠nios para bloqueio</p>\n                  <p className=\"text-gray-600\">Use a p√°gina \"Dom√≠nios Bloqueados\" para criar regras</p>\n                </div>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"flex-shrink-0 w-6 h-6 bg-primary text-white rounded-full flex items-center justify-center text-xs font-bold\">3</span>\n                <div>\n                  <p className=\"font-medium text-gray-900\">Configure o Pi-hole via Docker</p>\n                  <p className=\"text-gray-600\">Inicie o container do Pi-hole para aplicar os bloqueios</p>\n                </div>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"flex-shrink-0 w-6 h-6 bg-primary text-white rounded-full flex items-center justify-center text-xs font-bold\">4</span>\n                <div>\n                  <p className=\"font-medium text-gray-900\">Teste com dig/nslookup</p>\n                  <p className=\"text-gray-600\">Valide que os dom√≠nios bloqueados retornam NXDOMAIN</p>\n                </div>\n              </li>\n            </ol>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Informa√ß√µes do Sistema</CardTitle>\n            <CardDescription>Detalhes t√©cnicos da instala√ß√£o</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <dl className=\"space-y-3 text-sm\">\n              <div>\n                <dt className=\"font-medium text-gray-900\">Usu√°rio Logado</dt>\n                <dd className=\"text-gray-600\">{user?.email || 'N/A'}</dd>\n              </div>\n              <div>\n                <dt className=\"font-medium text-gray-900\">N√≠vel de Acesso</dt>\n                <dd className=\"text-gray-600\">\n                  <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${\n                    user?.role === 'ADMIN' ? 'bg-purple-100 text-purple-800' : 'bg-blue-100 text-blue-800'\n                  }`}>\n                    {user?.role || 'USER'}\n                  </span>\n                </dd>\n              </div>\n              <div>\n                <dt className=\"font-medium text-gray-900\">Modo de Bloqueio</dt>\n                <dd className=\"text-gray-600\">NXDOMAIN (padr√£o)</dd>\n              </div>\n              <div>\n                <dt className=\"font-medium text-gray-900\">Porta dnsdist</dt>\n                <dd className=\"text-gray-600\">5353 (desenvolvimento)</dd>\n              </div>\n              <div>\n                <dt className=\"font-medium text-gray-900\">Status da API</dt>\n                <dd className=\"text-gray-600\">\n                  <span className=\"inline-flex items-center gap-1\">\n                    <span className={`w-2 h-2 rounded-full ${error ? 'bg-orange-500' : 'bg-green-500'}`}></span>\n                    {error ? 'Modo demonstra√ß√£o' : 'Conectado'}\n                  </span>\n                </dd>\n              </div>\n            </dl>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","size_bytes":7032},"apps/web/src/components/ui/Textarea.jsx":{"content":"import { cn } from '@/lib/utils';\n\nexport default function Textarea({ className, error, ...props }) {\n  return (\n    <textarea\n      className={cn(\n        'block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm',\n        'focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent',\n        'disabled:bg-gray-100 disabled:cursor-not-allowed',\n        'text-sm resize-none',\n        error && 'border-red-500 focus:ring-red-500',\n        className\n      )}\n      {...props}\n    />\n  );\n}\n","size_bytes":516},"apps/api/routers/auth.py":{"content":"from fastapi import APIRouter, Depends, HTTPException, status\nfrom fastapi.security import OAuth2PasswordRequestForm\nfrom sqlalchemy.orm import Session\nfrom core.database import get_db\nfrom core.security import verify_password, create_access_token, get_current_user\nfrom models.user import User\nfrom schemas.user import TokenResponse, UserResponse\n\nrouter = APIRouter(prefix=\"/auth\", tags=[\"Authentication\"])\n\n\n@router.post(\"/login\", response_model=TokenResponse)\nasync def login(\n    form_data: OAuth2PasswordRequestForm = Depends(),\n    db: Session = Depends(get_db)\n):\n    user = db.query(User).filter(User.email == form_data.username).first()\n    \n    if not user or not verify_password(form_data.password, user.password_hash):\n        raise HTTPException(\n            status_code=status.HTTP_401_UNAUTHORIZED,\n            detail=\"Incorrect email or password\",\n            headers={\"WWW-Authenticate\": \"Bearer\"},\n        )\n    \n    access_token = create_access_token(data={\"sub\": user.email})\n    \n    return TokenResponse(\n        access_token=access_token,\n        user=UserResponse.from_orm(user)\n    )\n\n\n@router.post(\"/logout\")\nasync def logout():\n    return {\"message\": \"Logged out successfully\"}\n\n\n@router.get(\"/me\", response_model=UserResponse)\nasync def get_me(current_user: User = Depends(get_current_user)):\n    return UserResponse.from_orm(current_user)\n","size_bytes":1369},"apps/api/core/security.py":{"content":"from datetime import datetime, timedelta\nfrom typing import Optional\nfrom jose import JWTError, jwt\nfrom passlib.context import CryptContext\nfrom fastapi import Depends, HTTPException, status\nfrom fastapi.security import OAuth2PasswordBearer\nfrom sqlalchemy.orm import Session\nfrom .config import settings\nfrom .database import get_db\n\npwd_context = CryptContext(schemes=[\"bcrypt\"], deprecated=\"auto\")\noauth2_scheme = OAuth2PasswordBearer(tokenUrl=\"/auth/login\")\n\n\ndef verify_password(plain_password: str, hashed_password: str) -> bool:\n    return pwd_context.verify(plain_password, hashed_password)\n\n\ndef get_password_hash(password: str) -> str:\n    return pwd_context.hash(password)\n\n\ndef create_access_token(data: dict, expires_delta: Optional[timedelta] = None) -> str:\n    to_encode = data.copy()\n    if expires_delta:\n        expire = datetime.utcnow() + expires_delta\n    else:\n        expire = datetime.utcnow() + timedelta(minutes=settings.JWT_EXPIRE_MINUTES)\n    \n    to_encode.update({\"exp\": expire})\n    encoded_jwt = jwt.encode(to_encode, settings.JWT_SECRET, algorithm=settings.JWT_ALGORITHM)\n    return encoded_jwt\n\n\ndef decode_token(token: str) -> dict:\n    try:\n        payload = jwt.decode(token, settings.JWT_SECRET, algorithms=[settings.JWT_ALGORITHM])\n        return payload\n    except JWTError:\n        raise HTTPException(\n            status_code=status.HTTP_401_UNAUTHORIZED,\n            detail=\"Could not validate credentials\",\n            headers={\"WWW-Authenticate\": \"Bearer\"},\n        )\n\n\nasync def get_current_user(\n    token: str = Depends(oauth2_scheme),\n    db: Session = Depends(get_db)\n):\n    from models.user import User\n    \n    payload = decode_token(token)\n    email: str = payload.get(\"sub\")\n    \n    if email is None:\n        raise HTTPException(\n            status_code=status.HTTP_401_UNAUTHORIZED,\n            detail=\"Could not validate credentials\",\n            headers={\"WWW-Authenticate\": \"Bearer\"},\n        )\n    \n    user = db.query(User).filter(User.email == email).first()\n    if user is None:\n        raise HTTPException(\n            status_code=status.HTTP_401_UNAUTHORIZED,\n            detail=\"User not found\",\n            headers={\"WWW-Authenticate\": \"Bearer\"},\n        )\n    \n    return user\n\n\nasync def get_current_admin_user(current_user = Depends(get_current_user)):\n    if current_user.role != \"ADMIN\":\n        raise HTTPException(\n            status_code=status.HTTP_403_FORBIDDEN,\n            detail=\"Insufficient permissions. Admin access required.\",\n        )\n    return current_user\n","size_bytes":2547},"apps/web/src/components/ui/Alert.jsx":{"content":"import { cn } from '@/lib/utils';\nimport { AlertCircle, CheckCircle2, Info, XCircle } from 'lucide-react';\n\nexport default function Alert({ children, variant = 'info', className, ...props }) {\n  const variants = {\n    info: {\n      container: 'bg-blue-50 border-blue-200 text-blue-800',\n      icon: Info,\n      iconColor: 'text-blue-600',\n    },\n    success: {\n      container: 'bg-green-50 border-green-200 text-green-800',\n      icon: CheckCircle2,\n      iconColor: 'text-green-600',\n    },\n    warning: {\n      container: 'bg-yellow-50 border-yellow-200 text-yellow-800',\n      icon: AlertCircle,\n      iconColor: 'text-yellow-600',\n    },\n    danger: {\n      container: 'bg-red-50 border-red-200 text-red-800',\n      icon: XCircle,\n      iconColor: 'text-red-600',\n    },\n  };\n\n  const config = variants[variant];\n  const Icon = config.icon;\n\n  return (\n    <div\n      className={cn(\n        'border rounded-md p-4 flex items-start gap-3',\n        config.container,\n        className\n      )}\n      {...props}\n    >\n      <Icon className={cn('h-5 w-5 flex-shrink-0 mt-0.5', config.iconColor)} />\n      <div className=\"flex-1 text-sm\">{children}</div>\n    </div>\n  );\n}\n","size_bytes":1173},"apps/web/src/hooks/useDomains.js":{"content":"import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport api from '@/lib/api';\n\nexport function useDomains(clientId) {\n  return useQuery({\n    queryKey: ['domains', clientId],\n    queryFn: async () => {\n      const url = clientId ? `/domains?client_id=${clientId}` : '/domains';\n      const response = await api.get(url);\n      return response.data;\n    },\n    enabled: !!clientId,\n  });\n}\n\nexport function useAddDomain() {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: async (domainData) => {\n      const response = await api.post('/domains', domainData);\n      return response.data;\n    },\n    onSuccess: (_, variables) => {\n      queryClient.invalidateQueries(['domains', variables.client_id]);\n      queryClient.invalidateQueries(['domains']);\n    },\n  });\n}\n\nexport function useDeleteDomain() {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: async (domainId) => {\n      await api.delete(`/domains/${domainId}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries(['domains']);\n    },\n  });\n}\n\nexport function useSyncDomains() {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: async (clientId) => {\n      const response = await api.post(`/dns/sync/${clientId}`);\n      return response.data;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries(['domains']);\n    },\n  });\n}\n","size_bytes":1439},"apps/web/tailwind.config.js":{"content":"/** @type {import('tailwindcss').Config} */\nexport default {\n  content: [\n    \"./index.html\",\n    \"./src/**/*.{js,ts,jsx,tsx}\",\n  ],\n  theme: {\n    extend: {\n      colors: {\n        border: \"hsl(var(--border))\",\n        input: \"hsl(var(--input))\",\n        ring: \"hsl(var(--ring))\",\n        background: \"hsl(var(--background))\",\n        foreground: \"hsl(var(--foreground))\",\n        primary: {\n          DEFAULT: \"hsl(var(--primary))\",\n          foreground: \"hsl(var(--primary-foreground))\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary))\",\n          foreground: \"hsl(var(--secondary-foreground))\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive))\",\n          foreground: \"hsl(var(--destructive-foreground))\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted))\",\n          foreground: \"hsl(var(--muted-foreground))\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent))\",\n          foreground: \"hsl(var(--accent-foreground))\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover))\",\n          foreground: \"hsl(var(--popover-foreground))\",\n        },\n        card: {\n          DEFAULT: \"hsl(var(--card))\",\n          foreground: \"hsl(var(--card-foreground))\",\n        },\n      },\n      borderRadius: {\n        lg: \"var(--radius)\",\n        md: \"calc(var(--radius) - 2px)\",\n        sm: \"calc(var(--radius) - 4px)\",\n      },\n    },\n  },\n  plugins: [],\n}\n","size_bytes":1450},"apps/web/src/pages/Users.jsx":{"content":"import { useState } from 'react';\nimport { Plus, Edit, Trash2, Loader2, Shield, User } from 'lucide-react';\nimport { Card, CardHeader, CardTitle, CardDescription, CardContent } from '@/components/ui/Card';\nimport Button from '@/components/ui/Button';\nimport Input from '@/components/ui/Input';\nimport Select from '@/components/ui/Select';\nimport Badge from '@/components/ui/Badge';\nimport Alert from '@/components/ui/Alert';\nimport { Table, TableHeader, TableBody, TableRow, TableHead, TableCell } from '@/components/ui/Table';\nimport { Dialog, DialogHeader, DialogTitle, DialogContent, DialogFooter } from '@/components/ui/Dialog';\nimport { useUsers, useCreateUser, useUpdateUser, useDeleteUser } from '@/hooks/useUsers';\nimport useAuthStore from '@/hooks/useAuth';\n\nexport default function Users() {\n  const { user: currentUser } = useAuthStore();\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [editingUser, setEditingUser] = useState(null);\n  const [formData, setFormData] = useState({\n    name: '',\n    email: '',\n    password: '',\n    role: 'USER',\n  });\n\n  const { data: users = [], isLoading, error } = useUsers();\n  const createMutation = useCreateUser();\n  const updateMutation = useUpdateUser();\n  const deleteMutation = useDeleteUser();\n\n  if (currentUser?.role !== 'ADMIN') {\n    return (\n      <div className=\"space-y-6\">\n        <Alert variant=\"danger\">\n          Acesso negado. Voc√™ precisa ser ADMIN para acessar esta p√°gina.\n        </Alert>\n      </div>\n    );\n  }\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n\n    try {\n      if (editingUser) {\n        const updateData = { ...formData };\n        if (!updateData.password) delete updateData.password;\n        await updateMutation.mutateAsync({ id: editingUser.id, data: updateData });\n      } else {\n        await createMutation.mutateAsync(formData);\n      }\n      setIsDialogOpen(false);\n      setEditingUser(null);\n      setFormData({ name: '', email: '', password: '', role: 'USER' });\n    } catch (err) {\n      console.error('Erro ao salvar usu√°rio:', err);\n    }\n  };\n\n  const handleEdit = (user) => {\n    setEditingUser(user);\n    setFormData({\n      name: user.name,\n      email: user.email,\n      password: '',\n      role: user.role,\n    });\n    setIsDialogOpen(true);\n  };\n\n  const handleDelete = async (userId) => {\n    if (userId === currentUser?.id) {\n      alert('Voc√™ n√£o pode deletar seu pr√≥prio usu√°rio!');\n      return;\n    }\n\n    if (window.confirm('Tem certeza que deseja excluir este usu√°rio?')) {\n      await deleteMutation.mutateAsync(userId);\n    }\n  };\n\n  const handleNewUser = () => {\n    setEditingUser(null);\n    setFormData({ name: '', email: '', password: '', role: 'USER' });\n    setIsDialogOpen(true);\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-gray-900\">Usu√°rios</h1>\n          <p className=\"text-gray-600 mt-2\">Gerencie usu√°rios e permiss√µes do sistema</p>\n        </div>\n        <Button onClick={handleNewUser}>\n          <Plus className=\"h-4 w-4 mr-2\" />\n          Novo Usu√°rio\n        </Button>\n      </div>\n\n      {error && (\n        <Alert variant=\"danger\">\n          Erro ao carregar usu√°rios: {error.message}\n        </Alert>\n      )}\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Lista de Usu√°rios</CardTitle>\n          <CardDescription>Total: {users.length} usu√°rios cadastrados</CardDescription>\n        </CardHeader>\n        <CardContent>\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead>ID</TableHead>\n                <TableHead>Nome</TableHead>\n                <TableHead>E-mail</TableHead>\n                <TableHead>Perfil</TableHead>\n                <TableHead>A√ß√µes</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {users.map((user) => (\n                <TableRow key={user.id}>\n                  <TableCell className=\"font-mono text-xs\">#{user.id}</TableCell>\n                  <TableCell className=\"font-medium\">\n                    <div className=\"flex items-center gap-2\">\n                      {user.role === 'ADMIN' ? (\n                        <Shield className=\"h-4 w-4 text-purple-600\" />\n                      ) : (\n                        <User className=\"h-4 w-4 text-gray-400\" />\n                      )}\n                      {user.name}\n                      {user.id === currentUser?.id && (\n                        <Badge variant=\"primary\">Voc√™</Badge>\n                      )}\n                    </div>\n                  </TableCell>\n                  <TableCell>{user.email}</TableCell>\n                  <TableCell>\n                    <Badge variant={user.role === 'ADMIN' ? 'purple' : 'default'}>\n                      {user.role}\n                    </Badge>\n                  </TableCell>\n                  <TableCell>\n                    <div className=\"flex items-center gap-2\">\n                      <Button\n                        size=\"sm\"\n                        variant=\"outline\"\n                        onClick={() => handleEdit(user)}\n                      >\n                        <Edit className=\"h-3 w-3\" />\n                      </Button>\n                      <Button\n                        size=\"sm\"\n                        variant=\"outline\"\n                        onClick={() => handleDelete(user.id)}\n                        disabled={deleteMutation.isLoading || user.id === currentUser?.id}\n                      >\n                        <Trash2 className=\"h-3 w-3\" />\n                      </Button>\n                    </div>\n                  </TableCell>\n                </TableRow>\n              ))}\n            </TableBody>\n          </Table>\n        </CardContent>\n      </Card>\n\n      <Dialog open={isDialogOpen} onClose={() => setIsDialogOpen(false)}>\n        <form onSubmit={handleSubmit}>\n          <DialogHeader>\n            <DialogTitle onClose={() => setIsDialogOpen(false)}>\n              {editingUser ? 'Editar Usu√°rio' : 'Novo Usu√°rio'}\n            </DialogTitle>\n          </DialogHeader>\n\n          <DialogContent>\n            <div className=\"space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Nome Completo\n                </label>\n                <Input\n                  value={formData.name}\n                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                  placeholder=\"Ex: Jo√£o Silva\"\n                  required\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  E-mail\n                </label>\n                <Input\n                  type=\"email\"\n                  value={formData.email}\n                  onChange={(e) => setFormData({ ...formData, email: e.target.value })}\n                  placeholder=\"usuario@exemplo.com\"\n                  required\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Senha {editingUser && '(deixe em branco para n√£o alterar)'}\n                </label>\n                <Input\n                  type=\"password\"\n                  value={formData.password}\n                  onChange={(e) => setFormData({ ...formData, password: e.target.value })}\n                  placeholder=\"Senha segura\"\n                  required={!editingUser}\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Perfil de Acesso\n                </label>\n                <Select\n                  value={formData.role}\n                  onChange={(e) => setFormData({ ...formData, role: e.target.value })}\n                >\n                  <option value=\"USER\">USER - Acesso limitado</option>\n                  <option value=\"ADMIN\">ADMIN - Acesso total</option>\n                </Select>\n              </div>\n            </div>\n          </DialogContent>\n\n          <DialogFooter>\n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              onClick={() => setIsDialogOpen(false)}\n            >\n              Cancelar\n            </Button>\n            <Button\n              type=\"submit\"\n              disabled={createMutation.isLoading || updateMutation.isLoading}\n            >\n              {(createMutation.isLoading || updateMutation.isLoading) ? (\n                <>\n                  <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                  Salvando...\n                </>\n              ) : (\n                'Salvar'\n              )}\n            </Button>\n          </DialogFooter>\n        </form>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":9118},"apps/api/models/ip_whitelist.py":{"content":"from sqlalchemy import Column, Integer, String, DateTime, ForeignKey\nfrom sqlalchemy.sql import func\nfrom sqlalchemy.orm import relationship\nfrom core.database import Base\n\n\nclass IpWhitelist(Base):\n    __tablename__ = \"ip_whitelist\"\n\n    id = Column(Integer, primary_key=True, index=True)\n    client_id = Column(Integer, ForeignKey(\"clients.id\", ondelete=\"CASCADE\"), nullable=False)\n    ip_address = Column(String(45), nullable=False)\n    label = Column(String(255), nullable=True)\n    created_by = Column(Integer, ForeignKey(\"users.id\"), nullable=True)\n    created_at = Column(DateTime(timezone=True), server_default=func.now())\n    \n    # Relationships\n    client = relationship(\"Client\", back_populates=\"ip_whitelist\")\n","size_bytes":723},"apps/api/models/audit_log.py":{"content":"from sqlalchemy import Column, Integer, String, DateTime, ForeignKey, JSON\nfrom sqlalchemy.orm import relationship\nfrom sqlalchemy.sql import func\nfrom core.database import Base\n\n\nclass AuditLog(Base):\n    __tablename__ = \"audit_logs\"\n\n    id = Column(Integer, primary_key=True, index=True)\n    actor_user_id = Column(Integer, ForeignKey(\"users.id\"), nullable=True)\n    client_id = Column(Integer, ForeignKey(\"clients.id\"), nullable=True)\n    action = Column(String(255), nullable=False)\n    payload_json = Column(JSON, nullable=True)\n    created_at = Column(DateTime(timezone=True), server_default=func.now())\n    \n    user = relationship(\"User\", foreign_keys=[actor_user_id])\n","size_bytes":678},"DEPLOYMENT.md":{"content":"# NovaGuardianTech - Guia de Deployment\n\n## üìã Pr√©-requisitos\n\n### Ambiente de Produ√ß√£o\n- Python 3.11+\n- Node.js 18+\n- PostgreSQL 16\n- Docker & Docker Compose\n- 4GB RAM m√≠nimo\n- 20GB disco\n\n### Secrets Necess√°rios\n```bash\nDATABASE_URL=postgresql://user:pass@host:5432/dbname\nJWT_SECRET=<gerar com: openssl rand -hex 32>\nSESSION_SECRET=<gerar com: openssl rand -hex 32>\n```\n\n## üöÄ Deploy no Replit\n\n### 1. Configurar Environment Variables\n\nNo painel Replit, adicione as seguintes secrets:\n\n```bash\n# Database (usar Neon PostgreSQL)\nDATABASE_URL=postgresql://...\n\n# Security\nJWT_SECRET=<secret-gerado>\nJWT_ALGORITHM=HS256\nJWT_EXPIRE_MINUTES=1440\n\n# Environment\nENVIRONMENT=production\n\n# API\nAPI_HOST=0.0.0.0\nAPI_PORT=8080\nAPI_RELOAD=false\n\n# CORS (adicionar dom√≠nios de produ√ß√£o)\nCORS_ORIGINS=https://seu-dominio.repl.co,https://seu-dominio.com\n\n# Database Pool (produ√ß√£o)\nDATABASE_POOL_SIZE=10\nDATABASE_MAX_OVERFLOW=20\nDATABASE_POOL_TIMEOUT=30\nDATABASE_POOL_RECYCLE=3600\n\n# Docker\nDOCKER_NETWORK=novaguardian\nPIHOLE_BASE_PORT=8081\n```\n\n### 2. Deploy Autom√°tico\n\nO Replit est√° configurado para deploy autom√°tico. O build faz:\n\n```bash\n1. Frontend: npm install && npm run build\n2. Backend: pip install -r requirements.txt\n3. Migrations: Executadas automaticamente no startup\n```\n\n### 3. Verificar Deploy\n\n```bash\n# Health check\ncurl https://seu-app.repl.co/health\n\n# API docs\nhttps://seu-app.repl.co/docs\n\n# Frontend\nhttps://seu-app.repl.co/\n```\n\n## üê≥ Deploy com Docker (Self-Hosted)\n\n### 1. Build das Imagens\n\n```bash\n# Build do backend\ndocker build -t novaguardian-api:latest -f apps/api/Dockerfile .\n\n# Build do frontend\ndocker build -t novaguardian-web:latest -f apps/web/Dockerfile .\n```\n\n### 2. Deploy Completo\n\n```bash\n# Subir infraestrutura\ndocker-compose -f docker-compose.prod.yml up -d\n\n# Executar migrations\ndocker exec novaguardian-api python /app/tools/migrate.py\n\n# Verificar status\ndocker-compose ps\n```\n\n### 3. Setup Inicial\n\n```bash\n# Popular banco com dados iniciais\ndocker exec -it novaguardian-api python /app/tools/seed.py\n\n# Criar primeiro admin\ndocker exec -it novaguardian-api python -c \"\nfrom tools.create_admin import create_admin\ncreate_admin('admin@example.com', 'senha-forte-aqui', 'Admin Name')\n\"\n```\n\n## üóÑÔ∏è Database Management\n\n### Backups Autom√°ticos\n\n```bash\n# Backup manual\n./tools/backup_database.sh .backups\n\n# Configurar cron para backup di√°rio (3AM)\n0 3 * * * /path/to/tools/backup_database.sh /backups\n```\n\n### Restore de Backup\n\n```bash\n./tools/restore_database.sh .backups/novaguardian_backup_20251113_030000.sql\n```\n\n### Migrations\n\n```bash\n# Desenvolvimento: Criar nova migration\ncd apps/api\nalembic revision --autogenerate -m \"Descri√ß√£o da mudan√ßa\"\n\n# Produ√ß√£o: Aplicar migrations\npython tools/migrate.py\n```\n\n## üîß Multi-Instance Pi-hole Setup\n\n### Provisionar Primeira Inst√¢ncia\n\n```bash\n# 1. Obter token de admin\nTOKEN=$(curl -X POST https://seu-app/auth/login \\\n  -H \"Content-Type: application/x-www-form-urlencoded\" \\\n  -d \"username=admin@example.com&password=senha\" \\\n  | jq -r '.access_token')\n\n# 2. Provisionar Pi-hole para cliente\ncurl -X POST https://seu-app/admin/pihole/provision \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"client_id\": 1,\n    \"public_ip\": \"203.0.113.10\",\n    \"password\": \"pihole-senha-cliente-1\"\n  }'\n\n# 3. Atualizar dnsdist config\ncurl -X POST https://seu-app/admin/pihole/dnsdist/update-config \\\n  -H \"Authorization: Bearer $TOKEN\"\n\n# 4. Sincronizar regras DNS\ncurl -X POST https://seu-app/dns/sync \\\n  -H \"Authorization: Bearer $TOKEN\"\n```\n\n### Listar Todas as Inst√¢ncias\n\n```bash\ncurl -X GET https://seu-app/admin/pihole/list \\\n  -H \"Authorization: Bearer $TOKEN\"\n```\n\n### Deprovision Inst√¢ncia\n\n```bash\ncurl -X DELETE https://seu-app/admin/pihole/1 \\\n  -H \"Authorization: Bearer $TOKEN\"\n```\n\n## üìä Monitoramento\n\n### Health Checks\n\n```bash\n# Script autom√°tico\n./tools/health_check.sh\n\n# Manual\ncurl https://seu-app/health\n```\n\n### M√©tricas Importantes\n\n- **API Response Time**: < 200ms (p95)\n- **Database Connections**: < 80% do pool\n- **Pi-hole Containers**: Todos \"running\"\n- **DNS Query Rate**: Monitorar via dnsdist:8053\n\n### Logs\n\n```bash\n# API logs\ndocker logs -f novaguardian-api\n\n# Frontend logs\ndocker logs -f novaguardian-web\n\n# Pi-hole espec√≠fico\ndocker logs -f pihole-client-1\n\n# dnsdist logs\ndocker logs -f novaguardian-dnsdist\n```\n\n## üîí Seguran√ßa\n\n### SSL/TLS\n\n```bash\n# Com Traefik (recomendado)\ndocker-compose -f docker-compose.traefik.yml up -d\n\n# Ou com Nginx + Certbot\ncertbot --nginx -d seu-dominio.com\n```\n\n### Firewall\n\n```bash\n# Permitir apenas portas necess√°rias\nufw allow 22/tcp    # SSH\nufw allow 80/tcp    # HTTP\nufw allow 443/tcp   # HTTPS\nufw allow 5353/udp  # DNS (apenas rede interna)\nufw enable\n```\n\n### Rate Limiting\n\nConfigurado automaticamente:\n- `/auth/login`: 5 req/min por IP\n- `/dns/sync`: 10 req/min por token\n- `/domains`: 100 req/min por token\n\n## üîÑ Rollback\n\n### Rollback Completo\n\n```bash\n# 1. Parar servi√ßos\ndocker-compose down\n\n# 2. Restaurar backup\n./tools/restore_database.sh .backups/novaguardian_backup_TIMESTAMP.sql\n\n# 3. Voltar para vers√£o anterior (Git)\ngit checkout <commit-hash-anterior>\n\n# 4. Rebuild e restart\ndocker-compose build\ndocker-compose up -d\n```\n\n### Rollback de C√≥digo (Manter DB)\n\n```bash\n# Usar Replit Rollback\n# Ou Git:\ngit revert <commit-hash>\ngit push\n```\n\n## üìà Scaling\n\n### Horizontal Scaling\n\n```bash\n# Aumentar r√©plicas da API\ndocker-compose up -d --scale api=3\n\n# Load balancer (Nginx)\nupstream novaguardian_api {\n    server api1:8080;\n    server api2:8080;\n    server api3:8080;\n}\n```\n\n### Database Scaling\n\n```bash\n# Neon auto-scale (recomendado)\n# Ou PostgreSQL Read Replicas:\nDATABASE_WRITE_URL=postgresql://master/db\nDATABASE_READ_URL=postgresql://replica/db\n```\n\n### Pi-hole Scaling\n\n- 1 inst√¢ncia por cliente (j√° implementado)\n- dnsdist distribui automaticamente\n- Limite: ~100 inst√¢ncias por servidor (4GB RAM cada)\n\n## üÜò Troubleshooting\n\n### API n√£o inicia\n\n```bash\n# 1. Verificar logs\ndocker logs novaguardian-api\n\n# 2. Verificar database\n./tools/health_check.sh\n\n# 3. Verificar secrets\nenv | grep DATABASE_URL\n```\n\n### Pi-hole n√£o provisiona\n\n```bash\n# 1. Verificar Docker\ndocker ps\n\n# 2. Verificar network\ndocker network inspect novaguardian\n\n# 3. Verificar logs\ndocker logs pihole-client-X\n```\n\n### Frontend n√£o carrega\n\n```bash\n# 1. Verificar build\ncd apps/web && npm run build\n\n# 2. Verificar API connection\ncurl http://localhost:8080/health\n\n# 3. Verificar CORS\n# Adicionar origem no CORS_ORIGINS\n```\n\n## üìû Support Checklist\n\nAntes de reportar problemas, executar:\n\n```bash\n# 1. Health check\n./tools/health_check.sh\n\n# 2. Coletar logs\ndocker-compose logs > logs.txt\n\n# 3. Verificar vers√µes\ndocker --version\npython --version\nnode --version\n\n# 4. Verificar recursos\ndf -h\nfree -h\ndocker stats --no-stream\n```\n\n## üéØ Production Checklist\n\n- [ ] DATABASE_URL configurado (Neon PostgreSQL)\n- [ ] JWT_SECRET gerado e configurado\n- [ ] CORS_ORIGINS com dom√≠nios de produ√ß√£o\n- [ ] SSL/TLS configurado\n- [ ] Backups autom√°ticos configurados\n- [ ] Health checks funcionando\n- [ ] Rate limiting testado\n- [ ] Logs centralizados\n- [ ] Monitoramento configurado\n- [ ] Firewall configurado\n- [ ] DNS roteamento testado\n- [ ] Multi-inst√¢ncia Pi-hole testada\n- [ ] Rollback procedure testada\n- [ ] Documenta√ß√£o de runbook criada\n","size_bytes":7410},"apps/api/models/__init__.py":{"content":"from .user import User, UserRole\nfrom .client import Client\nfrom .location import Location\nfrom .pihole_instance import PiholeInstance, PiholeMode\nfrom .domain_rule import DomainRule, DomainKind, DomainStatus\nfrom .ip_whitelist import IpWhitelist\nfrom .audit_log import AuditLog\n\n__all__ = [\n    \"User\",\n    \"UserRole\",\n    \"Client\",\n    \"Location\",\n    \"PiholeInstance\",\n    \"PiholeMode\",\n    \"DomainRule\",\n    \"DomainKind\",\n    \"DomainStatus\",\n    \"IpWhitelist\",\n    \"AuditLog\",\n]\n","size_bytes":483},"PHASE_C_SUMMARY.md":{"content":"# üéâ FASE C COMPLETA - Infraestrutura DNS\n\n## ‚úÖ O que foi implementado\n\n### 1. Docker Compose Completo\n- **dnsdist**: Roteamento DNS por IP de origem (porta 5353)\n- **Pi-hole**: Bloqueio DNS com gravity database (porta 8081)\n- **PostgreSQL**: Banco local para desenvolvimento (porta 5432)\n- **Rede Docker**: IPs est√°ticos (172.20.0.0/16)\n- **Volumes persistentes**: Dados sobrevivem a restarts\n\n### 2. PiholeService - Sincroniza√ß√£o Inteligente\n```python\n# Sincroniza√ß√£o incremental e idempotente\nsync_domains(domains):\n  1. Query gravity.db ‚Üí obter estado atual (sqlite3)\n  2. Calcular diff ‚Üí adicionar vs remover\n  3. Remover obsoletos ‚Üí pihole -b -d <domain>\n  4. Adicionar novos ‚Üí pihole -b <domain> --comment NovaGuardian\n  5. Reload DNS ‚Üí pihole restartdns reload-lists\n```\n\n**Features**:\n- ‚úÖ Idempotente (m√∫ltiplas execu√ß√µes = mesmo resultado)\n- ‚úÖ Incremental (s√≥ muda o necess√°rio)\n- ‚úÖ Rastre√°vel (comment='NovaGuardian')\n- ‚úÖ Persistente (gravity.db em volume)\n- ‚úÖ Suporta EXACT e REGEX\n\n### 3. Endpoint /dns/sync\n```bash\nPOST /dns/sync\nAuthorization: Bearer <token>\n\nResponse:\n{\n  \"ok\": true,\n  \"client_id\": 1,\n  \"container_name\": \"pihole-demo\",\n  \"added\": [{\"domain\": \"instagram.com\", \"kind\": \"EXACT\"}],\n  \"failed\": [],\n  \"total\": 5,\n  \"took_ms\": 234\n}\n```\n\n### 4. Ferramentas de Desenvolvimento\n- **Makefile**: Comandos √∫teis (dev, logs, dns-test, clean)\n- **setup-pihole.sh**: Configura√ß√£o p√≥s-deploy\n- **docker-compose.yml**: Orquestra√ß√£o completa\n- **Documenta√ß√£o**: infra/pihole/README.md\n\n### 5. Arquitetura Implementada\n```\nCliente DNS Query (IP: 203.0.113.10)\n         ‚Üì\n    dnsdist:5353 (roteamento por IP)\n         ‚Üì\n   pihole-demo:53 (consulta gravity.db)\n         ‚Üì\n    BLOQUEADO? ‚Üí NXDOMAIN\n    PERMITIDO? ‚Üí upstream DNS (1.1.1.1, 8.8.8.8)\n```\n\n## üîß Corre√ß√µes Aplicadas (Architect Reviews)\n\n### Itera√ß√£o 1 ‚Üí Problema: setup.sh n√£o executava\n**Fix**: Removido mount do setup.sh, criado script manual `tools/setup-pihole.sh`\n\n### Itera√ß√£o 2 ‚Üí Problema: custom.list n√£o √© usado pelo gravity\n**Fix**: Reescrito sync_domains para usar `pihole -b` + gravity.db queries\n\n### Itera√ß√£o 3 ‚Üí Problema: n√£o removia entradas obsoletas\n**Fix**: Implementado c√°lculo de diff (to_add vs to_remove)\n\n### Itera√ß√£o 4 ‚Üí Problema: --comment nas dele√ß√µes causava erro\n**Fix**: Removido `--comment` flag dos comandos de remo√ß√£o\n\n## üöÄ Como Usar\n\n### Iniciar Infraestrutura\n```bash\nmake dev                        # Sobe containers\nbash tools/setup-pihole.sh      # Configura Pi-hole (uma vez)\n```\n\n### Sincronizar Dom√≠nios\n```bash\n# Via API\ncurl -X POST http://localhost:8080/dns/sync \\\n  -H \"Authorization: Bearer <token>\"\n\n# Via Frontend\nDashboard ‚Üí Domains ‚Üí Sync DNS button\n```\n\n### Testar Bloqueio\n```bash\n# Dom√≠nio bloqueado (deve retornar NXDOMAIN)\ndig @127.0.0.1 -p 5353 instagram.com\n\n# Dom√≠nio permitido (deve resolver)\ndig @127.0.0.1 -p 5353 google.com\n```\n\n## üìä Interfaces Web\n\n| Servi√ßo | URL | Senha |\n|---------|-----|-------|\n| Frontend | http://localhost:5000 | admin123 |\n| API Docs | http://localhost:8080/docs | - |\n| Pi-hole Admin | http://localhost:8081/admin | novaguardian123 |\n| dnsdist Web | http://localhost:8053 | novaguardian-dnsdist-2024 |\n\n## üìÅ Arquivos Criados/Modificados\n\n### Novos\n- ‚úÖ `docker-compose.yml` - Orquestra√ß√£o completa\n- ‚úÖ `infra/dnsdist/dnsdist.conf` - Config roteamento DNS\n- ‚úÖ `apps/api/services/pihole.py` - Integra√ß√£o Pi-hole\n- ‚úÖ `tools/setup-pihole.sh` - Setup p√≥s-deploy\n- ‚úÖ `Makefile` - Comandos √∫teis\n- ‚úÖ `infra/pihole/README.md` - Doc Pi-hole\n- ‚úÖ `QUICKSTART.md` - Guia r√°pido\n- ‚úÖ `.env.example` - Vari√°veis de ambiente\n\n### Modificados\n- ‚úÖ `apps/api/routers/dns.py` - Adicionado /dns/sync endpoint\n- ‚úÖ `replit.md` - Atualizado com Fase C completa\n- ‚úÖ `README.md` - Atualizado com info DNS\n\n## üéØ Crit√©rios de Aceite - TODOS CUMPRIDOS\n\n- ‚úÖ dnsdist roteando para Pi-hole por IP de origem\n- ‚úÖ Volumes persistem dados entre rein√≠cios\n- ‚úÖ API executa comandos no container Pi-hole via docker exec\n- ‚úÖ Sincroniza√ß√£o incremental e idempotente\n- ‚úÖ Suporte a dom√≠nios EXACT e REGEX\n- ‚úÖ Gravity database atualizado corretamente\n- ‚úÖ DNS reload autom√°tico ap√≥s sync\n- ‚úÖ Comment tracking para identificar entradas\n\n## üéì Li√ß√µes Aprendidas\n\n### Pi-hole Gravity Database\n- `custom.list` n√£o √© para blocklist (apenas DNS overrides)\n- Usar `pihole -b` + gravity.db √© o m√©todo correto\n- Comment tracking permite gest√£o multi-tenant\n- `pihole -g` n√£o √© necess√°rio com `pihole -b`\n- `pihole restartdns reload-lists` aplica mudan√ßas\n\n### Docker Compose\n- Scripts bind-mounted n√£o executam automaticamente\n- Setup manual p√≥s-deploy √© mais confi√°vel\n- Volumes garantem persist√™ncia\n\n### Sincroniza√ß√£o Idempotente\n- Query estado atual antes de modificar\n- Calcular diff (adicionar vs remover)\n- Executar apenas mudan√ßas necess√°rias\n- Validar resultado final\n\n## üìã Pr√≥ximos Passos (Fase D)\n\n1. ‚úÖ Testar bloqueio DNS real com `dig`\n2. ‚úÖ Validar persist√™ncia ap√≥s restart\n3. ‚úÖ Testar m√∫ltiplos dom√≠nios\n4. üìã Deploy em produ√ß√£o\n5. üìã Backups autom√°ticos\n6. üìã Monitoramento e alertas\n7. üìã M√∫ltiplas inst√¢ncias Pi-hole (multi-cliente)\n\n## üèÜ Status Final\n\n**Fase C: COMPLETA ‚úÖ**\n\nTodas as tarefas foram implementadas, revisadas pelo architect, e aprovadas. \nSistema pronto para testes de integra√ß√£o e deploy em produ√ß√£o (Fase D).\n","size_bytes":5470},"apps/api/services/pihole_manager.py":{"content":"import docker\nfrom docker.models.containers import Container\nfrom docker.errors import DockerException, NotFound, APIError\nfrom typing import Dict, Any, Optional, List\nfrom sqlalchemy.orm import Session\nfrom models.pihole_instance import PiholeInstance\nfrom models.client import Client\nfrom core.config import settings\nimport ipaddress\n\n\nclass PiholeManager:\n    def __init__(self):\n        try:\n            self.client = docker.from_env()\n        except DockerException as e:\n            raise Exception(f\"Failed to connect to Docker: {str(e)}\")\n    \n    def _get_next_ip(self, db: Session) -> str:\n        instances = db.query(PiholeInstance).all()\n        used_ips = {inst.internal_ip for inst in instances if inst.internal_ip}\n        \n        base_network = ipaddress.ip_network(settings.PIHOLE_SUBNET)\n        start_ip = int(ipaddress.ip_address(f\"172.20.0.{settings.PIHOLE_IP_START}\"))\n        \n        for i in range(settings.PIHOLE_IP_START, 255):\n            candidate_ip = str(ipaddress.ip_address(f\"172.20.0.{i}\"))\n            if candidate_ip not in used_ips:\n                return candidate_ip\n        \n        raise Exception(\"No available IPs in subnet\")\n    \n    def _get_next_web_port(self, db: Session) -> int:\n        instances = db.query(PiholeInstance).all()\n        used_ports = {inst.web_port for inst in instances if inst.web_port}\n        \n        port = settings.PIHOLE_BASE_PORT\n        while port in used_ports:\n            port += 1\n            if port > 9999:\n                raise Exception(\"No available ports\")\n        \n        return port\n    \n    def provision_instance(\n        self,\n        db: Session,\n        client_id: int,\n        public_ip: str,\n        password: str = \"novaguardian123\"\n    ) -> Dict[str, Any]:\n        client = db.query(Client).filter(Client.id == client_id).first()\n        if not client:\n            raise ValueError(f\"Client {client_id} not found\")\n        \n        existing = db.query(PiholeInstance).filter(\n            PiholeInstance.client_id == client_id\n        ).first()\n        if existing:\n            raise ValueError(f\"Pi-hole instance already exists for client {client_id}\")\n        \n        container_name = f\"pihole-client-{client_id}\"\n        internal_ip = self._get_next_ip(db)\n        web_port = self._get_next_web_port(db)\n        \n        try:\n            network = self.client.networks.get(settings.DOCKER_NETWORK)\n        except NotFound:\n            raise Exception(f\"Docker network '{settings.DOCKER_NETWORK}' not found. Run 'docker-compose up' first.\")\n        \n        try:\n            container = self.client.containers.run(\n                settings.PIHOLE_IMAGE,\n                name=container_name,\n                hostname=container_name,\n                detach=True,\n                environment={\n                    \"TZ\": \"America/Sao_Paulo\",\n                    \"WEBPASSWORD\": password,\n                    \"FTLCONF_LOCAL_IPV4\": internal_ip,\n                    \"PIHOLE_DNS_\": \"1.1.1.1;8.8.8.8\",\n                    \"DNSMASQ_LISTENING\": \"all\",\n                    \"DNSSEC\": \"false\",\n                    \"REV_SERVER\": \"false\",\n                    \"BLOCKING_ENABLED\": \"true\",\n                },\n                volumes={\n                    f\"pihole_client_{client_id}_etc\": {\"bind\": \"/etc/pihole\", \"mode\": \"rw\"},\n                    f\"pihole_client_{client_id}_dnsmasq\": {\"bind\": \"/etc/dnsmasq.d\", \"mode\": \"rw\"},\n                },\n                ports={\n                    \"80/tcp\": web_port,\n                },\n                dns=[\"127.0.0.1\", \"1.1.1.1\"],\n                cap_add=[\"NET_ADMIN\"],\n                restart_policy={\"Name\": \"unless-stopped\"},\n            )\n            \n            network.connect(container, ipv4_address=internal_ip)\n            \n        except APIError as e:\n            raise Exception(f\"Failed to create container: {str(e)}\")\n        \n        pihole_instance = PiholeInstance(\n            client_id=client_id,\n            container_name=container_name,\n            internal_ip=internal_ip,\n            public_ip=public_ip,\n            dns_port=53,\n            web_port=web_port,\n            admin_password=password,\n            status=\"running\",\n        )\n        \n        db.add(pihole_instance)\n        db.commit()\n        db.refresh(pihole_instance)\n        \n        return {\n            \"id\": pihole_instance.id,\n            \"client_id\": client_id,\n            \"client_name\": client.name,\n            \"container_name\": container_name,\n            \"internal_ip\": internal_ip,\n            \"public_ip\": public_ip,\n            \"dns_port\": 53,\n            \"web_port\": web_port,\n            \"web_url\": f\"http://localhost:{web_port}/admin\",\n            \"status\": \"running\",\n            \"container_id\": container.id,\n        }\n    \n    def deprovision_instance(self, db: Session, client_id: int) -> Dict[str, Any]:\n        instance = db.query(PiholeInstance).filter(\n            PiholeInstance.client_id == client_id\n        ).first()\n        \n        if not instance:\n            raise ValueError(f\"No Pi-hole instance found for client {client_id}\")\n        \n        try:\n            container = self.client.containers.get(instance.container_name)\n            container.stop(timeout=10)\n            container.remove(v=True)\n        except NotFound:\n            pass\n        except APIError as e:\n            raise Exception(f\"Failed to remove container: {str(e)}\")\n        \n        db.delete(instance)\n        db.commit()\n        \n        return {\n            \"success\": True,\n            \"message\": f\"Pi-hole instance for client {client_id} removed\",\n            \"container_name\": instance.container_name,\n        }\n    \n    def get_instance_status(self, container_name: str) -> Dict[str, Any]:\n        try:\n            container = self.client.containers.get(container_name)\n            return {\n                \"status\": container.status,\n                \"health\": container.attrs.get(\"State\", {}).get(\"Health\", {}).get(\"Status\"),\n                \"running\": container.status == \"running\",\n                \"container_id\": container.id,\n            }\n        except NotFound:\n            return {\n                \"status\": \"not_found\",\n                \"running\": False,\n            }\n    \n    def list_instances(self, db: Session) -> List[Dict[str, Any]]:\n        instances = db.query(PiholeInstance).all()\n        result = []\n        \n        for instance in instances:\n            status = self.get_instance_status(instance.container_name)\n            client = db.query(Client).filter(Client.id == instance.client_id).first()\n            \n            result.append({\n                \"id\": instance.id,\n                \"client_id\": instance.client_id,\n                \"client_name\": client.name if client else \"Unknown\",\n                \"container_name\": instance.container_name,\n                \"internal_ip\": instance.internal_ip,\n                \"public_ip\": instance.public_ip,\n                \"dns_port\": instance.dns_port,\n                \"web_port\": instance.web_port,\n                \"web_url\": f\"http://localhost:{instance.web_port}/admin\",\n                \"status\": status[\"status\"],\n                \"running\": status[\"running\"],\n            })\n        \n        return result\n    \n    def restart_instance(self, container_name: str) -> Dict[str, Any]:\n        try:\n            container = self.client.containers.get(container_name)\n            container.restart(timeout=10)\n            return {\n                \"success\": True,\n                \"message\": f\"Container {container_name} restarted\",\n                \"status\": container.status,\n            }\n        except NotFound:\n            raise ValueError(f\"Container {container_name} not found\")\n        except APIError as e:\n            raise Exception(f\"Failed to restart container: {str(e)}\")\n    \n    def update_dnsdist_config(self, db: Session) -> Dict[str, Any]:\n        instances = db.query(PiholeInstance).filter(\n            PiholeInstance.status == \"running\"\n        ).all()\n        \n        pools_config = []\n        routing_rules = []\n        \n        for instance in instances:\n            pool_name = f\"client_{instance.client_id}\"\n            \n            pools_config.append(\n                f'newServer({{address=\"{instance.internal_ip}:53\", name=\"{instance.container_name}\", pool=\"{pool_name}\"}})'\n            )\n            \n            routing_rules.append(\n                f'addAction(NetmaskGroupRule(newNMG({{\"{instance.public_ip}/32\"}})), PoolAction(\"{pool_name}\"))'\n            )\n        \n        config_template = f\"\"\"-- dnsdist configuration for multi-client DNS routing\n-- Auto-generated by NovaGuardianTech\n\n-- Listen on all interfaces, port 5353\nsetLocal(\"0.0.0.0:5353\")\n\n-- Logging\nsetVerbose(true)\n\n-- Backend Pi-hole instances\n{chr(10).join(pools_config)}\n\n-- Default fallback (Google DNS)\nnewServer({{address=\"8.8.8.8:53\", name=\"google-dns\", pool=\"default\"}})\n\n-- Routing rules based on source IP\n{chr(10).join(routing_rules)}\n\n-- All other IPs use default pool (Google DNS)\naddAction(AllRule(), PoolAction(\"default\"))\n\n-- Statistics and web interface\nwebserver(\"0.0.0.0:8053\")\nsetWebserverConfig({{password=\"novaguardian-dnsdist-2024\", apiKey=\"novaguardian-api-key\"}})\n\n-- Health checks\nsetServerPolicy(firstAvailable)\n\n-- Cache settings\npc = newPacketCache(10000, {{maxTTL=86400, minTTL=0}})\n{chr(10).join([f'getPool(\"client_{i.client_id}\"):setCache(pc)' for i in instances])}\n\nprint(\"dnsdist configured with {len(instances)} Pi-hole instances\")\n\"\"\"\n        \n        return {\n            \"instances_count\": len(instances),\n            \"config\": config_template,\n            \"pools\": [f\"client_{i.client_id}\" for i in instances],\n        }\n","size_bytes":9669},"apps/web/src/pages/Clients.jsx":{"content":"import { useState } from 'react';\nimport { Plus, Edit, Trash2, Loader2 } from 'lucide-react';\nimport { Card, CardHeader, CardTitle, CardDescription, CardContent } from '@/components/ui/Card';\nimport Button from '@/components/ui/Button';\nimport Input from '@/components/ui/Input';\nimport Badge from '@/components/ui/Badge';\nimport { Table, TableHeader, TableBody, TableRow, TableHead, TableCell } from '@/components/ui/Table';\nimport { Dialog, DialogHeader, DialogTitle, DialogContent, DialogFooter } from '@/components/ui/Dialog';\nimport Alert from '@/components/ui/Alert';\nimport { useClients, useCreateClient, useUpdateClient, useDeleteClient } from '@/hooks/useClients';\n\nexport default function Clients() {\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [editingClient, setEditingClient] = useState(null);\n  const [formData, setFormData] = useState({ name: '', public_ip: '', pihole_password: '' });\n  \n  const { data: clients = [], isLoading, error } = useClients();\n  const createMutation = useCreateClient();\n  const updateMutation = useUpdateClient();\n  const deleteMutation = useDeleteClient();\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    \n    try {\n      if (editingClient) {\n        await updateMutation.mutateAsync({ id: editingClient.id, data: formData });\n      } else {\n        await createMutation.mutateAsync(formData);\n      }\n      setIsDialogOpen(false);\n      setEditingClient(null);\n      setFormData({ name: '', public_ip: '', pihole_password: '' });\n    } catch (err) {\n      console.error('Erro ao salvar cliente:', err);\n    }\n  };\n\n  const handleEdit = (client) => {\n    setEditingClient(client);\n    setFormData({\n      name: client.name,\n      public_ip: client.public_ip,\n      pihole_password: client.pihole_password || '',\n    });\n    setIsDialogOpen(true);\n  };\n\n  const handleDelete = async (clientId) => {\n    if (window.confirm('Tem certeza que deseja excluir este cliente?')) {\n      await deleteMutation.mutateAsync(clientId);\n    }\n  };\n\n  const handleNewClient = () => {\n    setEditingClient(null);\n    setFormData({ name: '', public_ip: '', pihole_password: '' });\n    setIsDialogOpen(true);\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-gray-900\">Clientes</h1>\n          <p className=\"text-gray-600 mt-2\">Gerencie os clientes e suas configura√ß√µes DNS</p>\n        </div>\n        <Button onClick={handleNewClient}>\n          <Plus className=\"h-4 w-4 mr-2\" />\n          Novo Cliente\n        </Button>\n      </div>\n\n      {error && (\n        <Alert variant=\"danger\">\n          Erro ao carregar clientes: {error.message}\n        </Alert>\n      )}\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Lista de Clientes</CardTitle>\n          <CardDescription>Total: {clients.length} clientes cadastrados</CardDescription>\n        </CardHeader>\n        <CardContent>\n          {clients.length === 0 ? (\n            <div className=\"text-center py-12\">\n              <p className=\"text-gray-500\">Nenhum cliente cadastrado ainda.</p>\n              <Button onClick={handleNewClient} variant=\"outline\" className=\"mt-4\">\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Adicionar Primeiro Cliente\n              </Button>\n            </div>\n          ) : (\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>ID</TableHead>\n                  <TableHead>Nome</TableHead>\n                  <TableHead>IP P√∫blico</TableHead>\n                  <TableHead>Status</TableHead>\n                  <TableHead>A√ß√µes</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {clients.map((client) => (\n                  <TableRow key={client.id}>\n                    <TableCell className=\"font-mono text-xs\">#{client.id}</TableCell>\n                    <TableCell className=\"font-medium\">{client.name}</TableCell>\n                    <TableCell className=\"font-mono text-xs\">{client.public_ip}</TableCell>\n                    <TableCell>\n                      <Badge variant=\"success\">Ativo</Badge>\n                    </TableCell>\n                    <TableCell>\n                      <div className=\"flex items-center gap-2\">\n                        <Button\n                          size=\"sm\"\n                          variant=\"outline\"\n                          onClick={() => handleEdit(client)}\n                        >\n                          <Edit className=\"h-3 w-3\" />\n                        </Button>\n                        <Button\n                          size=\"sm\"\n                          variant=\"outline\"\n                          onClick={() => handleDelete(client.id)}\n                          disabled={deleteMutation.isLoading}\n                        >\n                          <Trash2 className=\"h-3 w-3\" />\n                        </Button>\n                      </div>\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          )}\n        </CardContent>\n      </Card>\n\n      <Dialog open={isDialogOpen} onClose={() => setIsDialogOpen(false)}>\n        <form onSubmit={handleSubmit}>\n          <DialogHeader>\n            <DialogTitle onClose={() => setIsDialogOpen(false)}>\n              {editingClient ? 'Editar Cliente' : 'Novo Cliente'}\n            </DialogTitle>\n          </DialogHeader>\n\n          <DialogContent>\n            <div className=\"space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Nome do Cliente\n                </label>\n                <Input\n                  value={formData.name}\n                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                  placeholder=\"Ex: Empresa XYZ\"\n                  required\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  IP P√∫blico\n                </label>\n                <Input\n                  value={formData.public_ip}\n                  onChange={(e) => setFormData({ ...formData, public_ip: e.target.value })}\n                  placeholder=\"Ex: 203.0.113.10\"\n                  required\n                />\n                <p className=\"text-xs text-gray-500 mt-1\">\n                  IP p√∫blico do cliente para roteamento DNS\n                </p>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Senha Pi-hole (opcional)\n                </label>\n                <Input\n                  type=\"password\"\n                  value={formData.pihole_password}\n                  onChange={(e) => setFormData({ ...formData, pihole_password: e.target.value })}\n                  placeholder=\"Senha para admin Pi-hole\"\n                />\n              </div>\n            </div>\n          </DialogContent>\n\n          <DialogFooter>\n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              onClick={() => setIsDialogOpen(false)}\n            >\n              Cancelar\n            </Button>\n            <Button\n              type=\"submit\"\n              disabled={createMutation.isLoading || updateMutation.isLoading}\n            >\n              {(createMutation.isLoading || updateMutation.isLoading) ? (\n                <>\n                  <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                  Salvando...\n                </>\n              ) : (\n                'Salvar'\n              )}\n            </Button>\n          </DialogFooter>\n        </form>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":8017},"apps/api/services/__init__.py":{"content":"# Services module","size_bytes":17},"apps/web/src/components/ui/Button.jsx":{"content":"import React from 'react';\nimport { cn } from '@/lib/utils';\n\nconst Button = React.forwardRef(({ className, variant = 'default', size = 'default', ...props }, ref) => {\n  const baseStyles = 'inline-flex items-center justify-center rounded-md font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50';\n  \n  const variants = {\n    default: 'bg-primary text-primary-foreground hover:bg-primary/90',\n    destructive: 'bg-destructive text-destructive-foreground hover:bg-destructive/90',\n    outline: 'border border-input bg-background hover:bg-accent hover:text-accent-foreground',\n    secondary: 'bg-secondary text-secondary-foreground hover:bg-secondary/80',\n    ghost: 'hover:bg-accent hover:text-accent-foreground',\n    link: 'text-primary underline-offset-4 hover:underline',\n  };\n\n  const sizes = {\n    default: 'h-10 px-4 py-2',\n    sm: 'h-9 rounded-md px-3',\n    lg: 'h-11 rounded-md px-8',\n    icon: 'h-10 w-10',\n  };\n\n  return (\n    <button\n      className={cn(baseStyles, variants[variant], sizes[size], className)}\n      ref={ref}\n      {...props}\n    />\n  );\n});\n\nButton.displayName = 'Button';\n\nexport default Button;\n","size_bytes":1222},"apps/web/src/components/ui/Select.jsx":{"content":"import { cn } from '@/lib/utils';\n\nexport default function Select({ className, error, ...props }) {\n  return (\n    <select\n      className={cn(\n        'block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm',\n        'focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent',\n        'disabled:bg-gray-100 disabled:cursor-not-allowed',\n        'text-sm',\n        error && 'border-red-500 focus:ring-red-500',\n        className\n      )}\n      {...props}\n    />\n  );\n}\n","size_bytes":500},"tools/seed.py":{"content":"import sys\nimport os\nfrom dotenv import load_dotenv\n\napi_dir = os.path.join(os.path.dirname(__file__), '..', 'apps', 'api')\nsys.path.insert(0, api_dir)\n\nenv_path = os.path.join(api_dir, '.env')\nload_dotenv(env_path)\n\nfrom sqlalchemy.orm import Session\nfrom core.database import SessionLocal, engine, Base\nfrom core.security import get_password_hash\n\nimport models\n\nfrom models import User, UserRole, Client, Location, PiholeInstance, PiholeMode\n\n\ndef create_tables():\n    Base.metadata.create_all(bind=engine)\n    print(\"‚úì Tables created successfully\")\n\n\ndef seed_database():\n    db: Session = SessionLocal()\n    \n    try:\n        print(\"\\nüå± Seeding database...\")\n        \n        demo_client = db.query(Client).filter(Client.slug == \"empresa-demo\").first()\n        if not demo_client:\n            demo_client = Client(\n                name=\"Empresa Demo\",\n                slug=\"empresa-demo\",\n                is_active=True\n            )\n            db.add(demo_client)\n            db.commit()\n            db.refresh(demo_client)\n            print(\"‚úì Demo client created: Empresa Demo\")\n        else:\n            print(\"‚äô Demo client already exists\")\n        \n        admin_user = db.query(User).filter(User.email == \"admin@novaguardian.com\").first()\n        if not admin_user:\n            admin_user = User(\n                name=\"Administrador\",\n                email=\"admin@novaguardian.com\",\n                password_hash=get_password_hash(\"admin123\"),\n                role=UserRole.ADMIN,\n                client_id=demo_client.id\n            )\n            db.add(admin_user)\n            print(\"‚úì Admin user created: admin@novaguardian.com / admin123\")\n        else:\n            if admin_user.client_id is None:\n                admin_user.client_id = demo_client.id\n                db.commit()\n                print(\"‚äô Admin user updated with client assignment\")\n            else:\n                print(\"‚äô Admin user already exists\")\n        \n        demo_user = db.query(User).filter(User.email == \"user@example.com\").first()\n        if not demo_user:\n            demo_user = User(\n                name=\"Usu√°rio Demo\",\n                email=\"user@example.com\",\n                password_hash=get_password_hash(\"user123\"),\n                role=UserRole.USER,\n                client_id=demo_client.id\n            )\n            db.add(demo_user)\n            print(\"‚úì Demo user created: user@example.com / user123\")\n        else:\n            if demo_user.client_id is None:\n                demo_user.client_id = demo_client.id\n                db.commit()\n                print(\"‚äô Demo user updated with client assignment\")\n            else:\n                print(\"‚äô Demo user already exists\")\n        \n        db.commit()\n        \n        demo_location = db.query(Location).filter(Location.label == \"Escrit√≥rio Central\").first()\n        if not demo_location:\n            demo_location = Location(\n                client_id=demo_client.id,\n                label=\"Escrit√≥rio Central\",\n                public_ip=\"203.0.113.10\",\n                is_active=True\n            )\n            db.add(demo_location)\n            db.commit()\n            print(\"‚úì Demo location created: Escrit√≥rio Central\")\n        else:\n            print(\"‚äô Demo location already exists\")\n        \n        demo_pihole = db.query(PiholeInstance).filter(\n            PiholeInstance.container_name == \"pihole_cliente_demo\"\n        ).first()\n        if not demo_pihole:\n            demo_pihole = PiholeInstance(\n                client_id=demo_client.id,\n                container_name=\"pihole_cliente_demo\",\n                upstream_dns1=\"1.1.1.1\",\n                upstream_dns2=\"8.8.8.8\",\n                mode=PiholeMode.NXDOMAIN\n            )\n            db.add(demo_pihole)\n            db.commit()\n            print(\"‚úì Demo Pi-hole instance metadata created\")\n        else:\n            print(\"‚äô Demo Pi-hole instance already exists\")\n        \n        print(\"\\n‚úÖ Database seeded successfully!\")\n        print(\"\\nüìã Login Credentials:\")\n        print(\"   Admin:  admin@novaguardian.com / admin123\")\n        print(\"   User:   user@example.com / user123\")\n        \n    except Exception as e:\n        print(f\"\\n‚ùå Error seeding database: {e}\")\n        import traceback\n        traceback.print_exc()\n        db.rollback()\n        raise\n    finally:\n        db.close()\n\n\nif __name__ == \"__main__\":\n    print(\"üöÄ NovaGuardianTech - Database Setup\")\n    create_tables()\n    seed_database()\n","size_bytes":4490},"apps/api/schemas/ip_whitelist.py":{"content":"from pydantic import BaseModel, Field, field_validator\nfrom datetime import datetime\nfrom typing import Optional\nimport re\n\n\nclass IpWhitelistBase(BaseModel):\n    ip_address: str = Field(..., min_length=7, max_length=45)\n    label: Optional[str] = Field(None, max_length=255)\n\n    @field_validator('ip_address')\n    @classmethod\n    def validate_ip(cls, v):\n        ipv4_pattern = r'^(\\d{1,3}\\.){3}\\d{1,3}$'\n        ipv6_pattern = r'^([0-9a-fA-F]{0,4}:){7}[0-9a-fA-F]{0,4}$'\n        \n        if not (re.match(ipv4_pattern, v) or re.match(ipv6_pattern, v)):\n            raise ValueError('Invalid IP address format')\n        \n        return v\n\n\nclass IpWhitelistCreate(IpWhitelistBase):\n    client_id: Optional[int] = None\n\n\nclass IpWhitelistResponse(IpWhitelistBase):\n    id: int\n    client_id: int\n    created_by: Optional[int]\n    created_at: datetime\n\n    class Config:\n        from_attributes = True\n","size_bytes":903},"apps/api/schemas/__init__.py":{"content":"# Schemas module","size_bytes":16},"apps/api/models/domain_rule.py":{"content":"from sqlalchemy import Column, Integer, String, DateTime, ForeignKey, Enum, Text\nfrom sqlalchemy.sql import func\nfrom sqlalchemy.orm import relationship\nfrom core.database import Base\nimport enum\n\n\nclass DomainKind(str, enum.Enum):\n    EXACT = \"EXACT\"\n    REGEX = \"REGEX\"\n\n\nclass DomainStatus(str, enum.Enum):\n    ACTIVE = \"ACTIVE\"\n    INACTIVE = \"INACTIVE\"\n\n\nclass DomainRule(Base):\n    __tablename__ = \"domain_rules\"\n\n    id = Column(Integer, primary_key=True, index=True)\n    client_id = Column(Integer, ForeignKey(\"clients.id\", ondelete=\"CASCADE\"), nullable=False)\n    domain = Column(String(500), nullable=False)\n    kind = Column(Enum(DomainKind), default=DomainKind.EXACT, nullable=False)\n    status = Column(Enum(DomainStatus), default=DomainStatus.ACTIVE, nullable=False)\n    reason = Column(Text, nullable=True)\n    created_by = Column(Integer, ForeignKey(\"users.id\"), nullable=True)\n    created_at = Column(DateTime(timezone=True), server_default=func.now())\n    updated_at = Column(DateTime(timezone=True), server_default=func.now(), onupdate=func.now())\n    \n    # Relationships\n    client = relationship(\"Client\", back_populates=\"domain_rules\")\n","size_bytes":1159},"apps/web/src/hooks/useAudit.js":{"content":"import { useQuery } from '@tanstack/react-query';\nimport api from '@/lib/api';\n\nexport function useAuditLogs(params = {}) {\n  const queryParams = new URLSearchParams();\n  \n  if (params.user_id) queryParams.append('user_id', params.user_id);\n  if (params.action) queryParams.append('action', params.action);\n  if (params.client_id) queryParams.append('client_id', params.client_id);\n  if (params.limit) queryParams.append('limit', params.limit);\n  if (params.offset) queryParams.append('offset', params.offset);\n  \n  return useQuery({\n    queryKey: ['audit-logs', params],\n    queryFn: async () => {\n      const response = await api.get(`/admin/audit?${queryParams.toString()}`);\n      return response.data;\n    },\n  });\n}\n","size_bytes":722},"tools/migrate.py":{"content":"#!/usr/bin/env python3\n\"\"\"\nDatabase migration script for production deployments.\nAutomatically runs Alembic migrations on startup.\n\"\"\"\nimport sys\nimport os\nfrom pathlib import Path\n\nsys.path.insert(0, str(Path(__file__).parent.parent / \"apps\" / \"api\"))\n\nfrom alembic import command\nfrom alembic.config import Config\nfrom core.database import engine\nfrom sqlalchemy import text\n\n\ndef check_database_connection():\n    \"\"\"Check if database is accessible\"\"\"\n    try:\n        with engine.connect() as conn:\n            conn.execute(text(\"SELECT 1\"))\n        print(\"‚úÖ Database connection successful\")\n        return True\n    except Exception as e:\n        print(f\"‚ùå Database connection failed: {e}\")\n        return False\n\n\ndef run_migrations():\n    \"\"\"Run all pending migrations\"\"\"\n    try:\n        alembic_cfg = Config(str(Path(__file__).parent.parent / \"apps\" / \"api\" / \"alembic.ini\"))\n        alembic_cfg.set_main_option(\"script_location\", \n                                     str(Path(__file__).parent.parent / \"apps\" / \"api\" / \"migrations\"))\n        \n        print(\"üîÑ Running database migrations...\")\n        command.upgrade(alembic_cfg, \"head\")\n        print(\"‚úÖ Migrations completed successfully\")\n        return True\n    except Exception as e:\n        print(f\"‚ùå Migration failed: {e}\")\n        return False\n\n\ndef main():\n    \"\"\"Main migration flow\"\"\"\n    print(\"=\" * 60)\n    print(\"NovaGuardianTech - Database Migration\")\n    print(\"=\" * 60)\n    \n    if not check_database_connection():\n        sys.exit(1)\n    \n    if not run_migrations():\n        sys.exit(1)\n    \n    print(\"\\n‚úÖ All migrations completed successfully!\")\n    sys.exit(0)\n\n\nif __name__ == \"__main__\":\n    main()\n","size_bytes":1693},"tools/restore_database.sh":{"content":"#!/bin/bash\n# Database restore script for NovaGuardianTech\n# Usage: ./restore_database.sh <backup_file>\n\nset -e\n\nif [ -z \"$1\" ]; then\n    echo \"‚ùå ERROR: Please provide backup file path\"\n    echo \"Usage: $0 <backup_file>\"\n    exit 1\nfi\n\nBACKUP_FILE=\"$1\"\n\nif [ ! -f \"$BACKUP_FILE\" ]; then\n    echo \"‚ùå ERROR: Backup file not found: $BACKUP_FILE\"\n    exit 1\nfi\n\nif [ -z \"$DATABASE_URL\" ]; then\n    echo \"‚ùå ERROR: DATABASE_URL environment variable not set\"\n    exit 1\nfi\n\necho \"‚ö†Ô∏è  WARNING: This will REPLACE all data in the database!\"\necho \"üìÅ Backup file: $BACKUP_FILE\"\necho \"üóÑÔ∏è  Database: $DATABASE_URL\"\necho \"\"\nread -p \"Are you sure you want to continue? (yes/no): \" CONFIRM\n\nif [ \"$CONFIRM\" != \"yes\" ]; then\n    echo \"‚ùå Restore cancelled\"\n    exit 0\nfi\n\necho \"\"\necho \"üîÑ Restoring database...\"\n\npsql \"$DATABASE_URL\" < \"$BACKUP_FILE\"\n\necho \"‚úÖ Database restored successfully!\"\necho \"\"\necho \"‚ö†Ô∏è  Remember to:\"\necho \"  1. Restart the API: systemctl restart novaguardian-api\"\necho \"  2. Sync DNS rules: curl -X POST http://localhost:8080/dns/sync\"\n","size_bytes":1070},"apps/web/src/hooks/useUsers.js":{"content":"import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport api from '@/lib/api';\n\nexport function useUsers() {\n  return useQuery({\n    queryKey: ['users'],\n    queryFn: async () => {\n      const response = await api.get('/admin/users');\n      return response.data;\n    },\n  });\n}\n\nexport function useCreateUser() {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: async (userData) => {\n      const response = await api.post('/admin/users', userData);\n      return response.data;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries(['users']);\n    },\n  });\n}\n\nexport function useUpdateUser() {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: async ({ id, data }) => {\n      const response = await api.put(`/admin/users/${id}`, data);\n      return response.data;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries(['users']);\n    },\n  });\n}\n\nexport function useDeleteUser() {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: async (userId) => {\n      await api.delete(`/admin/users/${userId}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries(['users']);\n    },\n  });\n}\n","size_bytes":1242},"apps/web/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n@layer base {\n  :root {\n    --background: 0 0% 100%;\n    --foreground: 222.2 84% 4.9%;\n    --card: 0 0% 100%;\n    --card-foreground: 222.2 84% 4.9%;\n    --popover: 0 0% 100%;\n    --popover-foreground: 222.2 84% 4.9%;\n    --primary: 221.2 83.2% 53.3%;\n    --primary-foreground: 210 40% 98%;\n    --secondary: 210 40% 96.1%;\n    --secondary-foreground: 222.2 47.4% 11.2%;\n    --muted: 210 40% 96.1%;\n    --muted-foreground: 215.4 16.3% 46.9%;\n    --accent: 210 40% 96.1%;\n    --accent-foreground: 222.2 47.4% 11.2%;\n    --destructive: 0 84.2% 60.2%;\n    --destructive-foreground: 210 40% 98%;\n    --border: 214.3 31.8% 91.4%;\n    --input: 214.3 31.8% 91.4%;\n    --ring: 221.2 83.2% 53.3%;\n    --radius: 0.5rem;\n  }\n\n  .dark {\n    --background: 222.2 84% 4.9%;\n    --foreground: 210 40% 98%;\n    --card: 222.2 84% 4.9%;\n    --card-foreground: 210 40% 98%;\n    --popover: 222.2 84% 4.9%;\n    --popover-foreground: 210 40% 98%;\n    --primary: 217.2 91.2% 59.8%;\n    --primary-foreground: 222.2 47.4% 11.2%;\n    --secondary: 217.2 32.6% 17.5%;\n    --secondary-foreground: 210 40% 98%;\n    --muted: 217.2 32.6% 17.5%;\n    --muted-foreground: 215 20.2% 65.1%;\n    --accent: 217.2 32.6% 17.5%;\n    --accent-foreground: 210 40% 98%;\n    --destructive: 0 62.8% 30.6%;\n    --destructive-foreground: 210 40% 98%;\n    --border: 217.2 32.6% 17.5%;\n    --input: 217.2 32.6% 17.5%;\n    --ring: 224.3 76.3% 48%;\n  }\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n  body {\n    @apply bg-background text-foreground;\n  }\n}\n","size_bytes":1567},"SECURITY.md":{"content":"# NovaGuardianTech - Security Considerations\n\n## üîí Docker Socket Exposure\n\n### Current Implementation\n\nThe API container requires access to `/var/run/docker.sock` to manage Pi-hole containers dynamically. This is implemented in `docker-compose.prod.yml`:\n\n```yaml\napi:\n  volumes:\n    - /var/run/docker.sock:/var/run/docker.sock\n```\n\n### Security Implications\n\n**Risk**: Full host Docker control if API is compromised.\n\nAn attacker who gains code execution in the API container could:\n- Create/destroy any containers on the host\n- Access volumes from other containers\n- Escalate privileges to host root\n- Mine cryptocurrencies\n- Launch attacks from the host\n\n### Mitigation Strategies\n\n#### 1. Rootless Docker (Recommended for Production)\n\n```bash\n# Install rootless Docker\ndockerd-rootless-setuptool.sh install\n\n# Run containers as non-root user\nsystemctl --user enable docker\nsystemctl --user start docker\n```\n\n**Pros**: Isolates Docker daemon from root\n**Cons**: Some features limited (networking, cgroups)\n\n#### 2. Dedicated Docker-in-Docker Sidecar\n\n```yaml\nservices:\n  docker-proxy:\n    image: bobrik/socat\n    container_name: docker-proxy\n    command: \"TCP4-LISTEN:2375,fork,reuseaddr UNIX-CONNECT:/var/run/docker.sock\"\n    volumes:\n      - /var/run/docker.sock:/var/run/docker.sock\n    expose:\n      - 2375\n    networks:\n      - novaguardian\n  \n  api:\n    environment:\n      DOCKER_HOST: tcp://docker-proxy:2375\n```\n\n**Pros**: Limits blast radius\n**Cons**: Additional complexity, still trusts proxy\n\n#### 3. Constrained API Surface (Current + Future)\n\n**Current**:\n- ‚úÖ Admin-only endpoints (require_admin decorator)\n- ‚úÖ JWT authentication required\n- ‚úÖ Input validation (Pydantic models)\n- ‚úÖ Client ID scoping (multi-tenant isolation)\n\n**Future Enhancements**:\n- [ ] Rate limiting per user/IP\n- [ ] Audit logging for all Docker operations\n- [ ] Container resource limits (CPU/memory quotas)\n- [ ] Network policies (limit container connectivity)\n- [ ] Image signing/verification\n- [ ] Docker socket proxy with ACL\n\n#### 4. Production-Ready Alternative: Kubernetes Operators\n\nFor large-scale production deployments:\n\n```yaml\n# Use Kubernetes Operator instead of Docker socket\napiVersion: novaguardian.tech/v1\nkind: PiholeInstance\nmetadata:\n  name: client-1-pihole\nspec:\n  clientId: 1\n  publicIP: \"203.0.113.10\"\n  password: <secret-ref>\n```\n\n**Pros**: Built-in RBAC, resource quotas, network policies\n**Cons**: Requires Kubernetes infrastructure\n\n### Current Risk Assessment\n\n**Development**: ‚úÖ **Acceptable** - Docker socket access OK for local development\n\n**Production**: ‚ö†Ô∏è **Medium Risk** - Acceptable with mitigations:\n1. Run API as non-root user\n2. Enable audit logging\n3. Implement rate limiting\n4. Use rootless Docker\n5. Network segmentation (API in DMZ)\n6. Regular security updates\n7. Container image scanning\n\n### Recommended Production Setup\n\n```yaml\n# docker-compose.prod-secure.yml\nservices:\n  api:\n    user: \"1000:1000\"  # Non-root user\n    read_only: true    # Read-only filesystem\n    tmpfs:\n      - /tmp\n    security_opt:\n      - no-new-privileges:true\n      - apparmor=docker-default\n    cap_drop:\n      - ALL\n    cap_add:\n      - NET_BIND_SERVICE\n    volumes:\n      - /var/run/docker.sock:/var/run/docker.sock:ro  # Read-only\n    environment:\n      DOCKER_SECURITY_OPT: \"no-new-privileges:true\"\n```\n\n### Monitoring & Detection\n\n**Recommended Alerts**:\n- Unusual Docker API calls (create/destroy spikes)\n- Containers created outside normal patterns\n- Resource exhaustion (CPU/memory)\n- Failed authentication attempts\n- Privilege escalation attempts\n\n**Audit Logging**:\n```python\n# Log all Docker operations\n@router.post(\"/admin/pihole/provision\")\nasync def provision_pihole_instance(...):\n    audit_log(\n        user=current_user.email,\n        action=\"pihole_provision\",\n        client_id=request.client_id,\n        ip=request.client.host,\n        timestamp=datetime.now()\n    )\n    # ... provision logic\n```\n\n### Action Items\n\n**Before Production Deployment**:\n- [ ] Enable audit logging for all Docker operations\n- [ ] Implement rate limiting (10 provisions/hour per user)\n- [ ] Set up alerts for anomalous container creation\n- [ ] Review and approve all Docker operations\n- [ ] Test with rootless Docker\n- [ ] Document incident response for compromised API\n- [ ] Regular penetration testing\n- [ ] Container image vulnerability scanning\n\n### References\n\n- [Docker Security Best Practices](https://docs.docker.com/engine/security/)\n- [Rootless Docker](https://docs.docker.com/engine/security/rootless/)\n- [OWASP Docker Security Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Docker_Security_Cheat_Sheet.html)\n\n---\n\n**Last Updated**: 2025-11-13\n**Next Review**: Before production deployment\n**Owner**: Infrastructure Team\n","size_bytes":4775},"apps/web/src/lib/mockAuth.js":{"content":"// Mock de autentica√ß√£o para desenvolvimento sem API\n\nconst MOCK_USERS = [\n  {\n    id: 1,\n    name: 'Administrador',\n    email: 'admin@novaguardian.com',\n    password: 'admin123',\n    role: 'ADMIN',\n  },\n  {\n    id: 2,\n    name: 'Usu√°rio Demo',\n    email: 'user@example.com',\n    password: 'user123',\n    role: 'USER',\n  },\n];\n\nexport async function mockLogin(email, password) {\n  // Simular delay de rede\n  await new Promise(resolve => setTimeout(resolve, 500));\n\n  const user = MOCK_USERS.find(\n    u => u.email === email && u.password === password\n  );\n\n  if (!user) {\n    throw new Error('Credenciais inv√°lidas');\n  }\n\n  const { password: _, ...userWithoutPassword } = user;\n\n  return {\n    access_token: `mock_token_${user.id}_${Date.now()}`,\n    user: userWithoutPassword,\n  };\n}\n\nexport async function mockGetMe(token) {\n  await new Promise(resolve => setTimeout(resolve, 200));\n\n  if (!token || !token.startsWith('mock_token_')) {\n    throw new Error('Token inv√°lido');\n  }\n\n  const userId = parseInt(token.split('_')[2]);\n  const user = MOCK_USERS.find(u => u.id === userId);\n\n  if (!user) {\n    throw new Error('Usu√°rio n√£o encontrado');\n  }\n\n  const { password: _, ...userWithoutPassword } = user;\n  return userWithoutPassword;\n}\n","size_bytes":1248},"pyproject.toml":{"content":"[project]\nname = \"repl-nix-workspace\"\nversion = \"0.1.0\"\ndescription = \"Add your description here\"\nrequires-python = \">=3.11\"\ndependencies = []\n","size_bytes":143},"apps/api/schemas/location.py":{"content":"from pydantic import BaseModel, Field\nfrom datetime import datetime\nfrom typing import Optional\n\n\nclass LocationBase(BaseModel):\n    label: str = Field(..., min_length=2, max_length=255)\n    public_ip: Optional[str] = Field(None, max_length=45)\n    is_active: bool = True\n\n\nclass LocationCreate(LocationBase):\n    client_id: int\n\n\nclass LocationUpdate(BaseModel):\n    label: Optional[str] = Field(None, min_length=2, max_length=255)\n    public_ip: Optional[str] = Field(None, max_length=45)\n    is_active: Optional[bool] = None\n\n\nclass LocationResponse(LocationBase):\n    id: int\n    client_id: int\n    created_at: datetime\n\n    class Config:\n        from_attributes = True\n","size_bytes":674},"apps/api/models/user.py":{"content":"from sqlalchemy import Column, Integer, String, DateTime, Enum, ForeignKey\nfrom sqlalchemy.sql import func\nfrom sqlalchemy.orm import relationship\nfrom core.database import Base\nimport enum\n\n\nclass UserRole(str, enum.Enum):\n    ADMIN = \"ADMIN\"\n    USER = \"USER\"\n\n\nclass User(Base):\n    __tablename__ = \"users\"\n\n    id = Column(Integer, primary_key=True, index=True)\n    name = Column(String(255), nullable=False)\n    email = Column(String(255), unique=True, index=True, nullable=False)\n    password_hash = Column(String(255), nullable=False)\n    role = Column(Enum(UserRole), default=UserRole.USER, nullable=False)\n    client_id = Column(Integer, ForeignKey(\"clients.id\", ondelete=\"SET NULL\"), nullable=True)\n    created_at = Column(DateTime(timezone=True), server_default=func.now())\n    updated_at = Column(DateTime(timezone=True), server_default=func.now(), onupdate=func.now())\n    \n    client = relationship(\"Client\")\n","size_bytes":923},"apps/api/schemas/domain_rule.py":{"content":"from pydantic import BaseModel, Field\nfrom datetime import datetime\nfrom typing import Optional\nfrom models.domain_rule import DomainKind, DomainStatus\n\n\nclass DomainRuleBase(BaseModel):\n    domain: str = Field(..., min_length=3, max_length=500)\n    kind: DomainKind = DomainKind.EXACT\n    status: DomainStatus = DomainStatus.ACTIVE\n    reason: Optional[str] = None\n\n\nclass DomainRuleCreate(DomainRuleBase):\n    client_id: Optional[int] = None\n\n\nclass DomainRuleUpdate(BaseModel):\n    domain: Optional[str] = Field(None, min_length=3, max_length=500)\n    kind: Optional[DomainKind] = None\n    status: Optional[DomainStatus] = None\n    reason: Optional[str] = None\n\n\nclass DomainRuleResponse(DomainRuleBase):\n    id: int\n    client_id: int\n    created_by: Optional[int]\n    created_at: datetime\n    updated_at: datetime\n\n    class Config:\n        from_attributes = True\n","size_bytes":869},"apps/web/src/lib/queryClient.js":{"content":"import { QueryClient } from '@tanstack/react-query';\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      staleTime: 1000 * 60 * 5,\n      cacheTime: 1000 * 60 * 10,\n      refetchOnWindowFocus: false,\n      retry: 1,\n    },\n  },\n});\n","size_bytes":266},"apps/web/src/pages/Login.jsx":{"content":"import { useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { Shield } from 'lucide-react';\nimport { Card, CardHeader, CardTitle, CardDescription, CardContent } from '@/components/ui/Card';\nimport Input from '@/components/ui/Input';\nimport Button from '@/components/ui/Button';\nimport useAuthStore from '@/hooks/useAuth';\nimport api from '@/lib/api';\nimport { mockLogin } from '@/lib/mockAuth';\n\nconst USE_MOCK = import.meta.env.VITE_USE_MOCK === 'true';\n\nexport default function Login() {\n  const [email, setEmail] = useState('');\n  const [password, setPassword] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState('');\n  const [useMock, setUseMock] = useState(USE_MOCK);\n  const navigate = useNavigate();\n  const { setAuth } = useAuthStore();\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    setError('');\n    setLoading(true);\n\n    try {\n      let access_token, user;\n\n      if (useMock) {\n        // Modo Mock (sem API)\n        const mockResponse = await mockLogin(email, password);\n        access_token = mockResponse.access_token;\n        user = mockResponse.user;\n      } else {\n        // Tentar API real\n        try {\n          const formData = new FormData();\n          formData.append('username', email);\n          formData.append('password', password);\n\n          const response = await api.post('/auth/login', formData, {\n            headers: {\n              'Content-Type': 'application/x-www-form-urlencoded',\n            },\n          });\n\n          access_token = response.data.access_token;\n          user = response.data.user;\n        } catch (apiError) {\n          // Se a API falhar (Network Error), usar mock automaticamente\n          if (apiError.message === 'Network Error' || apiError.code === 'ERR_NETWORK') {\n            console.log('API n√£o dispon√≠vel, usando modo mock...');\n            setUseMock(true);\n            const mockResponse = await mockLogin(email, password);\n            access_token = mockResponse.access_token;\n            user = mockResponse.user;\n          } else {\n            throw apiError;\n          }\n        }\n      }\n\n      localStorage.setItem('auth_token', access_token);\n      localStorage.setItem('user', JSON.stringify(user));\n      setAuth(user, access_token);\n      \n      navigate('/');\n    } catch (err) {\n      console.error('Erro no login:', err);\n      setError(err.message || err.response?.data?.detail || 'Erro ao fazer login. Verifique suas credenciais.');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100\">\n      <div className=\"w-full max-w-md px-4\">\n        <div className=\"text-center mb-8\">\n          <div className=\"inline-flex items-center gap-2 mb-4\">\n            <Shield className=\"h-12 w-12 text-primary\" />\n            <h1 className=\"text-3xl font-bold text-gray-900\">NovaGuardianTech</h1>\n          </div>\n          <p className=\"text-gray-600\">Sistema de Bloqueio DNS Inteligente</p>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Entrar</CardTitle>\n            <CardDescription>Fa√ßa login para acessar o painel administrativo</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\n              {useMock && (\n                <div className=\"bg-yellow-50 border border-yellow-200 text-yellow-800 px-4 py-3 rounded-md text-sm\">\n                  ‚ö†Ô∏è Modo Mock Ativo - API n√£o dispon√≠vel. Os dados s√£o apenas para demonstra√ß√£o.\n                </div>\n              )}\n\n              {error && (\n                <div className=\"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md text-sm\">\n                  {error}\n                </div>\n              )}\n\n              <div className=\"space-y-2\">\n                <label htmlFor=\"email\" className=\"text-sm font-medium text-gray-700\">\n                  E-mail\n                </label>\n                <Input\n                  id=\"email\"\n                  type=\"email\"\n                  placeholder=\"seu@email.com\"\n                  value={email}\n                  onChange={(e) => setEmail(e.target.value)}\n                  required\n                  disabled={loading}\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <label htmlFor=\"password\" className=\"text-sm font-medium text-gray-700\">\n                  Senha\n                </label>\n                <Input\n                  id=\"password\"\n                  type=\"password\"\n                  placeholder=\"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢\"\n                  value={password}\n                  onChange={(e) => setPassword(e.target.value)}\n                  required\n                  disabled={loading}\n                />\n              </div>\n\n              <Button type=\"submit\" className=\"w-full\" disabled={loading}>\n                {loading ? 'Entrando...' : 'Entrar'}\n              </Button>\n\n              <div className=\"mt-4 p-4 bg-blue-50 rounded-md\">\n                <p className=\"text-xs text-blue-800 font-medium mb-2\">Credenciais de demonstra√ß√£o:</p>\n                <p className=\"text-xs text-blue-700\">Admin: admin@novaguardian.com / admin123</p>\n                <p className=\"text-xs text-blue-700\">Usu√°rio: user@example.com / user123</p>\n              </div>\n            </form>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","size_bytes":5549},"apps/web/src/components/ui/Table.jsx":{"content":"import { cn } from '@/lib/utils';\n\nexport function Table({ children, className, ...props }) {\n  return (\n    <div className=\"w-full overflow-auto\">\n      <table\n        className={cn('w-full caption-bottom text-sm', className)}\n        {...props}\n      >\n        {children}\n      </table>\n    </div>\n  );\n}\n\nexport function TableHeader({ children, className, ...props }) {\n  return (\n    <thead className={cn('border-b bg-gray-50', className)} {...props}>\n      {children}\n    </thead>\n  );\n}\n\nexport function TableBody({ children, className, ...props }) {\n  return (\n    <tbody className={cn('divide-y divide-gray-200', className)} {...props}>\n      {children}\n    </tbody>\n  );\n}\n\nexport function TableRow({ children, className, ...props }) {\n  return (\n    <tr\n      className={cn(\n        'transition-colors hover:bg-gray-50',\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </tr>\n  );\n}\n\nexport function TableHead({ children, className, ...props }) {\n  return (\n    <th\n      className={cn(\n        'px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider',\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </th>\n  );\n}\n\nexport function TableCell({ children, className, ...props }) {\n  return (\n    <td\n      className={cn('px-6 py-4 whitespace-nowrap text-sm text-gray-900', className)}\n      {...props}\n    >\n      {children}\n    </td>\n  );\n}\n","size_bytes":1418},"apps/api/schemas/client.py":{"content":"from pydantic import BaseModel, Field\nfrom datetime import datetime\nfrom typing import Optional\n\n\nclass ClientBase(BaseModel):\n    name: str = Field(..., min_length=2, max_length=255)\n    slug: str = Field(..., min_length=2, max_length=255)\n    is_active: bool = True\n\n\nclass ClientCreate(ClientBase):\n    pass\n\n\nclass ClientUpdate(BaseModel):\n    name: Optional[str] = Field(None, min_length=2, max_length=255)\n    slug: Optional[str] = Field(None, min_length=2, max_length=255)\n    is_active: Optional[bool] = None\n\n\nclass ClientResponse(ClientBase):\n    id: int\n    created_at: datetime\n\n    class Config:\n        from_attributes = True\n","size_bytes":640},"apps/api/routers/stats.py":{"content":"from fastapi import APIRouter, Depends\nfrom sqlalchemy.orm import Session\nfrom core.database import get_db\nfrom models.client import Client\nfrom models.domain_rule import DomainRule\nfrom models.ip_whitelist import IpWhitelist\n\nrouter = APIRouter(tags=[\"stats\"])\n\n@router.get(\"/stats\")\ndef get_stats(db: Session = Depends(get_db)):\n    \"\"\"Get system statistics for dashboard\"\"\"\n    \n    clients_count = db.query(Client).count()\n    domains_count = db.query(DomainRule).count()\n    whitelist_count = db.query(IpWhitelist).count()\n    \n    pihole_instances_count = 0\n    try:\n        import docker\n        client = docker.from_env()\n        containers = client.containers.list(filters={\"name\": \"pihole_client_\"})\n        pihole_instances_count = len(containers)\n    except:\n        pass\n    \n    return {\n        \"clients_count\": clients_count,\n        \"domains_count\": domains_count,\n        \"whitelist_count\": whitelist_count,\n        \"pihole_instances_count\": pihole_instances_count,\n    }\n","size_bytes":990},"criar_admin.py":{"content":"#!/usr/bin/env python3\n\"\"\"Script para criar um usu√°rio administrador\"\"\"\n\nimport sys\nimport os\nsys.path.insert(0, os.path.join(os.path.dirname(__file__), 'apps', 'api'))\n\nfrom core.database import SessionLocal\nfrom models.user import User\nfrom core.security import get_password_hash\n\ndef create_admin():\n    db = SessionLocal()\n    try:\n        # Verificar se j√° existe\n        existing = db.query(User).filter(User.email == 'admin@novaguardian.com').first()\n        if existing:\n            print('‚ùå Usu√°rio admin@novaguardian.com j√° existe!')\n            print(f'   Role atual: {existing.role}')\n            \n            if existing.role != 'ADMIN':\n                existing.role = 'ADMIN'\n                db.commit()\n                print('‚úÖ Role atualizado para ADMIN!')\n            return\n        \n        # Criar novo admin\n        admin = User(\n            name='Administrador',\n            email='admin@novaguardian.com',\n            password_hash=get_password_hash('admin123'),\n            role='ADMIN'\n        )\n        db.add(admin)\n        db.commit()\n        \n        print('‚úÖ Usu√°rio administrador criado com sucesso!')\n        print('')\n        print('üìß Email: admin@novaguardian.com')\n        print('üîë Senha: admin123')\n        print('üë§ Role: ADMIN')\n        print('')\n        print('Agora voc√™ pode fazer login no painel admin!')\n        \n    except Exception as e:\n        print(f'‚ùå Erro ao criar admin: {e}')\n        db.rollback()\n    finally:\n        db.close()\n\nif __name__ == '__main__':\n    create_admin()\n","size_bytes":1551},"apps/api/schemas/audit_log.py":{"content":"from pydantic import BaseModel, Field\nfrom datetime import datetime\nfrom typing import Optional, Any\n\nclass UserBasic(BaseModel):\n    id: int\n    name: str\n    email: str\n    \n    class Config:\n        from_attributes = True\n\nclass AuditLogResponse(BaseModel):\n    id: int\n    actor_user_id: Optional[int] = None\n    client_id: Optional[int] = None\n    action: str\n    payload_json: Optional[Any] = None\n    created_at: datetime\n    user: Optional[UserBasic] = None\n    \n    class Config:\n        from_attributes = True\n","size_bytes":520},"GUIA_TESTES_MANUAL.md":{"content":"# üìã GUIA COMPLETO DE TESTES MANUAIS - NovaGuardianTech\n\n## üéØ Objetivo\n\nEste guia te ajudar√° a testar **todas as funcionalidades** do painel administrativo NovaGuardianTech, p√°gina por p√°gina, com instru√ß√µes detalhadas para desenvolvedores j√∫niors.\n\n---\n\n## ‚úÖ PR√â-REQUISITOS\n\nAntes de come√ßar, certifique-se de que:\n\n1. **‚úÖ Workflows rodando**: Frontend (porta 5000) e API devem estar com status `RUNNING`\n2. **‚úÖ Banco de dados**: PostgreSQL conectado e com tabelas criadas\n3. **‚úÖ Usu√°rio admin existe**: J√° existe um admin no sistema\n\n### üîê Credenciais de Acesso\n\n**Email**: `admin@novaguardian.com`  \n**Senha**: `admin123`  \n**Role**: `ADMIN` (acesso total)\n\n---\n\n## üìñ ROTEIRO DE TESTES\n\n### PASSO 1: Acessar o Frontend\n\n1. Abra o webview do Replit (deve estar mostrando a porta 5000)\n2. Voc√™ deve ver a **tela de login**\n3. Se estiver em outra p√°gina, clique em \"Logout\" no menu lateral\n\n**Resultado esperado**: Tela de login com campos Email e Password\n\n---\n\n### PASSO 2: Fazer Login üîë\n\n1. Digite no campo **Email**: `admin@novaguardian.com`\n2. Digite no campo **Password**: `admin123`\n3. Clique no bot√£o **\"Entrar\"** ou aperte Enter\n\n**Resultado esperado**:\n- ‚úÖ Redirecionamento para `/dashboard`\n- ‚úÖ Menu lateral vis√≠vel com 8 op√ß√µes (Dashboard, Clients, Domains, Whitelist, Pi-hole Instances, Users, Audit Logs, Settings)\n- ‚úÖ Nome do usu√°rio \"Administrador\" no topo do menu\n- ‚úÖ Badge \"ADMIN\" vis√≠vel\n\n**Se der erro**:\n- Verifique no console do navegador (F12) se h√° erros 401 ou 403\n- Verifique se a API est√° rodando nos logs do workflow \"api\"\n\n---\n\n### PASSO 3: Testar Dashboard üìä\n\n**O que faz**: Exibe estat√≠sticas em tempo real do sistema\n\n**Como testar**:\n\n1. Voc√™ j√° deve estar no Dashboard (`/dashboard`)\n2. Observe 4 cards de estat√≠sticas:\n   - üìÇ Total de Clientes\n   - üö´ Total de Dom√≠nios Bloqueados\n   - ‚úÖ Total de IPs Whitelistados\n   - üê≥ Total de Inst√¢ncias Pi-hole\n\n**Resultado esperado**:\n- ‚úÖ Os n√∫meros aparecem (podem ser todos 0 se o banco est√° vazio)\n- ‚úÖ Ap√≥s 30 segundos, os n√∫meros atualizam automaticamente (auto-refresh)\n\n**Teste de auto-refresh**:\n1. Anote os n√∫meros atuais\n2. Aguarde 30 segundos\n3. Os n√∫meros devem recarregar (voc√™ ver√° um breve loading)\n\n**Se der erro**:\n- Erro 404 em `/stats`: O endpoint n√£o existe (verifique se adicionei corretamente)\n- N√∫meros n√£o aparecem: Abra DevTools e veja se h√° erro na chamada `/api/stats`\n\n---\n\n### PASSO 4: Testar Gerenciamento de Clientes üè¢\n\n**O que faz**: CRUD completo de clientes (empresas que usar√£o o sistema)\n\n#### 4.1 Listar Clientes\n\n1. Clique em **\"Clients\"** no menu lateral\n2. Voc√™ ver√° uma tabela (pode estar vazia inicialmente)\n\n**Resultado esperado**:\n- ‚úÖ Tabela com colunas: Nome, Slug, Status, Data de Cria√ß√£o, A√ß√µes\n- ‚úÖ Bot√£o \"Novo Cliente\" no topo\n\n#### 4.2 Criar Novo Cliente\n\n1. Clique no bot√£o **\"Novo Cliente\"**\n2. Um modal (janela pop-up) deve abrir\n3. Preencha os campos:\n   - **Nome**: `ACME Corporation`\n   - **Slug**: `acme-corp` (identificador √∫nico, ser√° convertido para min√∫sculas)\n   - **Ativo**: ‚úÖ (checkbox marcado)\n4. Clique em **\"Salvar\"**\n\n**Resultado esperado**:\n- ‚úÖ Modal fecha\n- ‚úÖ Cliente aparece na tabela\n- ‚úÖ Mensagem de sucesso no topo (se tiver implementada)\n- ‚úÖ Dashboard agora mostra \"1\" em Total de Clientes\n\n**Teste de valida√ß√£o**:\n1. Tente criar outro cliente com o mesmo slug `acme-corp`\n2. Deve dar **erro 409** dizendo que j√° existe\n\n#### 4.3 Editar Cliente\n\n1. Na linha do cliente \"ACME Corporation\", clique no √≠cone **‚úèÔ∏è Editar**\n2. Modal abre com dados preenchidos\n3. Altere o nome para: `ACME Corporation - Atualizado`\n4. Clique em **\"Salvar\"**\n\n**Resultado esperado**:\n- ‚úÖ Modal fecha\n- ‚úÖ Nome atualizado na tabela\n\n#### 4.4 Criar Segundo Cliente (para testes multi-tenant)\n\n1. Crie mais um cliente:\n   - **Nome**: `TechStart LTDA`\n   - **Slug**: `techstart`\n   - **Ativo**: ‚úÖ\n2. Salve\n\n**Resultado esperado**:\n- ‚úÖ Agora voc√™ tem 2 clientes na tabela\n- ‚úÖ Dashboard mostra \"2\" em Total de Clientes\n\n#### 4.5 Tentar Deletar Cliente (deve falhar se tiver depend√™ncias)\n\n1. Clique no √≠cone **üóëÔ∏è Excluir** do cliente \"TechStart LTDA\"\n2. Confirme a exclus√£o\n\n**Resultado esperado**:\n- ‚úÖ Cliente √© removido (se n√£o tiver usu√°rios, dom√≠nios, whitelist associados)\n- ‚ùå Se tiver depend√™ncias, mostra erro 409 com mensagem clara\n\n**N√£o delete o cliente ACME ainda** - vamos us√°-lo nos pr√≥ximos testes!\n\n---\n\n### PASSO 5: Testar Gerenciamento de Dom√≠nios Bloqueados üö´\n\n**O que faz**: Permite adicionar dom√≠nios para bloqueio (ex: ads.example.com)\n\n#### 5.1 Acessar P√°gina de Dom√≠nios\n\n1. Clique em **\"Domains\"** no menu lateral\n2. Voc√™ ver√° um **dropdown** para selecionar cliente\n\n**Resultado esperado**:\n- ‚úÖ Dropdown com os clientes criados (ACME Corporation, TechStart)\n- ‚úÖ Mensagem \"Selecione um cliente para gerenciar dom√≠nios\"\n\n#### 5.2 Selecionar Cliente\n\n1. No dropdown, selecione **\"ACME Corporation\"**\n2. Aguarde carregar\n\n**Resultado esperado**:\n- ‚úÖ Tabela de dom√≠nios aparece (vazia inicialmente)\n- ‚úÖ Bot√£o \"Adicionar Dom√≠nio\" habilitado\n\n#### 5.3 Adicionar Dom√≠nio\n\n1. Clique em **\"Adicionar Dom√≠nio\"**\n2. Modal abre\n3. Preencha:\n   - **Dom√≠nio**: `ads.doubleclick.net`\n   - **Tipo**: `EXACT` (bloqueio exato)\n   - **Motivo**: `Rastreamento de an√∫ncios` (opcional)\n4. Clique em **\"Salvar\"**\n\n**Resultado esperado**:\n- ‚úÖ Dom√≠nio aparece na tabela\n- ‚úÖ Dashboard agora mostra \"1\" em Total de Dom√≠nios Bloqueados\n\n#### 5.4 Adicionar Dom√≠nio com REGEX\n\n1. Adicione outro dom√≠nio:\n   - **Dom√≠nio**: `^ad[sz]?\\\\..*` (regex para bloquear ad.*, ads.*, adz.*)\n   - **Tipo**: `REGEX`\n   - **Motivo**: `Bloqueio de ads via regex`\n2. Salve\n\n**Resultado esperado**:\n- ‚úÖ 2 dom√≠nios na tabela\n- ‚úÖ Badge \"REGEX\" vis√≠vel no segundo dom√≠nio\n\n#### 5.5 Sincronizar com Pi-hole\n\n1. Clique no bot√£o **\"Sincronizar com Pi-hole\"**\n2. Aguarde\n\n**Resultado esperado**:\n- ‚ö†Ô∏è **Pode dar erro 404** se n√£o houver inst√¢ncia Pi-hole provisionada para este cliente\n- ‚úÖ Se houver inst√¢ncia, mostra \"X dom√≠nios sincronizados\"\n\n#### 5.6 Testar Multi-Tenant\n\n1. No dropdown, troque para **\"TechStart LTDA\"**\n2. A tabela deve **ficar vazia** (cada cliente tem seus pr√≥prios dom√≠nios)\n3. Adicione um dom√≠nio diferente para TechStart:\n   - **Dom√≠nio**: `tracker.example.com`\n   - **Tipo**: `EXACT`\n4. Volte para **\"ACME Corporation\"** no dropdown\n5. Deve mostrar apenas os 2 dom√≠nios do ACME (n√£o o do TechStart)\n\n**Resultado esperado**:\n- ‚úÖ **Isolamento perfeito** entre clientes\n- ‚úÖ Cache invalidation funcionando\n\n#### 5.7 Deletar Dom√≠nio\n\n1. Com ACME selecionado, delete o dom√≠nio `ads.doubleclick.net`\n2. Confirme\n\n**Resultado esperado**:\n- ‚úÖ Dom√≠nio removido da tabela\n- ‚úÖ Total de Dom√≠nios no Dashboard diminui\n\n---\n\n### PASSO 6: Testar Gerenciamento de Whitelist üìã\n\n**O que faz**: Permite adicionar IPs que N√ÉO ser√£o bloqueados\n\n#### 6.1 Acessar Whitelist\n\n1. Clique em **\"Whitelist\"** no menu lateral\n2. Dropdown para selecionar cliente\n\n#### 6.2 Adicionar IP Whitelistado\n\n1. Selecione **\"ACME Corporation\"**\n2. Clique em **\"Adicionar IP\"**\n3. Preencha:\n   - **Endere√ßo IP**: `192.168.1.100`\n   - **Label**: `Servidor de Produ√ß√£o`\n4. Salve\n\n**Resultado esperado**:\n- ‚úÖ IP aparece na tabela\n- ‚úÖ Dashboard mostra \"1\" em Total de IPs Whitelistados\n\n#### 6.3 Teste de Valida√ß√£o de IP\n\n1. Tente adicionar um IP inv√°lido: `999.999.999.999`\n2. Deve dar erro de valida√ß√£o\n\n#### 6.4 Testar Multi-Tenant\n\n1. Troque para **\"TechStart\"**\n2. Tabela fica vazia (isolamento por cliente)\n3. Adicione um IP para TechStart: `10.0.0.50`\n4. Volte para ACME - deve ver apenas o IP do ACME\n\n#### 6.5 Deletar IP\n\n1. Delete o IP `192.168.1.100` do ACME\n2. Dashboard atualiza o contador\n\n---\n\n### PASSO 7: Testar Gerenciamento de Inst√¢ncias Pi-hole üê≥\n\n**O que faz**: Provisiona, remove e gerencia containers Docker do Pi-hole\n\n‚ö†Ô∏è **ATEN√á√ÉO**: Esta funcionalidade requer **Docker** rodando. No Replit, pode n√£o funcionar completamente.\n\n#### 7.1 Acessar Pi-hole Instances\n\n1. Clique em **\"Pi-hole Instances\"** no menu lateral\n2. Tabela com inst√¢ncias (vazia inicialmente)\n\n#### 7.2 Provisionar Nova Inst√¢ncia\n\n1. Clique em **\"Provisionar Nova Inst√¢ncia\"**\n2. Modal abre\n3. Selecione cliente: **\"ACME Corporation\"**\n4. Clique em **\"Provisionar\"**\n\n**Resultado esperado**:\n- ‚úÖ Se Docker estiver dispon√≠vel: Inst√¢ncia criada, status \"running\"\n- ‚ùå Se Docker n√£o estiver dispon√≠vel: Erro claro\n\n#### 7.3 Listar Inst√¢ncias\n\n**Resultado esperado**:\n- ‚úÖ Tabela mostra: Container Name, Client, Status, IP, Port\n\n#### 7.4 Restart de Inst√¢ncia\n\n1. Clique em **\"Restart\"** na linha da inst√¢ncia\n2. Aguarde\n\n**Resultado esperado**:\n- ‚úÖ Container reinicia (se Docker funcionar)\n\n#### 7.5 Atualizar Configura√ß√£o dnsdist\n\n1. Clique em **\"Atualizar dnsdist Config\"**\n2. Aguarde\n\n**Resultado esperado**:\n- ‚úÖ Configura√ß√£o Lua regenerada e aplicada\n\n#### 7.6 Deprovision (Remover Inst√¢ncia)\n\n1. Clique em **\"Deprovision\"** na inst√¢ncia\n2. Confirme\n\n**Resultado esperado**:\n- ‚úÖ Container Docker removido\n- ‚úÖ Inst√¢ncia some da tabela\n\n---\n\n### PASSO 8: Testar Gerenciamento de Usu√°rios üë•\n\n**O que faz**: CRUD de usu√°rios do sistema (ADMIN ou USER)\n\n‚ö†Ô∏è **Esta p√°gina s√≥ aparece para usu√°rios ADMIN**\n\n#### 8.1 Acessar Users\n\n1. Clique em **\"Users\"** no menu lateral\n2. Tabela com usu√°rios\n\n**Resultado esperado**:\n- ‚úÖ Pelo menos 1 usu√°rio (Administrador)\n- ‚úÖ Colunas: Nome, Email, Role, Cliente Associado, A√ß√µes\n\n#### 8.2 Criar Novo Usu√°rio\n\n1. Clique em **\"Novo Usu√°rio\"**\n2. Preencha:\n   - **Nome**: `Jo√£o Silva`\n   - **Email**: `joao@acme.com`\n   - **Password**: `senha123`\n   - **Role**: `USER` (n√£o admin)\n   - **Cliente**: `ACME Corporation` (opcional)\n3. Salve\n\n**Resultado esperado**:\n- ‚úÖ Usu√°rio aparece na tabela\n- ‚úÖ Badge \"USER\" vis√≠vel\n\n#### 8.3 Criar Usu√°rio ADMIN\n\n1. Crie outro usu√°rio:\n   - **Nome**: `Maria Admin`\n   - **Email**: `maria@novaguardian.com`\n   - **Password**: `admin456`\n   - **Role**: `ADMIN`\n   - **Cliente**: (deixe vazio)\n2. Salve\n\n**Resultado esperado**:\n- ‚úÖ Badge \"ADMIN\" vis√≠vel\n\n#### 8.4 Editar Usu√°rio\n\n1. Edite o usu√°rio Jo√£o Silva\n2. Altere o nome para: `Jo√£o Silva - Gerente`\n3. Salve\n\n**Resultado esperado**:\n- ‚úÖ Nome atualizado\n\n#### 8.5 Testar Prote√ß√£o de Auto-Delete\n\n1. Tente deletar o usu√°rio **Administrador** (voc√™ mesmo, logado)\n2. Clique em excluir\n\n**Resultado esperado**:\n- ‚ùå **Deve dar erro 400** dizendo \"Voc√™ n√£o pode deletar sua pr√≥pria conta\"\n\n#### 8.6 Deletar Outro Usu√°rio\n\n1. Delete o usu√°rio Jo√£o Silva\n2. Confirme\n\n**Resultado esperado**:\n- ‚úÖ Usu√°rio removido da tabela\n\n---\n\n### PASSO 9: Testar Logs de Auditoria üìú\n\n**O que faz**: Mostra todas as a√ß√µes realizadas no sistema (quem fez o qu√™ e quando)\n\n#### 9.1 Acessar Audit Logs\n\n1. Clique em **\"Audit Logs\"** no menu lateral\n2. Tabela com logs\n\n**Resultado esperado**:\n- ‚úÖ Todos os logs das a√ß√µes que voc√™ fez aparecem\n- ‚úÖ Colunas: ID, Usu√°rio (nome), A√ß√£o, Detalhes, Data/Hora\n\n#### 9.2 Verificar Nome do Ator\n\n**Muito importante!** Cada log deve mostrar o **nome do usu√°rio** que executou a a√ß√£o (ex: \"Administrador\"), **n√£o** apenas o user_id.\n\n**Resultado esperado**:\n- ‚úÖ Coluna \"Usu√°rio\" mostra: \"Administrador\"\n- ‚ùå Se mostrar \"Sistema\" ou \"ID:1\", h√° um erro no relacionamento SQL\n\n#### 9.3 Filtrar por A√ß√£o\n\n1. No campo de busca/filtro de A√ß√£o, digite: `CREATE`\n2. Aperte Enter ou clique em Filtrar\n\n**Resultado esperado**:\n- ‚úÖ Mostra apenas logs de cria√ß√£o (CREATE_CLIENT, CREATE_USER, etc.)\n\n#### 9.4 Pagina√ß√£o\n\nSe houver mais de 50 logs:\n1. Navegue para a pr√≥xima p√°gina\n2. Volte para a primeira\n\n**Resultado esperado**:\n- ‚úÖ Pagina√ß√£o funcionando\n\n---\n\n### PASSO 10: Testar Configura√ß√µes ‚öôÔ∏è\n\n**O que faz**: P√°gina placeholder para configura√ß√µes futuras\n\n#### 10.1 Acessar Settings\n\n1. Clique em **\"Settings\"** no menu lateral\n\n**Resultado esperado**:\n- ‚úÖ P√°gina de configura√ß√µes aparece\n- ‚úÖ Pode ser apenas um placeholder dizendo \"Em constru√ß√£o\"\n\n---\n\n## üéØ CHECKLIST FINAL DE VALIDA√á√ÉO\n\nMarque cada item ap√≥s testar:\n\n### Dashboard\n- [ ] Estat√≠sticas carregam corretamente\n- [ ] Auto-refresh funciona (30s)\n- [ ] N√∫meros aumentam/diminuem conforme a√ß√µes\n\n### Clients\n- [ ] Criar cliente funciona\n- [ ] Editar cliente funciona\n- [ ] Deletar cliente (sem depend√™ncias) funciona\n- [ ] Deletar cliente (com depend√™ncias) bloqueia com erro 409\n- [ ] Slug duplicado d√° erro 409\n\n### Domains\n- [ ] Selecionar cliente funciona\n- [ ] Adicionar dom√≠nio EXACT funciona\n- [ ] Adicionar dom√≠nio REGEX funciona\n- [ ] Deletar dom√≠nio funciona\n- [ ] Multi-tenant (isolamento por cliente) funciona\n- [ ] Sincronizar com Pi-hole (se Docker dispon√≠vel)\n\n### Whitelist\n- [ ] Adicionar IP funciona\n- [ ] Valida√ß√£o de IP inv√°lido funciona\n- [ ] Deletar IP funciona\n- [ ] Multi-tenant funciona\n\n### Pi-hole Instances\n- [ ] Provisionar inst√¢ncia funciona (se Docker dispon√≠vel)\n- [ ] Listar inst√¢ncias funciona\n- [ ] Restart inst√¢ncia funciona\n- [ ] Deprovision funciona\n- [ ] Atualizar dnsdist config funciona\n\n### Users\n- [ ] Listar usu√°rios funciona\n- [ ] Criar usu√°rio USER funciona\n- [ ] Criar usu√°rio ADMIN funciona\n- [ ] Editar usu√°rio funciona\n- [ ] Deletar outro usu√°rio funciona\n- [ ] Prote√ß√£o de auto-delete funciona (erro ao tentar deletar a si mesmo)\n\n### Audit Logs\n- [ ] Listar logs funciona\n- [ ] Nomes dos atores aparecem (n√£o apenas IDs)\n- [ ] Filtrar por a√ß√£o funciona\n- [ ] Pagina√ß√£o funciona (se > 50 logs)\n\n### Autentica√ß√£o\n- [ ] Login funciona\n- [ ] Logout funciona\n- [ ] Menu adapta-se ao role (ADMIN v√™ Users, USER n√£o)\n- [ ] Redirecionamento para /login se n√£o autenticado\n\n---\n\n## üêõ ERROS COMUNS E SOLU√á√ïES\n\n### \"404 Not Found\" em `/admin/clients`\n**Solu√ß√£o**: Verifique se o endpoint existe em `apps/api/routers/admin.py`\n\n### \"403 Forbidden\" em `/admin/audit`\n**Solu√ß√£o**: Usu√°rio logado n√£o tem role ADMIN. Fa√ßa logout e login com `admin@novaguardian.com`\n\n### \"Audit Logs mostra 'Sistema' em vez do nome\"\n**Solu√ß√£o**: Relacionamento SQL faltando. Verifique `AuditLog.user = relationship(\"User\")`\n\n### \"Dashboard n√£o atualiza automaticamente\"\n**Solu√ß√£o**: TanStack Query n√£o configurado para refetch. Verifique `refetchInterval: 30000`\n\n### \"Multi-tenant n√£o funciona (dom√≠nios de todos os clientes aparecem)\"\n**Solu√ß√£o**: Query keys do TanStack Query n√£o parametrizadas. Verifique `queryKey: ['domains', clientId]`\n\n### \"CORS error\" no console\n**Solu√ß√£o**: Vite proxy n√£o configurado. Verifique `vite.config.js` tem `/api` proxy\n\n---\n\n## ‚úÖ RESULTADO ESPERADO FINAL\n\nAp√≥s completar todos os testes:\n\n1. ‚úÖ **Dashboard**: Mostra estat√≠sticas reais e atualiza a cada 30s\n2. ‚úÖ **7 p√°ginas funcionais**: Clients, Domains, Whitelist, Pi-hole, Users, Audit Logs, Settings\n3. ‚úÖ **CRUD completo**: Criar, ler, atualizar, deletar em todas as entidades\n4. ‚úÖ **Multi-tenant**: Isolamento perfeito entre clientes\n5. ‚úÖ **RBAC**: Admin v√™ tudo, User v√™ apenas sua √°rea\n6. ‚úÖ **Valida√ß√µes**: Erros claros e informativos\n7. ‚úÖ **Performance**: Loading states, cache invalidation autom√°tica\n8. ‚úÖ **Audit trail**: Todos os logs com nomes de usu√°rios\n\n---\n\n## üìù PR√ìXIMOS PASSOS\n\nAp√≥s validar tudo:\n\n1. **Documentar bugs encontrados**: Liste qualquer erro que encontrou\n2. **Deploy**: Use o bot√£o \"Deploy\" do Replit para publicar\n3. **Testes E2E automatizados**: Considere criar testes com Playwright/Cypress\n4. **Monitoramento**: Adicione Sentry ou similar para rastrear erros em produ√ß√£o\n\n---\n\n**Boa sorte com os testes! üöÄ**\n\nSe encontrar qualquer problema, me avise que eu corrijo imediatamente.\n","size_bytes":15774}},"version":2}